<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Agricultural Data – The Dynamic Effects of Weather Shocks on Agricultural Production</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./data-macro.html" rel="next">
<link href="./data-weather.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ TeX: { extensions: ["color.js"] }});
</script>
<script type="text/x-mathjax-config">
	MathJax.Hub.Register.StartupHook("TeX color Ready", function() {
	     MathJax.Extension["TeX/color"].colors["wongBlack"] = '#000000';
		 MathJax.Extension["TeX/color"].colors["wongGold"] = '#E69F00';
		 MathJax.Extension["TeX/color"].colors["wongLightBlue"] = '#56B4E9';
		 MathJax.Extension["TeX/color"].colors["wongGreen"] = '#009E73';
		 MathJax.Extension["TeX/color"].colors["wongYellow"] = '#F0E442';
		 MathJax.Extension["TeX/color"].colors["wongBlue"] = '#0072B2';
		 MathJax.Extension["TeX/color"].colors["wongOrange"] = '#D55E00';
		 MathJax.Extension["TeX/color"].colors["wongPurple"] = '#CC79A7';
		 
		 
		 MathJax.Extension["TeX/color"].colors["IBMBlue"] = '#648FFF';
		 MathJax.Extension["TeX/color"].colors["IBMPurple"] = '#785EF0';
		 MathJax.Extension["TeX/color"].colors["IBMMagenta"] = '#DC267F';
		 MathJax.Extension["TeX/color"].colors["IBMOrange"] = '#FE6100';
		 MathJax.Extension["TeX/color"].colors["IBMYellow"] = '#FFB000';
	});
</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">The Dynamic Effects of Weather Shocks on Agricultural Production</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/3wen/weather-peru"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data-weather.html">I. Data</a></li><li class="breadcrumb-item"><a href="./data-agriculture.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Agricultural Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">I. Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-weather.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Weather Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-agriculture.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Agricultural Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-macro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Macroeconomic Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-other.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Other Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-merge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Merging the files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-desc-stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Descriptive Statistics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">II. Local Projections</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./local_projections_piscop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">The Dynamic Effects of Weather Shocks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./local_projections_quadratic_piscop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Quadratic Terms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./local_projections_seasonal_piscop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Time-varying exposure to weather shocks</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">III. Macroeconomic Impacts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ag-fluctuations_piscop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">From Regional to Aggregate Fluctuations</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">IV. Robustness Check: Data Frequency</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robustness-data-merge-quarter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Merging: quarterly data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robustness-data-merge-annual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Merging: annual data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robustness-local_projections-quarter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Quarterly Agricultural Production (LP)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robustness-local_projections-annual.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Annual Agricultural Production (LP)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robustness-local_projections-comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Monthly/Quarterly/Annual Comparison (LP)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">V. Robustness Check: CHIRPS Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robustness-local_projections_chirps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Agricultural Production (LP)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robustness-ag-fluctuations_chirps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Aggregate Fluctuations</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">VI. Robustness Check: Other</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robustness-local_projections_posvsneg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Agricultural Production: Positive vs.&nbsp;Negative Surprise Shocks (LP)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robustness-local_projections_until_2014.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Agricultural Production (LP): without 2015 data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#functions" id="toc-functions" class="nav-link active" data-scroll-target="#functions"><span class="header-section-number">2.1</span> Functions</a>
  <ul class="collapse">
  <li><a href="#downloading-data" id="toc-downloading-data" class="nav-link" data-scroll-target="#downloading-data"><span class="header-section-number">2.1.1</span> Downloading Data</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data"><span class="header-section-number">2.1.2</span> Load Data</a></li>
  </ul></li>
  <li><a href="#download-the-data" id="toc-download-the-data" class="nav-link" data-scroll-target="#download-the-data"><span class="header-section-number">2.2</span> Download the Data</a></li>
  <li><a href="#sec-data-agriculture-import" id="toc-sec-data-agriculture-import" class="nav-link" data-scroll-target="#sec-data-agriculture-import"><span class="header-section-number">2.3</span> Import Data in R</a>
  <ul class="collapse">
  <li><a href="#campaign-data" id="toc-campaign-data" class="nav-link" data-scroll-target="#campaign-data"><span class="header-section-number">2.3.1</span> Campaign Data</a></li>
  <li><a href="#growth-duration" id="toc-growth-duration" class="nav-link" data-scroll-target="#growth-duration"><span class="header-section-number">2.3.2</span> Growth Duration</a></li>
  <li><a href="#saving-the-raw-data" id="toc-saving-the-raw-data" class="nav-link" data-scroll-target="#saving-the-raw-data"><span class="header-section-number">2.3.3</span> Saving the raw data</a></li>
  </ul></li>
  <li><a href="#aggregation-of-agricultural-datasets" id="toc-aggregation-of-agricultural-datasets" class="nav-link" data-scroll-target="#aggregation-of-agricultural-datasets"><span class="header-section-number">2.4</span> Aggregation of Agricultural Datasets</a>
  <ul class="collapse">
  <li><a href="#harmonization" id="toc-harmonization" class="nav-link" data-scroll-target="#harmonization"><span class="header-section-number">2.4.1</span> Harmonization</a></li>
  <li><a href="#aggregation-in-a-single-tibble" id="toc-aggregation-in-a-single-tibble" class="nav-link" data-scroll-target="#aggregation-in-a-single-tibble"><span class="header-section-number">2.4.2</span> Aggregation in a single tibble</a></li>
  </ul></li>
  <li><a href="#final-aggregation" id="toc-final-aggregation" class="nav-link" data-scroll-target="#final-aggregation"><span class="header-section-number">2.5</span> Final Aggregation</a></li>
  <li><a href="#content-of-the-dataset" id="toc-content-of-the-dataset" class="nav-link" data-scroll-target="#content-of-the-dataset"><span class="header-section-number">2.6</span> Content of the dataset</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data-weather.html">I. Data</a></li><li class="breadcrumb-item"><a href="./data-agriculture.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Agricultural Data</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-ag-data" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Agricultural Data</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>This section provides the code to download and format Peruvian agricultural data from the monthly reports “<em><a href="https://www.midagri.gob.pe/portal/boletin-estadistico-mensual-el-agro-en-cifras">El Agro en Cifras</a></em>” produced by the Ministry of Agriculture and Irrigation of Peru (MINAGRI). The downloaded reports cover the period from 2001 to 2019. However, starting from 2016, the observations provided are no longer monthly but quarterly. Therefore, they are excluded from the analysis.</p>
</div>
</div>
<p>Multiple R packages are required.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you previously loaded the {raster} package, there will be conflicts between <code class="sourceCode r">dplyr<span class="sc">::</span><span class="fu">select</span>()</code> and <code class="sourceCode r">raster<span class="sc">::</span><span class="fu">select</span>()</code> functions. It is recommended to run the code in this chapter in a clear R session.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rJava)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">java.parameters =</span> <span class="st">"-Xmx2048m"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xlsx)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(huxtable)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xtable)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(texreg)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdftools)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timetk)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(seasonal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="functions" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="functions"><span class="header-section-number">2.1</span> Functions</h2>
<p>In this section, we define several functions to download and format various datasets. These functions will be utilized later in <a href="#sec-data-agriculture-import" class="quarto-xref">Section&nbsp;<span>2.3</span></a> for importing and formatting the agricultural data in R.</p>
<section id="downloading-data" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="downloading-data"><span class="header-section-number">2.1.1</span> Downloading Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Directly download the Excels versions of the monthly reports available on the</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' Peruvian website MINAGRI.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param y</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>download.data <span class="ot">&lt;-</span> <span class="cf">function</span>(y){</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># HOME PAGE</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  page <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.midagri.gob.pe/portal/"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"boletin-estadistico-mensual-el-agro-en-cifras?start="</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">19</span><span class="sc">-</span>y</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># EXTRACTION OF THE LINKS</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  text_rvest <span class="ot">&lt;-</span> <span class="fu">read_html</span>(page)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> text_rvest <span class="sc">|&gt;</span> <span class="fu">html_nodes</span>(<span class="st">".mainbody"</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  first_result <span class="ot">&lt;-</span> results[<span class="dv">1</span>]</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># LIST OF THE MONTHS</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  list_of_months <span class="ot">&lt;-</span> first_result <span class="sc">|&gt;</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_nodes</span>(<span class="st">".cabecera"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_text</span>(<span class="at">trim =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  list_of_months <span class="ot">&lt;-</span> list_of_months[<span class="fu">str_detect</span>(list_of_months, <span class="st">"[aeiou]"</span>)]</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># LIST OF THE urls (=liens)</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  liens <span class="ot">&lt;-</span>first_result <span class="sc">|&gt;</span> <span class="fu">html_nodes</span>(<span class="st">"a[href]"</span>) <span class="sc">|&gt;</span> <span class="fu">html_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  liens <span class="ot">&lt;-</span> liens[(<span class="fu">str_detect</span>(liens, <span class="st">"zip"</span>))]</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">as.numeric</span>(<span class="fu">str_detect</span>(liens, <span class="st">"</span><span class="sc">\\</span><span class="st">.pdf"</span>))) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    liens <span class="ot">&lt;-</span> liens[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">str_detect</span>(liens, <span class="st">"</span><span class="sc">\\</span><span class="st">.pdf"</span>))]</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">as.numeric</span>(<span class="fu">str_detect</span>(liens, <span class="st">"pdf</span><span class="sc">\\</span><span class="st">.zip"</span>))) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    liens <span class="ot">&lt;-</span> liens[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">str_detect</span>(liens, <span class="st">"pdf</span><span class="sc">\\</span><span class="st">.zip"</span>))]</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((y <span class="sc">==</span> <span class="dv">13</span>) <span class="sc">|</span> (y <span class="sc">==</span> <span class="dv">14</span>) <span class="sc">|</span> (y <span class="sc">==</span><span class="dv">15</span>)) {</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    liens <span class="ot">&lt;-</span> liens[<span class="fu">which</span>(<span class="fu">str_detect</span>(liens, <span class="st">"cuadros"</span>))]</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span>) {</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    liens <span class="ot">&lt;-</span> liens[<span class="fu">which</span>(<span class="fu">str_detect</span>(liens, <span class="st">"data"</span>))]</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">14</span>) {</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">as.numeric</span>(<span class="fu">str_detect</span>(liens, <span class="st">"abril"</span>))) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>      line <span class="ot">&lt;-</span> liens[<span class="fu">which</span>(<span class="fu">str_detect</span>(liens, <span class="st">"abril"</span>))[<span class="dv">1</span>]]</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>      liens <span class="ot">&lt;-</span> liens[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">str_detect</span>(liens, <span class="st">"abril"</span>))]</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">as.numeric</span>(<span class="fu">duplicated</span>(liens))) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    liens <span class="ot">&lt;-</span> liens[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">duplicated</span>(liens) <span class="sc">==</span> T)]</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">14</span>) {</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    liens <span class="ot">&lt;-</span> <span class="fu">c</span>(liens[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>], line, liens[<span class="dv">9</span><span class="sc">:</span><span class="dv">11</span>])</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  annee <span class="ot">&lt;-</span>  <span class="fu">as.numeric</span>(<span class="fu">str_c</span>(<span class="st">"20"</span>, <span class="fu">ifelse</span>(y <span class="sc">&lt;</span><span class="dv">10</span> , <span class="fu">str_c</span>(<span class="st">"0"</span>,y), y)))</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CONDITION 1: Checking the number of urls</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(liens) <span class="sc">==</span> <span class="fu">length</span>(list_of_months)) {</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">7</span>) {</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>      list_of_months <span class="ot">&lt;-</span> list_of_months[<span class="sc">-</span><span class="dv">8</span>]</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>      liens <span class="ot">&lt;-</span> liens[<span class="sc">-</span><span class="dv">8</span>]</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(<span class="fu">str_c</span>(<span class="st">"../data/"</span>, annee))</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LOOP 1 - On months for downloading and extracting the ZIP files</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(liens)) {</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>      mois_Lettres <span class="ot">&lt;-</span> list_of_months[m]</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>      mois <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"iciembre"</span>) <span class="sc">~</span> <span class="st">"12"</span>,</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"oviembre"</span>) <span class="sc">~</span> <span class="st">"11"</span>,</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"ctubre"</span>)   <span class="sc">~</span> <span class="st">"10"</span>,</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"tiembre"</span>)  <span class="sc">~</span> <span class="st">"09"</span>,</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"osto"</span>)     <span class="sc">~</span> <span class="st">"08"</span>,</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"ulio"</span>)     <span class="sc">~</span> <span class="st">"07"</span>,</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"unio"</span>)     <span class="sc">~</span> <span class="st">"06"</span>,</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"ayo"</span>)      <span class="sc">~</span> <span class="st">"05"</span>,</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"bril"</span>)     <span class="sc">~</span> <span class="st">"04"</span>,</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"arzo"</span>)     <span class="sc">~</span> <span class="st">"03"</span>,</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"brero"</span>)    <span class="sc">~</span> <span class="st">"02"</span>,</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"nero"</span>)     <span class="sc">~</span> <span class="st">"01"</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>      <span class="co"># DOWNLOADING THE FILE</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>      AdresseFichier <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, mois, <span class="st">".zip"</span>)</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>        <span class="at">url =</span> <span class="fu">str_c</span>(<span class="st">"https://www.midagri.gob.pe/"</span>, liens[m]),</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>        <span class="at">destfile =</span> AdresseFichier</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Names of the files in the archive</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>      files <span class="ot">&lt;-</span> <span class="fu">unzip</span>(<span class="at">zipfile =</span> AdresseFichier, <span class="at">list =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>      folder_name <span class="ot">&lt;-</span> files<span class="sc">$</span>Name[<span class="fu">str_which</span>(</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>        files<span class="sc">$</span>Name, <span class="fu">regex</span>(<span class="st">"agr.*la"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>      )] <span class="sc">|&gt;</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_extract</span>(<span class="st">"^(.*)/"</span>)</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Unzip on Mac OS when files in the archive contain accents in names</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>      <span class="fu">system</span>(<span class="fu">str_c</span>(<span class="st">"open "</span>, AdresseFichier))</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">str_c</span>(<span class="st">"FILE "</span>, mois, <span class="st">"-"</span>, annee, <span class="st">" UNZIPED"</span>))</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>      folder_name <span class="ot">&lt;-</span> files<span class="sc">$</span>Name[<span class="fu">str_which</span>(</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>        files<span class="sc">$</span>Name, <span class="fu">regex</span>(<span class="st">"agr.*la"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>      )] <span class="sc">|&gt;</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_extract</span>(<span class="st">"^(.*)/"</span>)</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Special case to handle year 2005</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (annee <span class="sc">==</span> <span class="dv">2005</span>) {</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>        AdresseFichier <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, mois)</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>        fichierZip <span class="ot">&lt;-</span> <span class="fu">list.files</span>(AdresseFichier)[<span class="fu">str_detect</span>(<span class="fu">list.files</span>(AdresseFichier), <span class="st">".zip"</span>)]</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(fichierZip)) {</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>          <span class="fu">unzip</span>(</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>            <span class="at">zipfile =</span> <span class="fu">str_c</span>(AdresseFichier, <span class="st">"/"</span>, fichierZip[i]),</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>            <span class="at">exdir =</span> AdresseFichier</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>    }<span class="co"># End of LOOP 1</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>    <span class="co"># MANUAL TREATMENT FOR 2007</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (annee <span class="sc">==</span> <span class="dv">2007</span>) {</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>      list_of_months <span class="ot">&lt;-</span> <span class="fu">c</span>(list_of_months[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>], <span class="st">"Mayo"</span>, list_of_months[<span class="dv">8</span><span class="sc">:</span><span class="dv">11</span>])</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dir.create</span>(<span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/05"</span>))</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>      <span class="fu">file.copy</span>(</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>        <span class="at">from =</span> <span class="st">"./MAYO_2007_NO_DELETE/AGRICOLA.xls"</span> ,</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>,annee,<span class="st">"/05/AGRICOLA.xls"</span>)</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LOOP 2 - On months for creating the Excel files</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list_of_months)) {</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">7</span>) { <span class="cf">next</span> } <span class="cf">else</span> {</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Checking the appopriate name of each month</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>        mois_Lettres <span class="ot">&lt;-</span> list_of_months[m]</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>        mois <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"iciembre"</span>) <span class="sc">~</span> <span class="st">"12"</span>,</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"oviembre"</span>) <span class="sc">~</span> <span class="st">"11"</span>,</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"ctubre"</span>)   <span class="sc">~</span> <span class="st">"10"</span>,</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"tiembre"</span>)  <span class="sc">~</span> <span class="st">"09"</span>,</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"osto"</span>)     <span class="sc">~</span> <span class="st">"08"</span>,</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"ulio"</span>)     <span class="sc">~</span> <span class="st">"07"</span>,</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"unio"</span>)     <span class="sc">~</span> <span class="st">"06"</span>,</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"ayo"</span>)      <span class="sc">~</span> <span class="st">"05"</span>,</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"bril"</span>)     <span class="sc">~</span> <span class="st">"04"</span>,</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"arzo"</span>)     <span class="sc">~</span> <span class="st">"03"</span>,</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"brero"</span>)    <span class="sc">~</span> <span class="st">"02"</span>,</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(mois_Lettres, <span class="st">"nero"</span>)     <span class="sc">~</span> <span class="st">"01"</span></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Selecting the right Zip file</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>        AdresseFichier <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri"</span>, annee, <span class="st">"/"</span>, mois, <span class="st">".zip"</span>)</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ((y <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">10</span>) <span class="sc">|</span> (y <span class="sc">==</span> <span class="dv">7</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">8</span>)) {</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>          files <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>            m <span class="sc">==</span> <span class="dv">10</span>,</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>            <span class="at">yes =</span> <span class="fu">data.table</span>(<span class="at">Name =</span> <span class="fu">list.files</span>(</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>              <span class="st">"../data/raw/minagri/2012/cuadros-marzo12"</span></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>            )),</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>            <span class="at">no =</span> <span class="fu">data.table</span>(<span class="at">Name =</span> <span class="fu">list.files</span>(</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>              <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/05/"</span>)</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>            ))</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>          files <span class="ot">&lt;-</span> <span class="fu">unzip</span>(<span class="at">zipfile =</span> AdresseFichier, <span class="at">list =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">06</span> <span class="sc">&amp;</span> (m <span class="sc">==</span> <span class="dv">10</span> <span class="sc">|</span> m <span class="sc">==</span> <span class="dv">12</span>)) {</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(files)[<span class="dv">1</span>]) {</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>            name <span class="ot">&lt;-</span> files[i, <span class="dv">1</span>]</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>            <span class="fu">unzip</span>(</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>              <span class="at">zipfile =</span> <span class="fu">str_c</span>(</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>                <span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, mois, <span class="st">"/"</span>, name</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>              ),</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>              <span class="at">exdir =</span> <span class="fu">str_c</span>(</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>                <span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, mois</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span> <span class="sc">&amp;</span> m <span class="sc">&lt;</span> <span class="dv">12</span>) {</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>          N_1 <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, files[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>          N <span class="ot">&lt;-</span> <span class="fu">str_c</span>(N_1,<span class="st">"x"</span>)</span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.copy</span>(<span class="at">from =</span> N_1, <span class="at">to =</span> N)</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (m <span class="sc">&gt;=</span> <span class="dv">6</span>) {</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>            N <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, files[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>            <span class="fu">unlink</span>(N_1, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>          folder_name <span class="ot">&lt;-</span> files<span class="sc">$</span>Name[<span class="fu">str_which</span>(</span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>            files<span class="sc">$</span>Name,</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>            <span class="fu">regex</span>(<span class="st">"agr.*la"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>          )] <span class="sc">|&gt;</span></span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>            <span class="fu">str_extract</span>(<span class="st">"^(.*)/"</span>)</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">is.na</span>(folder_name[<span class="dv">1</span>])) {folder_name <span class="ot">&lt;-</span> mois}</span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">10</span>) {folder_name <span class="ot">&lt;-</span> <span class="st">"cuadros-marzo12"</span>}</span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Adding .xls to the 2008-07 file</span></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">08</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">6</span>) {</span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>            N <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>              <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, folder_name),</span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>              <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">|&gt;</span></span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>              {\(x) <span class="fu">str_which</span>(x, <span class="fu">regex</span>(<span class="st">"clima"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))}()</span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>            <span class="fu">file.rename</span>(<span class="at">from =</span> N, <span class="at">to =</span> <span class="fu">str_c</span>(N,<span class="st">".xls"</span>))</span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>          <span class="co"># CHANGING "HIDRO.." FILES INTO "CLIMA"</span></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (</span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>            <span class="fu">any</span>(</span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>              <span class="fu">str_detect</span>(</span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>                <span class="fu">list.files</span>(</span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>,annee,<span class="st">"/"</span>,folder_name),</span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>                  <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>                <span class="fu">regex</span>(<span class="st">"hidro.*"</span>,<span class="at">ignore_case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>            N <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>              <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>,annee,<span class="st">"/"</span>,folder_name),</span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a>              <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">|&gt;</span></span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>              {\(x) <span class="fu">str_which</span>(w, <span class="fu">regex</span>(<span class="st">"hidro.*"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))}()</span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>            <span class="fu">file.rename</span>(</span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>              <span class="at">from =</span> N,</span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">str_c</span>( <span class="fu">substr</span>(N,<span class="dv">0</span>,<span class="fu">nchar</span>(N)<span class="sc">-</span><span class="dv">4</span>),<span class="st">"clima.xls"</span>)</span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Final list of files in the unziped file</span></span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>          N <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>            <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, folder_name),</span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>            <span class="at">full.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>            <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.xlsx?"</span>,</span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>            <span class="at">ignore.case =</span> <span class="cn">TRUE</span></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>          <span class="fu">print</span>(N)</span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>          <span class="co"># SELECTING THE FILE FOR AGRICULTURAL DATA</span></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>          N1 <span class="ot">&lt;-</span> N[<span class="fu">str_which</span>(N, <span class="fu">regex</span>(<span class="st">"agr.*la"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))]</span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">as.numeric</span>(<span class="fu">duplicated</span>(N1))) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>            N1 <span class="ot">&lt;-</span> N1[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">duplicated</span>(N1) <span class="sc">==</span> T)]</span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">length</span>(N1) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>            N1 <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">07</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">10</span>) <span class="sc">~</span> N1[<span class="dv">1</span>],</span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">08</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">1</span>)  <span class="sc">~</span> N1[<span class="dv">2</span>],</span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">08</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">8</span>)  <span class="sc">~</span> N1[<span class="dv">1</span>],</span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">4</span>)  <span class="sc">~</span> N1[<span class="dv">2</span>]</span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>          <span class="fu">print</span>(N1)</span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>          <span class="co"># SELECTING THE FILE FOR PRICES</span></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">&lt;</span> <span class="dv">14</span> <span class="sc">|</span> (y <span class="sc">==</span> <span class="dv">14</span> <span class="sc">&amp;</span> m <span class="sc">&gt;</span> <span class="dv">1</span>) ) {</span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>            N2 <span class="ot">&lt;-</span> N[<span class="fu">str_which</span>(N, <span class="fu">regex</span>(<span class="st">"pre.*os"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))]</span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>            N2 <span class="ot">&lt;-</span> N[<span class="fu">str_which</span>(N, <span class="fu">regex</span>(<span class="st">"agr.*la"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))]</span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span>) { N2 <span class="ot">&lt;-</span> N }</span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">as.numeric</span>(<span class="fu">duplicated</span>(N2))) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>            N2 <span class="ot">&lt;-</span> N2[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">duplicated</span>(N2)<span class="sc">==</span>T)]</span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">length</span>(N2) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>            N2 <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">07</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">10</span>) <span class="sc">~</span> N2[<span class="dv">1</span>],</span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">08</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">1</span>)  <span class="sc">~</span> N2[<span class="dv">2</span>],</span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">08</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">8</span>)  <span class="sc">~</span> N2[<span class="dv">1</span>],</span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">4</span>)  <span class="sc">~</span> N2[<span class="dv">2</span>]</span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>          <span class="fu">print</span>(N2)</span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">3</span>) {</span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>            <span class="fu">file.copy</span>(</span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a>              <span class="at">from =</span> N2 ,</span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">str_c</span>(</span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>                <span class="st">"../data/raw/minagri/2010/"</span>,</span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>                <span class="st">"BEAM SETIEMBRE_DEF_2010/BEAM SETIEMBRE//Precios_oct.xls"</span></span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>          <span class="co"># SELECTING THE FILE FOR CLIMATE DATA</span></span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>          N3 <span class="ot">&lt;-</span> N[<span class="fu">str_which</span>(N, <span class="fu">regex</span>(<span class="st">"c.*ima"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))]</span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span>) {N3 <span class="ot">&lt;-</span> N}</span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">as.numeric</span>(<span class="fu">duplicated</span>(N3))) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>            N3 <span class="ot">&lt;-</span> N3[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">duplicated</span>(N3) <span class="sc">==</span> T)]</span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">as.numeric</span>(<span class="fu">str_detect</span>(N3, <span class="fu">regex</span>(<span class="st">"mp.*t"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)))) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a>            N3 <span class="ot">&lt;-</span> N3[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">str_detect</span>(N3, <span class="fu">regex</span>(<span class="st">"mp.*t"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)))]</span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">is_empty</span>(N3)) {</span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a>            N3 <span class="ot">&lt;-</span> N[<span class="fu">str_which</span>(N, <span class="fu">regex</span>(<span class="st">"Bem.*"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))]</span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a>            N3 <span class="ot">&lt;-</span> N3[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">str_detect</span>(N3, <span class="fu">regex</span>(<span class="st">"mp.*t"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)))]</span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">length</span>(N3) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>            N3 <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">07</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">10</span>) <span class="sc">~</span> N3[<span class="dv">1</span>],</span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">08</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">1</span>)  <span class="sc">~</span> N3[<span class="dv">1</span>],</span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">08</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">8</span>)  <span class="sc">~</span> N3[<span class="dv">7</span>],</span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">08</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">9</span>)  <span class="sc">~</span> N3[<span class="dv">2</span>],</span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">12</span>) <span class="sc">~</span> N3[<span class="dv">1</span>],</span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>              (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">4</span>)  <span class="sc">~</span> N3[<span class="dv">2</span>]</span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>          <span class="fu">print</span>(N3)</span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">is_empty</span>(N3)) {N3 <span class="ot">&lt;-</span> <span class="st">""</span>}</span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Special attribution for the 2006_01 files</span></span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">06</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">12</span>) {</span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>            N1 <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>              <span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, mois, <span class="st">"/AGRICOLA/AGRICOLA.xls"</span></span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>            N2 <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>              <span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, mois, <span class="st">"/PRECIOS/PRECIOS.xls"</span></span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>            N3 <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>              <span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, mois, <span class="st">"/CLIMA/Bemene2006.xls"</span></span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a>          type_xl <span class="ot">&lt;-</span> <span class="st">"xls"</span></span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span>) {</span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>            type_xl <span class="ot">&lt;-</span> <span class="st">"xlsx"</span></span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (m <span class="sc">==</span> <span class="dv">2</span>) {type_xl <span class="ot">&lt;-</span> <span class="st">"xls"</span>}</span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">5</span>) {</span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a>            folder_name <span class="ot">&lt;-</span> files<span class="sc">$</span>Name[<span class="fu">str_which</span>(</span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a>              files<span class="sc">$</span>Name,</span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a>              <span class="fu">regex</span>(<span class="st">"agri.*zip"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a>            )]</span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a>            <span class="fu">unzip</span>(</span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a>              <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, mois, <span class="st">"/"</span>, folder_name),</span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a>              <span class="at">exdir =</span> <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>, annee,<span class="st">"/"</span>, mois)</span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a>            N1 <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a>              <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, mois),</span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a>              <span class="at">full.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a>              <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.xlsx?"</span>,</span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a>              <span class="at">ignore.case =</span> <span class="cn">TRUE</span></span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a>        mois <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a>          (y <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> mois <span class="sc">==</span> <span class="st">"04"</span>) <span class="sc">~</span> <span class="st">"05"</span>,</span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a>          (y <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> mois <span class="sc">==</span> <span class="st">"05"</span>) <span class="sc">~</span> <span class="st">"04"</span>,</span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a>          (y <span class="sc">==</span> <span class="dv">14</span> <span class="sc">&amp;</span> mois <span class="sc">==</span> <span class="st">"09"</span>) <span class="sc">~</span> <span class="st">"10"</span>,</span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a>          (y <span class="sc">==</span> <span class="dv">14</span> <span class="sc">&amp;</span> mois <span class="sc">==</span> <span class="st">"10"</span>) <span class="sc">~</span> <span class="st">"09"</span>,</span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(mois)</span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a>        <span class="co"># FILES FOR 2005 - 2013</span></span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (y <span class="sc">&lt;=</span> <span class="dv">13</span>) {</span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a>          <span class="co"># PRODUCTION</span></span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a>          name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a>            <span class="st">"../data/raw/minagri/Production/Production_"</span>, annee, <span class="st">".xlsx"</span></span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) {</span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (y <span class="sc">&lt;</span> <span class="dv">11</span>) {</span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a>              table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-26"</span>, <span class="st">"c-27"</span>)</span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a>              table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-28"</span>, <span class="st">"c-29"</span>)</span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">11</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">9</span> ) {table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-27"</span>, <span class="st">"c-28"</span>)}</span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">11</span> <span class="sc">&amp;</span> m <span class="sc">&gt;</span> <span class="dv">9</span> ) {table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-26"</span>, <span class="st">"c-27"</span>)}</span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a>            Tableau <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> N1, <span class="at">sheet =</span> table)</span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a>            <span class="fu">write.xlsx</span>(</span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a>              Tableau,</span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a>              name,</span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a>              <span class="at">sheetName =</span> <span class="fu">str_c</span>(mois, annee, i),</span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a>              <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a>              <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a>            <span class="fu">print</span>(table)</span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a>          <span class="co"># PLANTED AREAS</span></span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a>          name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a>            <span class="st">"../data/raw/minagri/Surface/Superficies_"</span>, annee, <span class="st">".xlsx"</span></span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) {</span>
<span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (y <span class="sc">&lt;</span> <span class="dv">11</span>) {</span>
<span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a>              table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-19"</span>, <span class="st">"c-20"</span>)</span>
<span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a>              table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-21"</span>, <span class="st">"c-22"</span>)</span>
<span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb2-399"><a href="#cb2-399" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>( y <span class="sc">==</span> <span class="dv">11</span> <span class="sc">&amp;</span> m <span class="sc">&gt;</span> <span class="dv">9</span> ) {table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-19"</span>, <span class="st">"c-20"</span>)}</span>
<span id="cb2-400"><a href="#cb2-400" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>( y <span class="sc">==</span> <span class="dv">11</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">9</span> ) {table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-20"</span>, <span class="st">"c-21"</span>)}</span>
<span id="cb2-401"><a href="#cb2-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-402"><a href="#cb2-402" aria-hidden="true" tabindex="-1"></a>            Tableau <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> N1, <span class="at">sheet =</span> table, <span class="at">col_types =</span> <span class="st">"text"</span>)</span>
<span id="cb2-403"><a href="#cb2-403" aria-hidden="true" tabindex="-1"></a>            <span class="fu">write.xlsx</span>(</span>
<span id="cb2-404"><a href="#cb2-404" aria-hidden="true" tabindex="-1"></a>              Tableau,</span>
<span id="cb2-405"><a href="#cb2-405" aria-hidden="true" tabindex="-1"></a>              name,</span>
<span id="cb2-406"><a href="#cb2-406" aria-hidden="true" tabindex="-1"></a>              <span class="at">sheetName =</span> <span class="fu">str_c</span>(mois, annee, i),</span>
<span id="cb2-407"><a href="#cb2-407" aria-hidden="true" tabindex="-1"></a>              <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-408"><a href="#cb2-408" aria-hidden="true" tabindex="-1"></a>              <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb2-409"><a href="#cb2-409" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-410"><a href="#cb2-410" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-411"><a href="#cb2-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-412"><a href="#cb2-412" aria-hidden="true" tabindex="-1"></a>          <span class="co"># HARVESTED SUPERFICIES</span></span>
<span id="cb2-413"><a href="#cb2-413" aria-hidden="true" tabindex="-1"></a>          name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb2-414"><a href="#cb2-414" aria-hidden="true" tabindex="-1"></a>            <span class="st">"../data/raw/minagri/Surface_R/Superficies_R_"</span>, annee, <span class="st">".xlsx"</span></span>
<span id="cb2-415"><a href="#cb2-415" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-416"><a href="#cb2-416" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) {</span>
<span id="cb2-417"><a href="#cb2-417" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (y <span class="sc">&lt;</span> <span class="dv">11</span>) {</span>
<span id="cb2-418"><a href="#cb2-418" aria-hidden="true" tabindex="-1"></a>              table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-23"</span>, <span class="st">"c-24"</span>)</span>
<span id="cb2-419"><a href="#cb2-419" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb2-420"><a href="#cb2-420" aria-hidden="true" tabindex="-1"></a>              table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-25"</span>, <span class="st">"c-26"</span>)</span>
<span id="cb2-421"><a href="#cb2-421" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb2-422"><a href="#cb2-422" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">11</span> <span class="sc">&amp;</span> m <span class="sc">&gt;</span> <span class="dv">9</span> ) {table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-23"</span> ,<span class="st">"c-24"</span>)}</span>
<span id="cb2-423"><a href="#cb2-423" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">11</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">9</span> ) {table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-24"</span> ,<span class="st">"c-25"</span>)}</span>
<span id="cb2-424"><a href="#cb2-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-425"><a href="#cb2-425" aria-hidden="true" tabindex="-1"></a>            Tableau <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> N1, <span class="at">sheet =</span> table, <span class="at">col_types =</span> <span class="st">"text"</span>)</span>
<span id="cb2-426"><a href="#cb2-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-427"><a href="#cb2-427" aria-hidden="true" tabindex="-1"></a>            <span class="fu">write.xlsx</span>(</span>
<span id="cb2-428"><a href="#cb2-428" aria-hidden="true" tabindex="-1"></a>              Tableau,</span>
<span id="cb2-429"><a href="#cb2-429" aria-hidden="true" tabindex="-1"></a>              name,</span>
<span id="cb2-430"><a href="#cb2-430" aria-hidden="true" tabindex="-1"></a>              <span class="at">sheetName =</span> <span class="fu">str_c</span>(mois, annee, i),</span>
<span id="cb2-431"><a href="#cb2-431" aria-hidden="true" tabindex="-1"></a>              <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-432"><a href="#cb2-432" aria-hidden="true" tabindex="-1"></a>              <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb2-433"><a href="#cb2-433" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-434"><a href="#cb2-434" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-435"><a href="#cb2-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-436"><a href="#cb2-436" aria-hidden="true" tabindex="-1"></a>          <span class="co"># PRICES</span></span>
<span id="cb2-437"><a href="#cb2-437" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Name of the file</span></span>
<span id="cb2-438"><a href="#cb2-438" aria-hidden="true" tabindex="-1"></a>          name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/Prices/Prices_"</span>, annee, <span class="st">".xlsx"</span>)</span>
<span id="cb2-439"><a href="#cb2-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-440"><a href="#cb2-440" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Selecting the names of the sheets</span></span>
<span id="cb2-441"><a href="#cb2-441" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">&lt;=</span> <span class="dv">10</span>) {</span>
<span id="cb2-442"><a href="#cb2-442" aria-hidden="true" tabindex="-1"></a>            table <span class="ot">&lt;-</span> <span class="st">"C-65"</span></span>
<span id="cb2-443"><a href="#cb2-443" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb2-444"><a href="#cb2-444" aria-hidden="true" tabindex="-1"></a>            table <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb2-445"><a href="#cb2-445" aria-hidden="true" tabindex="-1"></a>              (annee <span class="sc">==</span> <span class="dv">2011</span> <span class="sc">&amp;</span> m <span class="sc">&lt;</span> <span class="dv">9</span>  )   <span class="sc">~</span> <span class="st">"C-69"</span>,</span>
<span id="cb2-446"><a href="#cb2-446" aria-hidden="true" tabindex="-1"></a>              (annee <span class="sc">==</span> <span class="dv">2011</span> <span class="sc">&amp;</span> m  <span class="sc">==</span> <span class="dv">9</span>  ) <span class="sc">~</span> <span class="st">"C-68"</span>,</span>
<span id="cb2-447"><a href="#cb2-447" aria-hidden="true" tabindex="-1"></a>              (annee <span class="sc">==</span> <span class="dv">2011</span> <span class="sc">&amp;</span> m <span class="sc">&gt;=</span> <span class="dv">10</span> )  <span class="sc">~</span> <span class="st">"C-65"</span>,</span>
<span id="cb2-448"><a href="#cb2-448" aria-hidden="true" tabindex="-1"></a>              (annee <span class="sc">&gt;</span> <span class="dv">2011</span> )             <span class="sc">~</span> <span class="st">"C-69"</span></span>
<span id="cb2-449"><a href="#cb2-449" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-450"><a href="#cb2-450" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-451"><a href="#cb2-451" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">13</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">1</span>) {table <span class="ot">&lt;-</span> <span class="fu">regex</span>(<span class="st">"C-76"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)}</span>
<span id="cb2-452"><a href="#cb2-452" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb2-453"><a href="#cb2-453" aria-hidden="true" tabindex="-1"></a>            N2 <span class="ot">&lt;-</span>  <span class="fu">str_c</span>(</span>
<span id="cb2-454"><a href="#cb2-454" aria-hidden="true" tabindex="-1"></a>              <span class="st">"../data/raw/minagri/2010/BEAM SETIEMBRE_DEF_2010/"</span>,</span>
<span id="cb2-455"><a href="#cb2-455" aria-hidden="true" tabindex="-1"></a>              <span class="st">"BEAM SETIEMBRE//Precios_oct.xls"</span></span>
<span id="cb2-456"><a href="#cb2-456" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-457"><a href="#cb2-457" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-458"><a href="#cb2-458" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">07</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">8</span>) {</span>
<span id="cb2-459"><a href="#cb2-459" aria-hidden="true" tabindex="-1"></a>            N2 <span class="ot">&lt;-</span>  <span class="st">"../data/raw/minagri/2007/04/PRECIOS.xls"</span></span>
<span id="cb2-460"><a href="#cb2-460" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-461"><a href="#cb2-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-462"><a href="#cb2-462" aria-hidden="true" tabindex="-1"></a>          Tableau <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> N2, <span class="at">sheet =</span> table, <span class="at">col_types =</span> <span class="st">"text"</span>)</span>
<span id="cb2-463"><a href="#cb2-463" aria-hidden="true" tabindex="-1"></a>          <span class="fu">write.xlsx</span>(</span>
<span id="cb2-464"><a href="#cb2-464" aria-hidden="true" tabindex="-1"></a>            Tableau,</span>
<span id="cb2-465"><a href="#cb2-465" aria-hidden="true" tabindex="-1"></a>            name,</span>
<span id="cb2-466"><a href="#cb2-466" aria-hidden="true" tabindex="-1"></a>            <span class="at">sheetName =</span> <span class="fu">str_c</span>(mois, annee),</span>
<span id="cb2-467"><a href="#cb2-467" aria-hidden="true" tabindex="-1"></a>            <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-468"><a href="#cb2-468" aria-hidden="true" tabindex="-1"></a>            <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb2-469"><a href="#cb2-469" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-470"><a href="#cb2-470" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb2-471"><a href="#cb2-471" aria-hidden="true" tabindex="-1"></a>          <span class="co"># FILES FOR 2014 - 2018</span></span>
<span id="cb2-472"><a href="#cb2-472" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span>) {</span>
<span id="cb2-473"><a href="#cb2-473" aria-hidden="true" tabindex="-1"></a>            N1 <span class="ot">&lt;-</span> N</span>
<span id="cb2-474"><a href="#cb2-474" aria-hidden="true" tabindex="-1"></a>            N2 <span class="ot">&lt;-</span> N</span>
<span id="cb2-475"><a href="#cb2-475" aria-hidden="true" tabindex="-1"></a>            N3 <span class="ot">&lt;-</span> N</span>
<span id="cb2-476"><a href="#cb2-476" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-477"><a href="#cb2-477" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">12</span>) {</span>
<span id="cb2-478"><a href="#cb2-478" aria-hidden="true" tabindex="-1"></a>            N1 <span class="ot">&lt;-</span> N[<span class="dv">2</span>]</span>
<span id="cb2-479"><a href="#cb2-479" aria-hidden="true" tabindex="-1"></a>            N2 <span class="ot">&lt;-</span> N[<span class="dv">2</span>]</span>
<span id="cb2-480"><a href="#cb2-480" aria-hidden="true" tabindex="-1"></a>            N3 <span class="ot">&lt;-</span> N[<span class="dv">2</span>]</span>
<span id="cb2-481"><a href="#cb2-481" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-482"><a href="#cb2-482" aria-hidden="true" tabindex="-1"></a>          <span class="co"># PRODUCTION</span></span>
<span id="cb2-483"><a href="#cb2-483" aria-hidden="true" tabindex="-1"></a>          name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb2-484"><a href="#cb2-484" aria-hidden="true" tabindex="-1"></a>            <span class="st">"../data/raw/minagri/Production/Production_"</span>, annee, <span class="st">".xlsx"</span></span>
<span id="cb2-485"><a href="#cb2-485" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-486"><a href="#cb2-486" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">14</span>) {</span>
<span id="cb2-487"><a href="#cb2-487" aria-hidden="true" tabindex="-1"></a>            table <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb2-488"><a href="#cb2-488" aria-hidden="true" tabindex="-1"></a>              m <span class="sc">==</span><span class="dv">1</span>  <span class="sc">~</span> <span class="st">"c-12"</span>,</span>
<span id="cb2-489"><a href="#cb2-489" aria-hidden="true" tabindex="-1"></a>              m <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"c-26"</span></span>
<span id="cb2-490"><a href="#cb2-490" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-491"><a href="#cb2-491" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-492"><a href="#cb2-492" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span>) {table <span class="ot">&lt;-</span><span class="st">"c-11"</span>}</span>
<span id="cb2-493"><a href="#cb2-493" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">18</span>) {table <span class="ot">&lt;-</span><span class="st">"c-18"</span>}</span>
<span id="cb2-494"><a href="#cb2-494" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span>  <span class="dv">2</span>) {table <span class="ot">&lt;-</span><span class="st">"C-11"</span>}</span>
<span id="cb2-495"><a href="#cb2-495" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span>  <span class="dv">4</span>) {table <span class="ot">&lt;-</span><span class="st">"C-11"</span>}</span>
<span id="cb2-496"><a href="#cb2-496" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span>  <span class="dv">6</span>) {table <span class="ot">&lt;-</span><span class="st">"C-11"</span>}</span>
<span id="cb2-497"><a href="#cb2-497" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">10</span>) {table <span class="ot">&lt;-</span><span class="st">"C-11"</span>}</span>
<span id="cb2-498"><a href="#cb2-498" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span> <span class="sc">&amp;</span> m <span class="sc">&lt;</span>   <span class="dv">7</span>) {table <span class="ot">&lt;-</span><span class="st">"C.12"</span>}</span>
<span id="cb2-499"><a href="#cb2-499" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span> <span class="sc">&amp;</span> m <span class="sc">==</span>  <span class="dv">7</span>) {table <span class="ot">&lt;-</span><span class="st">"C. 12"</span>}</span>
<span id="cb2-500"><a href="#cb2-500" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span> <span class="sc">&amp;</span> m <span class="sc">&gt;=</span>  <span class="dv">8</span>) {table <span class="ot">&lt;-</span><span class="st">"C.12"</span>}</span>
<span id="cb2-501"><a href="#cb2-501" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">12</span>) {table <span class="ot">&lt;-</span><span class="st">"c-11"</span>}</span>
<span id="cb2-502"><a href="#cb2-502" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">14</span> <span class="sc">&amp;</span> m <span class="sc">&gt;</span><span class="dv">7</span>) {</span>
<span id="cb2-503"><a href="#cb2-503" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) {</span>
<span id="cb2-504"><a href="#cb2-504" aria-hidden="true" tabindex="-1"></a>              table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-28"</span>, <span class="st">"c-29"</span>)</span>
<span id="cb2-505"><a href="#cb2-505" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (m <span class="sc">==</span> <span class="dv">11</span>) {table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"C-28"</span>, <span class="st">"C-29"</span>)}</span>
<span id="cb2-506"><a href="#cb2-506" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (m <span class="sc">==</span> <span class="dv">8</span>) {table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-26"</span>, <span class="st">"c-26-a"</span>)}</span>
<span id="cb2-507"><a href="#cb2-507" aria-hidden="true" tabindex="-1"></a>              Tableau <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> N1, <span class="at">sheet =</span> table)</span>
<span id="cb2-508"><a href="#cb2-508" aria-hidden="true" tabindex="-1"></a>              <span class="fu">write.xlsx</span>(</span>
<span id="cb2-509"><a href="#cb2-509" aria-hidden="true" tabindex="-1"></a>                Tableau,</span>
<span id="cb2-510"><a href="#cb2-510" aria-hidden="true" tabindex="-1"></a>                name,</span>
<span id="cb2-511"><a href="#cb2-511" aria-hidden="true" tabindex="-1"></a>                <span class="at">sheetName =</span> <span class="fu">str_c</span>(mois, annee, i),</span>
<span id="cb2-512"><a href="#cb2-512" aria-hidden="true" tabindex="-1"></a>                <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-513"><a href="#cb2-513" aria-hidden="true" tabindex="-1"></a>                <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb2-514"><a href="#cb2-514" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb2-515"><a href="#cb2-515" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb2-516"><a href="#cb2-516" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb2-517"><a href="#cb2-517" aria-hidden="true" tabindex="-1"></a>            Tableau <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb2-518"><a href="#cb2-518" aria-hidden="true" tabindex="-1"></a>              <span class="at">path =</span> N1,</span>
<span id="cb2-519"><a href="#cb2-519" aria-hidden="true" tabindex="-1"></a>              <span class="at">sheet =</span> <span class="fu">regex</span>(table, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-520"><a href="#cb2-520" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-521"><a href="#cb2-521" aria-hidden="true" tabindex="-1"></a>            <span class="fu">write.xlsx</span>(</span>
<span id="cb2-522"><a href="#cb2-522" aria-hidden="true" tabindex="-1"></a>              Tableau,</span>
<span id="cb2-523"><a href="#cb2-523" aria-hidden="true" tabindex="-1"></a>              name,</span>
<span id="cb2-524"><a href="#cb2-524" aria-hidden="true" tabindex="-1"></a>              <span class="at">sheetName =</span> <span class="fu">str_c</span>(mois, annee),</span>
<span id="cb2-525"><a href="#cb2-525" aria-hidden="true" tabindex="-1"></a>              <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-526"><a href="#cb2-526" aria-hidden="true" tabindex="-1"></a>              <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb2-527"><a href="#cb2-527" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-528"><a href="#cb2-528" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-529"><a href="#cb2-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-530"><a href="#cb2-530" aria-hidden="true" tabindex="-1"></a>          <span class="co"># PLANTED SUPERFICIES</span></span>
<span id="cb2-531"><a href="#cb2-531" aria-hidden="true" tabindex="-1"></a>          name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb2-532"><a href="#cb2-532" aria-hidden="true" tabindex="-1"></a>            <span class="st">"../data/raw/minagri/Surface/Superficies_"</span>,annee,<span class="st">".xlsx"</span></span>
<span id="cb2-533"><a href="#cb2-533" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-534"><a href="#cb2-534" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(y <span class="sc">==</span><span class="dv">14</span>) {</span>
<span id="cb2-535"><a href="#cb2-535" aria-hidden="true" tabindex="-1"></a>            table <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb2-536"><a href="#cb2-536" aria-hidden="true" tabindex="-1"></a>              m <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"c-7"</span>,</span>
<span id="cb2-537"><a href="#cb2-537" aria-hidden="true" tabindex="-1"></a>              m <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"c-21"</span></span>
<span id="cb2-538"><a href="#cb2-538" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-539"><a href="#cb2-539" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-540"><a href="#cb2-540" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span><span class="dv">15</span>) {table <span class="ot">&lt;-</span><span class="st">"c-6"</span>}</span>
<span id="cb2-541"><a href="#cb2-541" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span><span class="dv">18</span>) {table <span class="ot">&lt;-</span><span class="st">"c-16"</span>}</span>
<span id="cb2-542"><a href="#cb2-542" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span>) {table <span class="ot">&lt;-</span><span class="st">"C.9"</span>}</span>
<span id="cb2-543"><a href="#cb2-543" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">2</span>) {table <span class="ot">&lt;-</span><span class="st">"C-6"</span>}</span>
<span id="cb2-544"><a href="#cb2-544" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">4</span>) {table <span class="ot">&lt;-</span><span class="st">"C-6"</span>}</span>
<span id="cb2-545"><a href="#cb2-545" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">6</span>) {table <span class="ot">&lt;-</span><span class="st">"C-6"</span>}</span>
<span id="cb2-546"><a href="#cb2-546" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">10</span>) {table <span class="ot">&lt;-</span><span class="st">"C-6"</span>}</span>
<span id="cb2-547"><a href="#cb2-547" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span> <span class="sc">&amp;</span> m <span class="sc">==</span>  <span class="dv">7</span>) {table <span class="ot">&lt;-</span><span class="st">"C. 7"</span>}</span>
<span id="cb2-548"><a href="#cb2-548" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span> <span class="sc">&amp;</span> m <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>)) {table <span class="ot">&lt;-</span><span class="st">"C.6"</span>}</span>
<span id="cb2-549"><a href="#cb2-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-550"><a href="#cb2-550" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">14</span> <span class="sc">&amp;</span> m <span class="sc">&gt;</span> <span class="dv">7</span> ) {</span>
<span id="cb2-551"><a href="#cb2-551" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) {</span>
<span id="cb2-552"><a href="#cb2-552" aria-hidden="true" tabindex="-1"></a>              table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-21"</span>, <span class="st">"c-22"</span>)</span>
<span id="cb2-553"><a href="#cb2-553" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span>(m <span class="sc">==</span> <span class="dv">8</span> ) {table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-21"</span>, <span class="st">"c-21-a"</span>)}</span>
<span id="cb2-554"><a href="#cb2-554" aria-hidden="true" tabindex="-1"></a>              Tableau <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> N1, <span class="at">sheet =</span> table)</span>
<span id="cb2-555"><a href="#cb2-555" aria-hidden="true" tabindex="-1"></a>              <span class="fu">write.xlsx</span>(</span>
<span id="cb2-556"><a href="#cb2-556" aria-hidden="true" tabindex="-1"></a>                Tableau,</span>
<span id="cb2-557"><a href="#cb2-557" aria-hidden="true" tabindex="-1"></a>                name,</span>
<span id="cb2-558"><a href="#cb2-558" aria-hidden="true" tabindex="-1"></a>                <span class="at">sheetName =</span> <span class="fu">str_c</span>(mois, annee, i),</span>
<span id="cb2-559"><a href="#cb2-559" aria-hidden="true" tabindex="-1"></a>                <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-560"><a href="#cb2-560" aria-hidden="true" tabindex="-1"></a>                <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb2-561"><a href="#cb2-561" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb2-562"><a href="#cb2-562" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb2-563"><a href="#cb2-563" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb2-564"><a href="#cb2-564" aria-hidden="true" tabindex="-1"></a>            Tableau <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> N1, <span class="at">sheet =</span> table, <span class="at">col_types =</span> <span class="st">"text"</span>)</span>
<span id="cb2-565"><a href="#cb2-565" aria-hidden="true" tabindex="-1"></a>            <span class="fu">write.xlsx</span>(</span>
<span id="cb2-566"><a href="#cb2-566" aria-hidden="true" tabindex="-1"></a>              Tableau,</span>
<span id="cb2-567"><a href="#cb2-567" aria-hidden="true" tabindex="-1"></a>              name,</span>
<span id="cb2-568"><a href="#cb2-568" aria-hidden="true" tabindex="-1"></a>              <span class="at">sheetName =</span> <span class="fu">str_c</span>(mois, annee),</span>
<span id="cb2-569"><a href="#cb2-569" aria-hidden="true" tabindex="-1"></a>              <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-570"><a href="#cb2-570" aria-hidden="true" tabindex="-1"></a>              <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb2-571"><a href="#cb2-571" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-572"><a href="#cb2-572" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-573"><a href="#cb2-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-574"><a href="#cb2-574" aria-hidden="true" tabindex="-1"></a>          <span class="co"># HARVESTED SUPERFICIES</span></span>
<span id="cb2-575"><a href="#cb2-575" aria-hidden="true" tabindex="-1"></a>          name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb2-576"><a href="#cb2-576" aria-hidden="true" tabindex="-1"></a>            <span class="st">"../data/raw/minagri/Surface_R/Superficies_R_"</span>, annee, <span class="st">".xlsx"</span></span>
<span id="cb2-577"><a href="#cb2-577" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-578"><a href="#cb2-578" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span><span class="dv">14</span>) {</span>
<span id="cb2-579"><a href="#cb2-579" aria-hidden="true" tabindex="-1"></a>            table <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb2-580"><a href="#cb2-580" aria-hidden="true" tabindex="-1"></a>              m <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"c-10"</span>,</span>
<span id="cb2-581"><a href="#cb2-581" aria-hidden="true" tabindex="-1"></a>              m <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"c-24"</span></span>
<span id="cb2-582"><a href="#cb2-582" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-583"><a href="#cb2-583" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-584"><a href="#cb2-584" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span><span class="dv">15</span>) {table <span class="ot">&lt;-</span><span class="st">"c-9"</span>}</span>
<span id="cb2-585"><a href="#cb2-585" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span><span class="dv">18</span>) {table <span class="ot">&lt;-</span><span class="st">"c-16"</span>}</span>
<span id="cb2-586"><a href="#cb2-586" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span>) {table <span class="ot">&lt;-</span><span class="st">"C.9"</span>} <span class="co">#FALSE : Table do not exist in the 2016 file</span></span>
<span id="cb2-587"><a href="#cb2-587" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">2</span>) {table <span class="ot">&lt;-</span><span class="st">"C-9"</span>}</span>
<span id="cb2-588"><a href="#cb2-588" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">4</span>) {table <span class="ot">&lt;-</span><span class="st">"C-9"</span>}</span>
<span id="cb2-589"><a href="#cb2-589" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">6</span>) {table <span class="ot">&lt;-</span><span class="st">"C-9"</span>}</span>
<span id="cb2-590"><a href="#cb2-590" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">15</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">10</span>) {table <span class="ot">&lt;-</span><span class="st">"c-9"</span>}</span>
<span id="cb2-591"><a href="#cb2-591" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span> <span class="sc">&amp;</span> m <span class="sc">==</span>  <span class="dv">7</span>) {table <span class="ot">&lt;-</span><span class="st">"C. 7"</span>} <span class="co">#FALSE : Table do not exist in the 2016 file</span></span>
<span id="cb2-592"><a href="#cb2-592" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span> <span class="sc">&amp;</span> m <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>)) {table <span class="ot">&lt;-</span><span class="st">"C.9"</span>}</span>
<span id="cb2-593"><a href="#cb2-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-594"><a href="#cb2-594" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">14</span> <span class="sc">&amp;</span> m <span class="sc">&gt;</span> <span class="dv">7</span>) {</span>
<span id="cb2-595"><a href="#cb2-595" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) {</span>
<span id="cb2-596"><a href="#cb2-596" aria-hidden="true" tabindex="-1"></a>              table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>,<span class="st">"c-25"</span>, <span class="st">"c-26"</span>)</span>
<span id="cb2-597"><a href="#cb2-597" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (m <span class="sc">==</span> <span class="dv">11</span>) {table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"C25"</span>, <span class="st">"C26"</span>)}</span>
<span id="cb2-598"><a href="#cb2-598" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (m <span class="sc">==</span> <span class="dv">8</span> ) {table <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"c-24"</span>, <span class="st">"c-24-a"</span>)}</span>
<span id="cb2-599"><a href="#cb2-599" aria-hidden="true" tabindex="-1"></a>              Tableau <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> N1, <span class="at">sheet =</span> table)</span>
<span id="cb2-600"><a href="#cb2-600" aria-hidden="true" tabindex="-1"></a>              <span class="fu">write.xlsx</span>(</span>
<span id="cb2-601"><a href="#cb2-601" aria-hidden="true" tabindex="-1"></a>                Tableau,</span>
<span id="cb2-602"><a href="#cb2-602" aria-hidden="true" tabindex="-1"></a>                name,</span>
<span id="cb2-603"><a href="#cb2-603" aria-hidden="true" tabindex="-1"></a>                <span class="at">sheetName =</span> <span class="fu">str_c</span>(mois, annee, i),</span>
<span id="cb2-604"><a href="#cb2-604" aria-hidden="true" tabindex="-1"></a>                <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-605"><a href="#cb2-605" aria-hidden="true" tabindex="-1"></a>                <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb2-606"><a href="#cb2-606" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb2-607"><a href="#cb2-607" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb2-608"><a href="#cb2-608" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb2-609"><a href="#cb2-609" aria-hidden="true" tabindex="-1"></a>            Tableau <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> N1, <span class="at">sheet =</span> table, <span class="at">col_types =</span> <span class="st">"text"</span>)</span>
<span id="cb2-610"><a href="#cb2-610" aria-hidden="true" tabindex="-1"></a>            <span class="fu">write.xlsx</span>(</span>
<span id="cb2-611"><a href="#cb2-611" aria-hidden="true" tabindex="-1"></a>              Tableau,</span>
<span id="cb2-612"><a href="#cb2-612" aria-hidden="true" tabindex="-1"></a>              name,</span>
<span id="cb2-613"><a href="#cb2-613" aria-hidden="true" tabindex="-1"></a>              <span class="at">sheetName =</span> <span class="fu">str_c</span>(mois, annee),</span>
<span id="cb2-614"><a href="#cb2-614" aria-hidden="true" tabindex="-1"></a>              <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-615"><a href="#cb2-615" aria-hidden="true" tabindex="-1"></a>              <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb2-616"><a href="#cb2-616" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-617"><a href="#cb2-617" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-618"><a href="#cb2-618" aria-hidden="true" tabindex="-1"></a>          <span class="co"># PRICES</span></span>
<span id="cb2-619"><a href="#cb2-619" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Name of the file</span></span>
<span id="cb2-620"><a href="#cb2-620" aria-hidden="true" tabindex="-1"></a>          name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb2-621"><a href="#cb2-621" aria-hidden="true" tabindex="-1"></a>            <span class="st">"../data/raw/minagri/Prices/Prices_"</span>, annee, <span class="st">".xlsx"</span></span>
<span id="cb2-622"><a href="#cb2-622" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-623"><a href="#cb2-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-624"><a href="#cb2-624" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Selecting the names of the sheets</span></span>
<span id="cb2-625"><a href="#cb2-625" aria-hidden="true" tabindex="-1"></a>          table <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb2-626"><a href="#cb2-626" aria-hidden="true" tabindex="-1"></a>            (annee <span class="sc">==</span> <span class="dv">2014</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">1</span>)            <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">regex</span>(<span class="st">"c-17"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-627"><a href="#cb2-627" aria-hidden="true" tabindex="-1"></a>            (annee <span class="sc">==</span> <span class="dv">2014</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">2</span>)            <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">regex</span>(<span class="st">"C-80"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-628"><a href="#cb2-628" aria-hidden="true" tabindex="-1"></a>            (annee <span class="sc">==</span> <span class="dv">2014</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">3</span>)            <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">regex</span>(<span class="st">"C-72"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-629"><a href="#cb2-629" aria-hidden="true" tabindex="-1"></a>            (annee <span class="sc">==</span> <span class="dv">2014</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">4</span>)            <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">regex</span>(<span class="st">"C-80"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-630"><a href="#cb2-630" aria-hidden="true" tabindex="-1"></a>            (annee <span class="sc">==</span> <span class="dv">2014</span> <span class="sc">&amp;</span> m <span class="sc">%in%</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>)        <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">regex</span>(<span class="st">"C-72"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-631"><a href="#cb2-631" aria-hidden="true" tabindex="-1"></a>            (annee <span class="sc">==</span> <span class="dv">2014</span> <span class="sc">&amp;</span> m <span class="sc">&gt;</span><span class="dv">8</span>)              <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">regex</span>(<span class="st">"C-76"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-632"><a href="#cb2-632" aria-hidden="true" tabindex="-1"></a>            (annee <span class="sc">==</span> <span class="dv">2015</span> <span class="sc">&amp;</span> <span class="sc">!</span> m <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>)) <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">regex</span>(<span class="st">"c-16"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-633"><a href="#cb2-633" aria-hidden="true" tabindex="-1"></a>            (annee <span class="sc">==</span> <span class="dv">2015</span> <span class="sc">&amp;</span> m <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>))   <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">regex</span>(<span class="st">"C-16"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-634"><a href="#cb2-634" aria-hidden="true" tabindex="-1"></a>            (annee <span class="sc">==</span> <span class="dv">2016</span> <span class="sc">&amp;</span> m <span class="sc">&lt;=</span> <span class="dv">6</span>)            <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">regex</span>(<span class="st">"C.15"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-635"><a href="#cb2-635" aria-hidden="true" tabindex="-1"></a>            (annee <span class="sc">==</span> <span class="dv">2016</span> <span class="sc">&amp;</span> m <span class="sc">&gt;</span>  <span class="dv">6</span>)            <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">regex</span>(<span class="st">"C.13"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-636"><a href="#cb2-636" aria-hidden="true" tabindex="-1"></a>            (annee <span class="sc">==</span> <span class="dv">2016</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">7</span>)            <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">regex</span>(<span class="st">"C. 13"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-637"><a href="#cb2-637" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-638"><a href="#cb2-638" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span> <span class="sc">&amp;</span> m <span class="sc">==</span> <span class="dv">7</span>) {table <span class="ot">&lt;-</span><span class="st">"C. 13"</span>}</span>
<span id="cb2-639"><a href="#cb2-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-640"><a href="#cb2-640" aria-hidden="true" tabindex="-1"></a>          Tableau <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> N2, <span class="at">sheet =</span> table, <span class="at">col_types =</span> <span class="st">"text"</span>)</span>
<span id="cb2-641"><a href="#cb2-641" aria-hidden="true" tabindex="-1"></a>          <span class="fu">write.xlsx</span>(</span>
<span id="cb2-642"><a href="#cb2-642" aria-hidden="true" tabindex="-1"></a>            Tableau,</span>
<span id="cb2-643"><a href="#cb2-643" aria-hidden="true" tabindex="-1"></a>            name,</span>
<span id="cb2-644"><a href="#cb2-644" aria-hidden="true" tabindex="-1"></a>            <span class="at">sheetName =</span> <span class="fu">str_c</span>(mois, annee),</span>
<span id="cb2-645"><a href="#cb2-645" aria-hidden="true" tabindex="-1"></a>            <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-646"><a href="#cb2-646" aria-hidden="true" tabindex="-1"></a>            <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb2-647"><a href="#cb2-647" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-648"><a href="#cb2-648" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-649"><a href="#cb2-649" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span> <span class="sc">&amp;</span> m <span class="sc">&lt;</span> <span class="dv">12</span>) {</span>
<span id="cb2-650"><a href="#cb2-650" aria-hidden="true" tabindex="-1"></a>          <span class="fu">unlink</span>(N, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-651"><a href="#cb2-651" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb2-652"><a href="#cb2-652" aria-hidden="true" tabindex="-1"></a>          <span class="fu">unlink</span>(</span>
<span id="cb2-653"><a href="#cb2-653" aria-hidden="true" tabindex="-1"></a>            <span class="fu">str_c</span>(<span class="st">"../data/raw/minagri/"</span>, annee, <span class="st">"/"</span>, folder_name),</span>
<span id="cb2-654"><a href="#cb2-654" aria-hidden="true" tabindex="-1"></a>            <span class="at">recursive =</span> <span class="cn">TRUE</span></span>
<span id="cb2-655"><a href="#cb2-655" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-656"><a href="#cb2-656" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-657"><a href="#cb2-657" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-658"><a href="#cb2-658" aria-hidden="true" tabindex="-1"></a>    }<span class="co"># End of LOOP 2</span></span>
<span id="cb2-659"><a href="#cb2-659" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="re">END</span><span class="co"> OF CONDITION 1</span></span>
<span id="cb2-660"><a href="#cb2-660" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-661"><a href="#cb2-661" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"ERROR - NB MOIS =! NB LIENS"</span>)</span>
<span id="cb2-662"><a href="#cb2-662" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-663"><a href="#cb2-663" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We define a function to extract data from the PDFs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Extract data from the PDF monthly reports from MINAGRI</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param annee year of the report</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param mois month of the report</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param adresse url of the report on www.midagri.gob.pe</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param page page number to extract</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param Cell1 name of the first cell to import</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>extract_pdf_data <span class="ot">&lt;-</span> <span class="cf">function</span>(annee,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                             mois,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                             adresse,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                             page,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                             Cell1) {</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Defining the number of cultures in the table----</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  PageDeDonnes <span class="ot">&lt;-</span> <span class="fu">pdf_data</span>(adresse)[[page]]</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (annee <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> mois <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    PageDeDonnes[<span class="fu">which</span>((PageDeDonnes[,<span class="st">"text"</span>] <span class="sc">==</span> <span class="st">"Año.?"</span>)),<span class="st">"x"</span>] <span class="ot">&lt;-</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(PageDeDonnes[<span class="fu">which</span>((PageDeDonnes[,<span class="st">"text"</span>] <span class="sc">==</span> Cell1)),<span class="st">"x"</span>])</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Determining the begining of the table</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  x_Cell1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(PageDeDonnes[<span class="fu">which</span>((PageDeDonnes[,<span class="st">"text"</span>] <span class="sc">==</span> Cell1)), <span class="st">"x"</span>])</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  y_Cell1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(PageDeDonnes[<span class="fu">which</span>((PageDeDonnes[,<span class="st">"text"</span>] <span class="sc">==</span> Cell1)), <span class="st">"y"</span>])</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Looking for the lines with the same position as Cell1 or above</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  AboveLine1 <span class="ot">&lt;-</span> PageDeDonnes[<span class="fu">which</span>((PageDeDonnes[,<span class="st">"x"</span>] <span class="sc">&lt;=</span> x_Cell1 <span class="sc">+</span> <span class="dv">1</span>)), ]</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Special case for 01/2003 ----</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((annee <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> mois <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|</span> (annee <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> mois <span class="sc">&lt;</span> <span class="dv">8</span>)) {</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    AboveLine1 <span class="ot">&lt;-</span> PageDeDonnes[<span class="fu">which</span>((PageDeDonnes[, <span class="st">"x"</span>] <span class="sc">&lt;=</span> x_Cell1 <span class="sc">+</span> <span class="dv">10</span>)), ]</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    x_Cell1 <span class="ot">&lt;-</span> <span class="fu">max</span>(AboveLine1<span class="sc">$</span>x)}</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># end of special case</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span>  <span class="fu">which</span>(</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(AboveLine1<span class="sc">$</span>text, <span class="st">"Año.?"</span>) <span class="sc">|</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(AboveLine1<span class="sc">$</span>text, <span class="st">"paña"</span>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  AboveLine1[x, <span class="st">"x"</span>] <span class="ot">&lt;-</span> x_Cell1</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>((AboveLine1[,<span class="st">"text"</span>] <span class="sc">==</span> <span class="st">"Mensual"</span>))) {</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    AboveLine1 <span class="ot">&lt;-</span> AboveLine1[<span class="sc">-</span> <span class="fu">which</span>(AboveLine1[, <span class="st">"text"</span>] <span class="sc">==</span> <span class="st">"Mensual"</span>), ]</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>((AboveLine1[, <span class="st">"x"</span>] <span class="sc">&gt;</span> x_Cell1))) {</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    AboveLine1[<span class="fu">which</span>(AboveLine1[,<span class="st">"x"</span>]<span class="sc">&gt;</span>x_Cell1) ,<span class="st">"x"</span>] <span class="ot">&lt;-</span> x_Cell1</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  AboveLine1 <span class="ot">&lt;-</span> AboveLine1[<span class="fu">order</span>(AboveLine1<span class="sc">$</span>x, <span class="sc">-</span>AboveLine1<span class="sc">$</span>y), ]</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  positions  <span class="ot">&lt;-</span> <span class="fu">which</span>((AboveLine1[, <span class="st">"text"</span>] <span class="sc">==</span> Cell1))</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(AboveLine1[positions, <span class="st">"x"</span>])</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Line with the culture list</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  Cultures <span class="ot">&lt;-</span> AboveLine1[AboveLine1<span class="sc">$</span>x <span class="sc">==</span> x, ]</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">dim</span>(Cultures)[<span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">3</span>) {</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    Cultures <span class="ot">&lt;-</span> AboveLine1[AboveLine1<span class="sc">$</span>x <span class="sc">%in%</span> <span class="fu">c</span>(x,x<span class="dv">-1</span>), ]</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((annee <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> mois <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|</span> (annee <span class="sc">==</span><span class="dv">2</span> <span class="sc">&amp;</span> mois <span class="sc">&lt;</span> <span class="dv">6</span>)) {</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>      <span class="st">"width_1"</span>, <span class="st">"height_1"</span>, <span class="st">"x_1"</span>, <span class="st">"y_1"</span>, <span class="st">"space_1"</span>, <span class="st">"text_1"</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    Cultures_1_0103 <span class="ot">&lt;-</span> Cultures</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Selection of the previous line to determine the complete name</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>  x_1 <span class="ot">&lt;-</span> <span class="fu">unique</span>(AboveLine1<span class="sc">$</span>x)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>  x_1 <span class="ot">&lt;-</span> x_1[<span class="sc">-</span><span class="fu">which</span>((x_1 <span class="sc">==</span> x))]</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>  Cultures_1 <span class="ot">&lt;-</span> AboveLine1[AboveLine1<span class="sc">$</span>x <span class="sc">==</span> <span class="fu">max</span>(x_1), ]</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((annee <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> mois <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|</span> (annee <span class="sc">==</span><span class="dv">2</span> <span class="sc">&amp;</span> mois <span class="sc">&lt;</span> <span class="dv">6</span>)) {</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    Cultures_0103 <span class="ot">&lt;-</span> Cultures_1</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(Cultures_1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"width_1"</span>,<span class="st">"height_1"</span>,<span class="st">"x_1"</span>,<span class="st">"y_1"</span>,<span class="st">"space_1"</span>,<span class="st">"text_1"</span>)</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Row matching to obtain full crop names</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((annee <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> mois <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|</span> (annee <span class="sc">==</span><span class="dv">2</span> <span class="sc">&amp;</span> mois <span class="sc">&lt;</span> <span class="dv">6</span>)) {</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    Cultures <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>      Cultures_0103,</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>      Cultures_1_0103,</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>      <span class="at">by.x =</span> <span class="st">"y"</span>,</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>      <span class="at">by.y =</span> <span class="st">"y_1"</span>,</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">all.x =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">all.y=</span><span class="cn">TRUE</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    Cultures <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>      Cultures,</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>      Cultures_1,</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">by.x =</span> <span class="st">"y"</span>,</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">by.y =</span> <span class="st">"y_1"</span>,</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">all.x =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">all.y=</span><span class="cn">TRUE</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(Cultures)[<span class="dv">1</span>]) {</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    Cultures<span class="sc">$</span>nomcomplet[ii]  <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.na</span>(Cultures<span class="sc">$</span>text_1[ii])) Cultures<span class="sc">$</span>text[ii] <span class="cf">else</span> <span class="fu">paste</span>(Cultures<span class="sc">$</span>text_1[ii], Cultures<span class="sc">$</span>text[ii])</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (annee <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> mois <span class="sc">==</span> <span class="dv">1</span> ) {Cultures<span class="sc">$</span>nomcomplet[ii]  <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.na</span>(Cultures<span class="sc">$</span>text[ii])) Cultures<span class="sc">$</span>text_1[ii] <span class="cf">else</span> <span class="fu">paste</span>(Cultures<span class="sc">$</span>text_1[ii], Cultures<span class="sc">$</span>text[ii])}</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>    Cultures<span class="sc">$</span>nomcomplet[ii]  <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(Cultures<span class="sc">$</span>nomcomplet[ii], <span class="st">"- "</span>, <span class="st">""</span>)</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>    Cultures<span class="sc">$</span>nomcomplet[ii]  <span class="ot">&lt;-</span> <span class="cf">if</span> (Cultures<span class="sc">$</span>nomcomplet[ii] <span class="sc">==</span> <span class="st">"de azúcar"</span>) <span class="fu">paste</span>(<span class="st">"Caña"</span>, Cultures<span class="sc">$</span>nomcomplet[ii]) <span class="cf">else</span> Cultures<span class="sc">$</span>nomcomplet[ii]</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>    Cultures<span class="sc">$</span>nomcomplet[ii]  <span class="ot">&lt;-</span> <span class="cf">if</span> (Cultures<span class="sc">$</span>nomcomplet[ii] <span class="sc">==</span> <span class="st">"loctao"</span>) <span class="fu">paste</span>(<span class="st">"Frijol"</span>, Cultures<span class="sc">$</span>nomcomplet[ii]) <span class="cf">else</span> Cultures<span class="sc">$</span>nomcomplet[ii]</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>    Cultures<span class="sc">$</span>nomcomplet[ii]  <span class="ot">&lt;-</span> <span class="cf">if</span> (Cultures<span class="sc">$</span>nomcomplet[ii] <span class="sc">==</span> <span class="st">"palo"</span>) <span class="fu">paste</span>(<span class="st">"Frijol de"</span>, Cultures<span class="sc">$</span>nomcomplet[ii]) <span class="cf">else</span> Cultures<span class="sc">$</span>nomcomplet[ii]</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>    Cultures<span class="sc">$</span>nomcomplet[ii]  <span class="ot">&lt;-</span> <span class="cf">if</span> (Cultures<span class="sc">$</span>nomcomplet[ii] <span class="sc">==</span> <span class="st">"grano seco**"</span>) <span class="fu">paste</span>(<span class="st">"Frijol"</span>, Cultures<span class="sc">$</span>nomcomplet[ii]) <span class="cf">else</span> Cultures<span class="sc">$</span>nomcomplet[ii]</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>    Cultures<span class="sc">$</span>nomcomplet[ii]  <span class="ot">&lt;-</span> <span class="cf">if</span> (Cultures<span class="sc">$</span>nomcomplet[ii] <span class="sc">==</span> <span class="st">"amiláceo"</span>) <span class="fu">paste</span>(<span class="st">"Maíz"</span>, Cultures<span class="sc">$</span>nomcomplet[ii]) <span class="cf">else</span> Cultures<span class="sc">$</span>nomcomplet[ii]</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>    Cultures<span class="sc">$</span>nomcomplet[ii]  <span class="ot">&lt;-</span> <span class="cf">if</span> (Cultures<span class="sc">$</span>nomcomplet[ii] <span class="sc">==</span> <span class="st">"hua"</span>) <span class="fu">paste</span>(<span class="st">"Cañi"</span> ,Cultures<span class="sc">$</span>nomcomplet[ii], <span class="at">sep=</span><span class="st">""</span>) <span class="cf">else</span> Cultures<span class="sc">$</span>nomcomplet[ii]</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>    Cultures<span class="sc">$</span>nomcomplet[ii]  <span class="ot">&lt;-</span> <span class="cf">if</span> (Cultures<span class="sc">$</span>nomcomplet[ii] <span class="sc">==</span> <span class="st">"cáscara"</span>) <span class="fu">paste</span>(<span class="st">"Arroz"</span>, Cultures<span class="sc">$</span>nomcomplet[ii]) <span class="cf">else</span> Cultures<span class="sc">$</span>nomcomplet[ii]</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>    Cultures<span class="sc">$</span>nomcomplet[ii]  <span class="ot">&lt;-</span> <span class="cf">if</span> (Cultures<span class="sc">$</span>nomcomplet[ii] <span class="sc">==</span> <span class="st">"rama"</span>) <span class="fu">paste</span>(<span class="st">"Algodón"</span>, Cultures<span class="sc">$</span>nomcomplet[ii]) <span class="cf">else</span> Cultures<span class="sc">$</span>nomcomplet[ii]</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span> <span class="fu">is.na</span>(Cultures<span class="sc">$</span>text[ii]) <span class="sc">&amp;</span> <span class="fu">is.na</span>(Cultures<span class="sc">$</span>text_1[ii]) <span class="sc">&amp;</span> ii <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> ii <span class="sc">&lt;</span> <span class="fu">dim</span>(Cultures)[<span class="dv">1</span>]) {</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>      Cultures<span class="sc">$</span>nomcomplet[ii] <span class="ot">&lt;-</span> <span class="cf">if</span>(Cultures<span class="sc">$</span>y[ii] <span class="sc">==</span> Cultures<span class="sc">$</span>y[ii<span class="dv">-1</span>] <span class="sc">+</span> <span class="dv">1</span>) <span class="fu">paste</span>(Cultures<span class="sc">$</span>text_1[ii<span class="dv">-1</span>], Cultures<span class="sc">$</span>text[ii]) <span class="cf">else</span> Cultures<span class="sc">$</span>nomcomplet[ii]</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>      Cultures<span class="sc">$</span>nomcomplet[ii] <span class="ot">&lt;-</span> <span class="cf">if</span>(Cultures<span class="sc">$</span>y[ii] <span class="sc">==</span> Cultures<span class="sc">$</span>y[ii<span class="sc">+</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>) <span class="fu">paste</span>(Cultures<span class="sc">$</span>text_1[ii<span class="sc">+</span><span class="dv">1</span>], Cultures<span class="sc">$</span>text[ii]) <span class="cf">else</span> Cultures<span class="sc">$</span>nomcomplet[ii]</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Discarding unmatched rows</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>  ii <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">is.na</span>(Cultures<span class="sc">$</span>x))</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.integer</span>(ii) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(ii) <span class="sc">!=</span> <span class="dv">0</span>) {Cultures <span class="ot">&lt;-</span> Cultures[<span class="sc">-</span>ii, ]}</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>  ii <span class="ot">=</span> <span class="fu">which</span>(Cultures<span class="sc">$</span>text <span class="sc">==</span> <span class="st">"a."</span>)</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.integer</span>(ii) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(ii) <span class="sc">!=</span> <span class="dv">0</span>) {Cultures <span class="ot">&lt;-</span> Cultures[<span class="sc">-</span>ii, ]}</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>  ii <span class="ot">=</span> <span class="fu">which</span>(Cultures<span class="sc">$</span>text <span class="sc">==</span> <span class="st">"de"</span>)</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.integer</span>(ii) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(ii) <span class="sc">!=</span> <span class="dv">0</span>) {Cultures <span class="ot">&lt;-</span> Cultures[<span class="sc">-</span>ii, ]}</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>  isPlatano <span class="ot">&lt;-</span><span class="fu">any</span>(<span class="fu">str_detect</span>(PageDeDonnes<span class="sc">$</span>text, <span class="st">"Plátano"</span>))</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>  isFrijol <span class="ot">&lt;-</span><span class="fu">any</span>(<span class="fu">str_detect</span>(PageDeDonnes<span class="sc">$</span>text, <span class="st">"Frijol |seco"</span>))</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Special case for 01/2003</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((annee <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> mois <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|</span> annee <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (page <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">31</span>)) {</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>      Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">"Departamento"</span>,<span class="st">"Campaña"</span>, <span class="st">"Total"</span>,<span class="st">"Arroz cáscara"</span>, <span class="st">"Maíz amiláceo"</span>,</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Frijol grano seco**"</span>,<span class="st">"Frijol castlla"</span>, <span class="st">"Pallar"</span>,<span class="st">"Zarandaja"</span>,</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Frijol de palo"</span>, <span class="st">"Garbanzo"</span>,<span class="st">"Frijol loctao"</span>, <span class="st">"Lentaja"</span>, <span class="st">"Papa"</span>,</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Trigo"</span>, <span class="st">"Algodón rama"</span>, <span class="st">"Maíz duro"</span>, <span class="st">"Soya"</span>, <span class="st">"Sorgo grano"</span>,</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Marigold"</span>)</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (page <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">32</span>, <span class="dv">33</span>)) {</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>      Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">"Departamento"</span>, <span class="st">"Campaña"</span>, <span class="st">"Total"</span>, <span class="st">"Cebada grano"</span>, <span class="st">"Quinua"</span>,</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Cañihua"</span>, <span class="st">"Kiwicha"</span>,<span class="st">"Haba grano"</span>, <span class="st">"Arveja grano"</span>, <span class="st">"Chocho tarhui"</span>,</span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Olluco"</span>, <span class="st">"Oca"</span>, <span class="st">"Mashua"</span>, <span class="st">"Camote"</span>, <span class="st">"Yuca"</span>, <span class="st">"Cebolla"</span>, <span class="st">"Ajo"</span>,</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Tomate"</span>)</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (page <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">38</span>, <span class="dv">39</span>)) {</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>      Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">"Departamento"</span>,<span class="st">"Años"</span>, <span class="st">"Total"</span>,<span class="st">"Arroz cáscara"</span>, <span class="st">"Maíz amiláceo"</span>,</span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Frijol grano seco**"</span>,<span class="st">"Frijol castlla"</span>, <span class="st">"Pallar"</span>,<span class="st">"Zarandaja"</span>,</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Frijol de palo"</span>, <span class="st">"Garbanzo"</span>,<span class="st">"Frijol loctao"</span>, <span class="st">"Lentaja"</span>, <span class="st">"Papa"</span>,</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Trigo"</span>, <span class="st">"Maíz duro"</span>,<span class="st">"Soya"</span>, <span class="st">"Sorgo grano"</span>, <span class="st">"Marigold"</span>)</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (page <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">40</span>,<span class="dv">41</span>)) {</span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>      Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">"Departamento"</span>, <span class="st">"Años"</span>, <span class="st">"Cebada grano"</span>, <span class="st">"Quinua"</span>,<span class="st">"Cañihua"</span>,<span class="st">"Kiwicha"</span>,</span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Haba grano"</span>, <span class="st">"Arveja grano"</span>, <span class="st">"Chocho tarhui"</span>, <span class="st">"Olluco"</span>, <span class="st">"Oca"</span>,</span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Mashua"</span>, <span class="st">"Camote"</span>, <span class="st">"Yuca"</span>, <span class="st">"Cebolla"</span>, <span class="st">"Ajo"</span>, <span class="st">"Tomate"</span>)</span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (page <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">44</span>, <span class="dv">45</span>)) {</span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>      Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">"Departamento"</span>,<span class="st">"Años"</span>, <span class="st">"Arroz cáscara"</span>, <span class="st">"Maíz amiláceo"</span>,</span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Frijol grano seco**"</span>,<span class="st">"Frijol castlla"</span>, <span class="st">"Pallar"</span>,<span class="st">"Zarandaja"</span>,</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Frijol de palo"</span>, <span class="st">"Garbanzo"</span>,<span class="st">"Frijol loctao"</span>, <span class="st">"Lentaja"</span>, <span class="st">"Papa"</span>,</span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Trigo"</span>,<span class="st">"Plátano"</span>, <span class="st">"Algodón rama"</span>, <span class="st">"Maíz duro"</span>, <span class="st">"Soya"</span>,</span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Sorgo grano"</span>, <span class="st">"Caña de azúcar"</span>, <span class="st">"Café"</span>, <span class="st">"Espárrago"</span>, <span class="st">"Marigold"</span>)</span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (page <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">46</span>, <span class="dv">47</span>)) {</span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>      Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">"Departamento"</span>, <span class="st">"Años"</span>, <span class="st">"Cebada grano"</span>, <span class="st">"Quinua"</span>,<span class="st">"Cañihua"</span>,</span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Kiwicha"</span>,<span class="st">"Haba grano"</span>, <span class="st">"Arveja grano"</span>, <span class="st">"Chocho tarhui"</span>, <span class="st">"Olluco"</span>,</span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Oca"</span>, <span class="st">"Mashua"</span>, <span class="st">"Camote"</span>, <span class="st">"Yuca"</span>, <span class="st">"Cebolla"</span>, <span class="st">"Ajo"</span>, <span class="st">"Tomate"</span>)</span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (page <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">112</span>,<span class="dv">113</span>)) {</span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>      Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">"Departamento"</span>, <span class="st">"Año"</span>, <span class="st">"Arroz cáscara"</span>, <span class="st">"Maíz amiláceo"</span>,<span class="st">"Trigo"</span>,</span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Camote"</span>, <span class="st">"Papa"</span>, <span class="st">"Yuca"</span>, <span class="st">"Algodón rama"</span>, <span class="st">"Espárrago"</span>, <span class="st">"Maíz duro"</span>,</span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Marigold"</span>, <span class="st">"Soya"</span>, <span class="st">"Café"</span>)</span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (page <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">114</span>,<span class="dv">115</span>)) {</span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>      Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">"Departamento"</span>, <span class="st">"Año"</span>, <span class="st">"Ajo"</span>, <span class="st">"Cebolla"</span>, <span class="st">"Maíz Choclo"</span>, <span class="st">"Tomate"</span>,</span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Arveja grano"</span>, <span class="st">"Haba grano"</span>,<span class="st">"Limón"</span>, <span class="st">"Mandarina"</span>, <span class="st">"Manzana"</span>,</span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Naranja"</span>, <span class="st">"Papaya"</span>, <span class="st">"Palta"</span>, <span class="st">"Piña"</span>)</span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>    Cultures <span class="ot">&lt;-</span> Cultures[<span class="fu">order</span>(<span class="sc">-</span>Cultures<span class="sc">$</span>y), ]</span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>    Cultures<span class="sc">$</span>nomcomplet[<span class="dv">2</span>] <span class="ot">&lt;-</span></span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">str_detect</span>(Cultures<span class="sc">$</span>nomcomplet[<span class="dv">2</span>],<span class="st">"ña"</span>)) <span class="st">"Campaña"</span> <span class="cf">else</span> Cultures<span class="sc">$</span>nomcomplet[<span class="dv">2</span>]</span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Selection des donnees d'interet</span></span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>    Cultures <span class="ot">&lt;-</span>Cultures[, <span class="fu">c</span>(<span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"nomcomplet"</span>)]  <span class="sc">|&gt;</span></span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>        <span class="at">nomcomplet =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(nomcomplet,<span class="st">"Cañi"</span>)      <span class="sc">~</span> <span class="st">"Cañihua"</span>,</span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(nomcomplet,<span class="st">"seco"</span>)      <span class="sc">~</span> <span class="st">"Frijol grano seco**"</span>,</span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(nomcomplet,<span class="st">"paña"</span>)      <span class="sc">~</span> <span class="st">"Campaña"</span>,</span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(nomcomplet,<span class="st">"daja"</span>)      <span class="sc">~</span> <span class="st">"Zarandaja"</span>,</span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(nomcomplet,<span class="st">"duro"</span>)      <span class="sc">~</span>  <span class="st">"Maíz duro"</span>,</span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(nomcomplet,<span class="st">"banzo"</span>)     <span class="sc">~</span>  <span class="st">"Garbanzo"</span>,</span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(nomcomplet,<span class="st">"de azúcar"</span>) <span class="sc">~</span>  <span class="st">"Caña de azúcar"</span>,</span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(nomcomplet,<span class="st">"Kiwi"</span>)      <span class="sc">~</span>  <span class="st">"Kiwicha"</span>,</span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> nomcomplet</span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">duplicated</span>(nomcomplet)) <span class="sc">|&gt;</span></span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span> n <span class="sc">==</span>T ) <span class="sc">|&gt;</span></span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>n)</span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> m <span class="sc">&gt;</span> <span class="dv">6</span> <span class="sc">&amp;</span> page <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">38</span>, <span class="dv">39</span>) ) {</span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a>    Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"Departamento"</span>, <span class="st">"Años"</span>,<span class="st">"Total"</span>, <span class="st">"Arroz cáscara"</span>,    <span class="st">"Maíz amiláceo"</span>,</span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Frijol grano seco**"</span>,  <span class="st">"Frijol castlla"</span>,   <span class="st">"Pallar"</span>,   <span class="st">"Zarandaja"</span>,</span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Frijol de palo"</span>,   <span class="st">"Garbanzo"</span>, <span class="st">"Frijol loctao"</span>,    <span class="st">"Lenteja"</span>,  <span class="st">"Papa"</span>,</span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Trigo"</span>,    <span class="st">"Maíz duro"</span>,    <span class="st">"Soya"</span>, <span class="st">"Sorgo grano"</span>,  <span class="st">"Caña de azúcar"</span> )</span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (page <span class="sc">&gt;</span> <span class="dv">100</span>) {</span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (page <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">108</span>, <span class="dv">109</span>, <span class="dv">110</span>, <span class="dv">112</span>, <span class="dv">113</span>)) {</span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (isFrijol <span class="sc">==</span> T) {</span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a>        Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"Departamento"</span>, <span class="st">"Año"</span>, <span class="st">"Arroz cáscara"</span>, <span class="st">"Maíz amiláceo"</span>,</span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Trigo"</span>, <span class="st">"Frijol grano seco"</span>, <span class="st">"Camote"</span>, <span class="st">"Papa"</span>, <span class="st">"Yuca"</span>,</span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Algodón rama"</span>, <span class="st">"Espárrago"</span>, <span class="st">"Maíz duro"</span>,  <span class="st">"Marigold"</span>, <span class="st">"Soya"</span>,</span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Café"</span>)</span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>        Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"Departamento"</span>, <span class="st">"Año"</span>, <span class="st">"Arroz cáscara"</span>, <span class="st">"Maíz amiláceo"</span>,<span class="st">"Trigo"</span>,</span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Camote"</span>, <span class="st">"Papa"</span>, <span class="st">"Yuca"</span>, <span class="st">"Algodón rama"</span>, <span class="st">"Espárrago"</span>, <span class="st">"Maíz duro"</span>,</span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Marigold"</span>, <span class="st">"Soya"</span>, <span class="st">"Café"</span>)</span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (page <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">111</span>, <span class="dv">114</span>, <span class="dv">115</span>)) {</span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (isPlatano <span class="sc">==</span> T) {</span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a>        Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"Departamento"</span>, <span class="st">"Año"</span>, <span class="st">"Ajo"</span>, <span class="st">"Cebolla"</span>, <span class="st">"Maíz Choclo"</span>, <span class="st">"Tomate"</span>,</span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Arveja grano"</span>, <span class="st">"Haba grano"</span>,<span class="st">"Limón"</span>, <span class="st">"Mandarina"</span>, <span class="st">"Manzana"</span>,</span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Naranja"</span>, <span class="st">"Papaya"</span>, <span class="st">"Palta"</span>, <span class="st">"Piña"</span>,<span class="st">"Plátano"</span>)</span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a>        Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"Departamento"</span>, <span class="st">"Año"</span>, <span class="st">"Ajo"</span>, <span class="st">"Cebolla"</span>, <span class="st">"Maíz Choclo"</span>, <span class="st">"Tomate"</span>,</span>
<span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Arveja grano"</span>, <span class="st">"Haba grano"</span>,<span class="st">"Limón"</span>, <span class="st">"Mandarina"</span>, <span class="st">"Manzana"</span>,</span>
<span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Naranja"</span>, <span class="st">"Papaya"</span>, <span class="st">"Palta"</span>, <span class="st">"Piña"</span>)</span>
<span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (annee <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> mois <span class="sc">&lt;</span> <span class="dv">8</span> <span class="sc">&amp;</span> page <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">111</span>, <span class="dv">112</span>)) {</span>
<span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (isPlatano <span class="sc">==</span> T) {</span>
<span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a>        Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"Departamento"</span>, <span class="st">"Año"</span>, <span class="st">"Ajo"</span>, <span class="st">"Cebolla"</span>, <span class="st">"Maíz Choclo"</span>, <span class="st">"Tomate"</span>,</span>
<span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Arveja grano"</span>, <span class="st">"Haba grano"</span>,<span class="st">"Limón"</span>, <span class="st">"Mandarina"</span>, <span class="st">"Manzana"</span>,</span>
<span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Naranja"</span>, <span class="st">"Papaya"</span>, <span class="st">"Palta"</span>, <span class="st">"Piña"</span>,<span class="st">"Plátano"</span>)</span>
<span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a>        Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"Departamento"</span>, <span class="st">"Año"</span>, <span class="st">"Ajo"</span>, <span class="st">"Cebolla"</span>, <span class="st">"Maíz Choclo"</span>, <span class="st">"Tomate"</span>,</span>
<span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Arveja grano"</span>, <span class="st">"Haba grano"</span>,<span class="st">"Limón"</span>,<span class="st">"Mandarina"</span>, <span class="st">"Manzana"</span>,</span>
<span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Naranja"</span>, <span class="st">"Papaya"</span>, <span class="st">"Palta"</span>, <span class="st">"Piña"</span>)</span>
<span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span>}</span>
<span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (annee <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> mois <span class="sc">==</span> <span class="dv">7</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">110</span>) {</span>
<span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a>      Cultures <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(</span>
<span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">"Departamento"</span>, <span class="st">"Año"</span>, <span class="st">"Ajo"</span>, <span class="st">"Cebolla"</span>, <span class="st">"Maíz Choclo"</span>, <span class="st">"Tomate"</span>,</span>
<span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Arveja grano"</span>, <span class="st">"Haba grano"</span>,<span class="st">"Limón"</span>, <span class="st">"Mandarina"</span>, <span class="st">"Manzana"</span>,</span>
<span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Naranja"</span>, <span class="st">"Papaya"</span>, <span class="st">"Palta"</span>, <span class="st">"Piña"</span>,<span class="st">"Plátano"</span>)</span>
<span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-302"><a href="#cb3-302" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(Cultures) <span class="ot">&lt;-</span> <span class="st">"nomcomplet"</span></span>
<span id="cb3-303"><a href="#cb3-303" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-304"><a href="#cb3-304" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-305"><a href="#cb3-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-306"><a href="#cb3-306" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Downloading the table----</span></span>
<span id="cb3-307"><a href="#cb3-307" aria-hidden="true" tabindex="-1"></a>  tx <span class="ot">&lt;-</span> <span class="fu">pdf_text</span>(adresse)[[page]]</span>
<span id="cb3-308"><a href="#cb3-308" aria-hidden="true" tabindex="-1"></a>  tx2 <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">str_split</span>(tx, <span class="st">"[</span><span class="sc">\\</span><span class="st">r</span><span class="sc">\\</span><span class="st">n]+"</span>))</span>
<span id="cb3-309"><a href="#cb3-309" aria-hidden="true" tabindex="-1"></a>  tx3 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb3-310"><a href="#cb3-310" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_split_fixed</span>(<span class="fu">str_trim</span>(tx2), <span class="st">"</span><span class="sc">\\</span><span class="st">s{2,}"</span>, <span class="fu">dim</span>(Cultures)[<span class="dv">1</span>])</span>
<span id="cb3-311"><a href="#cb3-311" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-312"><a href="#cb3-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-313"><a href="#cb3-313" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replacing the name of the row "Cultures"</span></span>
<span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span>  <span class="fu">which</span>(<span class="fu">str_detect</span>(tx3<span class="sc">$</span>V1, Cell1))</span>
<span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a>  tx3[n, ] <span class="ot">&lt;-</span> Cultures<span class="sc">$</span>nomcomplet</span>
<span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">str_detect</span>(tx3[n <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">2</span>], <span class="st">"[:digit:]{4}|[:digit:]{2}[:punct:][:digit:]{2}"</span>) <span class="sc">==</span> F) {</span>
<span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a>    tx3 <span class="ot">&lt;-</span> tx3[<span class="sc">-</span>(n <span class="sc">+</span> <span class="dv">1</span>), ]</span>
<span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-320"><a href="#cb3-320" aria-hidden="true" tabindex="-1"></a>  tx3 <span class="ot">&lt;-</span> tx3[<span class="sc">-</span>(n <span class="sc">-</span> <span class="dv">1</span>), ]</span>
<span id="cb3-321"><a href="#cb3-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-322"><a href="#cb3-322" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(tx3<span class="sc">$</span>V1, <span class="st">"Estadística"</span>))) {</span>
<span id="cb3-323"><a href="#cb3-323" aria-hidden="true" tabindex="-1"></a>    tx3 <span class="ot">&lt;-</span> tx3[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">str_detect</span>(tx3<span class="sc">$</span>V1, <span class="st">"Estadística"</span>)), ]</span>
<span id="cb3-324"><a href="#cb3-324" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-325"><a href="#cb3-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-326"><a href="#cb3-326" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(tx3<span class="sc">$</span>V1, <span class="st">"cáscara"</span>))) {</span>
<span id="cb3-327"><a href="#cb3-327" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">str_detect</span>(tx3<span class="sc">$</span>V1, <span class="st">"cáscara"</span>))</span>
<span id="cb3-328"><a href="#cb3-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-329"><a href="#cb3-329" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">str_detect</span>(tx3[n<span class="dv">-1</span>,],<span class="st">"Arroz"</span>)) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb3-330"><a href="#cb3-330" aria-hidden="true" tabindex="-1"></a>      tx3[n<span class="dv">-1</span>,<span class="fu">which</span>(<span class="fu">str_detect</span>(tx3[n <span class="sc">-</span> <span class="dv">1</span>,],<span class="st">"Arroz"</span>))[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"Arroz cáscara"</span></span>
<span id="cb3-331"><a href="#cb3-331" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-332"><a href="#cb3-332" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">str_detect</span>(tx3[n<span class="dv">-1</span>,],<span class="st">"Maíz"</span>)) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb3-333"><a href="#cb3-333" aria-hidden="true" tabindex="-1"></a>      tx3[n<span class="dv">-1</span>,<span class="fu">which</span>(<span class="fu">str_detect</span>(tx3[n <span class="sc">-</span> <span class="dv">1</span>,],<span class="st">"Maíz"</span>))[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"Maíz amiláceo"</span></span>
<span id="cb3-334"><a href="#cb3-334" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-335"><a href="#cb3-335" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">str_detect</span>(tx3[n<span class="dv">-1</span>,],<span class="st">"Maíz"</span>)) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb3-336"><a href="#cb3-336" aria-hidden="true" tabindex="-1"></a>      tx3[n<span class="dv">-1</span>,<span class="fu">which</span>(<span class="fu">str_detect</span>(tx3[n <span class="sc">-</span> <span class="dv">1</span>, ],<span class="st">"Maíz"</span>))[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="st">"Maíz duro"</span></span>
<span id="cb3-337"><a href="#cb3-337" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-338"><a href="#cb3-338" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">str_detect</span>(tx3[n<span class="dv">-1</span>,],<span class="st">"Frijol"</span>)) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb3-339"><a href="#cb3-339" aria-hidden="true" tabindex="-1"></a>      tx3[n<span class="dv">-1</span>,<span class="fu">which</span>(<span class="fu">str_detect</span>(tx3[n <span class="sc">-</span> <span class="dv">1</span>, ],<span class="st">"Frijol"</span>))[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"Frijol grano seco"</span></span>
<span id="cb3-340"><a href="#cb3-340" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-341"><a href="#cb3-341" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">str_detect</span>(tx3[n<span class="dv">-1</span>,],<span class="st">"Frijol"</span>)) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb3-342"><a href="#cb3-342" aria-hidden="true" tabindex="-1"></a>      tx3[n<span class="dv">-1</span>,<span class="fu">which</span>(<span class="fu">str_detect</span>(tx3[n <span class="sc">-</span> <span class="dv">1</span>, ],<span class="st">"Frijol"</span>))[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="st">"Frijol castlla"</span></span>
<span id="cb3-343"><a href="#cb3-343" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-344"><a href="#cb3-344" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">str_detect</span>(tx3[n<span class="dv">-1</span>,],<span class="st">"Frijol"</span>)) <span class="sc">&gt;</span> <span class="dv">2</span>) {</span>
<span id="cb3-345"><a href="#cb3-345" aria-hidden="true" tabindex="-1"></a>      tx3[n<span class="dv">-1</span>,<span class="fu">which</span>(<span class="fu">str_detect</span>(tx3[n <span class="sc">-</span> <span class="dv">1</span>, ],<span class="st">"Frijol"</span>))[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="st">"Frijol de palo"</span></span>
<span id="cb3-346"><a href="#cb3-346" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-347"><a href="#cb3-347" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">str_detect</span>(tx3[n<span class="dv">-1</span>,],<span class="st">"Frijol"</span>)) <span class="sc">&gt;</span> <span class="dv">3</span>) {</span>
<span id="cb3-348"><a href="#cb3-348" aria-hidden="true" tabindex="-1"></a>      tx3[n<span class="dv">-1</span>,<span class="fu">which</span>(<span class="fu">str_detect</span>(tx3[n <span class="sc">-</span> <span class="dv">1</span>, ],<span class="st">"Frijol"</span>))[<span class="dv">4</span>]] <span class="ot">&lt;-</span> <span class="st">"Frijol loctao"</span></span>
<span id="cb3-349"><a href="#cb3-349" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-350"><a href="#cb3-350" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">str_detect</span>(tx3[n<span class="dv">-1</span>,],<span class="st">"Algodón"</span>)) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb3-351"><a href="#cb3-351" aria-hidden="true" tabindex="-1"></a>      tx3[n<span class="dv">-1</span>,<span class="fu">which</span>(<span class="fu">str_detect</span>(tx3[n <span class="sc">-</span> <span class="dv">1</span>, ],<span class="st">"Algodón"</span>))[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"Algodón rama"</span></span>
<span id="cb3-352"><a href="#cb3-352" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-353"><a href="#cb3-353" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">str_detect</span>(tx3[n<span class="dv">-1</span>,],<span class="st">"Sorgo"</span>)) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb3-354"><a href="#cb3-354" aria-hidden="true" tabindex="-1"></a>      tx3[n<span class="dv">-1</span>,<span class="fu">which</span>(<span class="fu">str_detect</span>(tx3[n <span class="sc">-</span> <span class="dv">1</span>, ],<span class="st">"Sorgo"</span>))[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"Sorgo grano"</span></span>
<span id="cb3-355"><a href="#cb3-355" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-356"><a href="#cb3-356" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">str_detect</span>(tx3[n<span class="dv">-1</span>,],<span class="st">"Caña"</span>)) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb3-357"><a href="#cb3-357" aria-hidden="true" tabindex="-1"></a>      tx3[n<span class="dv">-1</span>,<span class="fu">which</span>(<span class="fu">str_detect</span>(tx3[n <span class="sc">-</span> <span class="dv">1</span>, ],<span class="st">"Caña"</span>))[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"Caña de azúcar"</span></span>
<span id="cb3-358"><a href="#cb3-358" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-359"><a href="#cb3-359" aria-hidden="true" tabindex="-1"></a>    tx3 <span class="ot">&lt;-</span> tx3[<span class="sc">-</span>n, ]</span>
<span id="cb3-360"><a href="#cb3-360" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-361"><a href="#cb3-361" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (annee <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> mois <span class="sc">==</span> <span class="dv">1</span> ) {</span>
<span id="cb3-362"><a href="#cb3-362" aria-hidden="true" tabindex="-1"></a>    tx3 <span class="ot">&lt;-</span> tx3 <span class="sc">|&gt;</span></span>
<span id="cb3-363"><a href="#cb3-363" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb3-364"><a href="#cb3-364" aria-hidden="true" tabindex="-1"></a>        <span class="at">V1 =</span> <span class="fu">replace</span>(V1, V1<span class="sc">==</span> <span class="dv">2001</span>, <span class="dv">2002</span>),</span>
<span id="cb3-365"><a href="#cb3-365" aria-hidden="true" tabindex="-1"></a>        <span class="at">V1 =</span> <span class="fu">replace</span>(V1, V1<span class="sc">==</span> <span class="dv">2000</span>, <span class="dv">2001</span>),</span>
<span id="cb3-366"><a href="#cb3-366" aria-hidden="true" tabindex="-1"></a>        <span class="at">V2 =</span> <span class="fu">replace</span>(V2, V2<span class="sc">==</span> <span class="dv">2001</span>, <span class="dv">2002</span>),</span>
<span id="cb3-367"><a href="#cb3-367" aria-hidden="true" tabindex="-1"></a>        <span class="at">V2 =</span> <span class="fu">replace</span>(V2, V2<span class="sc">==</span> <span class="dv">2000</span>, <span class="dv">2001</span>)</span>
<span id="cb3-368"><a href="#cb3-368" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-369"><a href="#cb3-369" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-370"><a href="#cb3-370" aria-hidden="true" tabindex="-1"></a>  annee <span class="ot">&lt;-</span>  <span class="fu">ifelse</span>(</span>
<span id="cb3-371"><a href="#cb3-371" aria-hidden="true" tabindex="-1"></a>    annee <span class="sc">&lt;</span> <span class="dv">10</span>,</span>
<span id="cb3-372"><a href="#cb3-372" aria-hidden="true" tabindex="-1"></a>    <span class="at">yes =</span> <span class="fu">paste</span>(<span class="st">"200"</span>,annee, <span class="at">sep=</span><span class="st">""</span>),</span>
<span id="cb3-373"><a href="#cb3-373" aria-hidden="true" tabindex="-1"></a>    <span class="at">no =</span> <span class="fu">paste</span>(<span class="st">"20"</span>,annee, <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb3-374"><a href="#cb3-374" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-375"><a href="#cb3-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-376"><a href="#cb3-376" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(tx3<span class="sc">$</span>V1, <span class="fu">c</span>(<span class="st">"Total nacional 200|Andahuaylas 200"</span>)))) {</span>
<span id="cb3-377"><a href="#cb3-377" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">str_which</span>(</span>
<span id="cb3-378"><a href="#cb3-378" aria-hidden="true" tabindex="-1"></a>      tx3<span class="sc">$</span>V1,</span>
<span id="cb3-379"><a href="#cb3-379" aria-hidden="true" tabindex="-1"></a>      <span class="st">"(Total nacional) |(Huancavelica) |(Madre de Dios) |(Andahuaylas) [[:digit:]]{4}"</span></span>
<span id="cb3-380"><a href="#cb3-380" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-381"><a href="#cb3-381" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ii <span class="cf">in</span> n) {</span>
<span id="cb3-382"><a href="#cb3-382" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">dim</span>(Cultures)[<span class="dv">1</span>]<span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb3-383"><a href="#cb3-383" aria-hidden="true" tabindex="-1"></a>        tx3[ii, j] <span class="ot">&lt;-</span> tx3[ii, j <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb3-384"><a href="#cb3-384" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-385"><a href="#cb3-385" aria-hidden="true" tabindex="-1"></a>      text <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">str_split</span>(tx3[ii,<span class="dv">1</span>], <span class="st">"200"</span>))</span>
<span id="cb3-386"><a href="#cb3-386" aria-hidden="true" tabindex="-1"></a>      tx3[ii,<span class="dv">1</span>] <span class="ot">&lt;-</span> text[<span class="dv">1</span>,]</span>
<span id="cb3-387"><a href="#cb3-387" aria-hidden="true" tabindex="-1"></a>      tx3[ii,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"200"</span>, text[<span class="dv">2</span>,], <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb3-388"><a href="#cb3-388" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-389"><a href="#cb3-389" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-390"><a href="#cb3-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-391"><a href="#cb3-391" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">which</span>(</span>
<span id="cb3-392"><a href="#cb3-392" aria-hidden="true" tabindex="-1"></a>    tx3<span class="sc">$</span>V1 <span class="sc">==</span> <span class="fu">as.character</span>(<span class="fu">as.numeric</span>(annee)<span class="sc">-</span><span class="dv">1</span>) <span class="sc">|</span> tx3<span class="sc">$</span>V1 <span class="sc">==</span> <span class="fu">as.character</span>(<span class="fu">as.numeric</span>(annee)) <span class="sc">|</span></span>
<span id="cb3-393"><a href="#cb3-393" aria-hidden="true" tabindex="-1"></a>      tx3<span class="sc">$</span>V1 <span class="sc">==</span> <span class="fu">paste</span>(<span class="fu">str_sub</span>(<span class="fu">as.numeric</span>(annee) <span class="sc">-</span> <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="st">"-"</span>, <span class="fu">str_sub</span>(<span class="fu">as.numeric</span>(annee) <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|</span></span>
<span id="cb3-394"><a href="#cb3-394" aria-hidden="true" tabindex="-1"></a>      tx3<span class="sc">$</span>V1 <span class="sc">==</span> <span class="fu">paste</span>(<span class="fu">str_sub</span>(<span class="fu">as.numeric</span>(annee) <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="st">"-"</span>, <span class="fu">str_sub</span>(<span class="fu">as.numeric</span>(annee), <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|</span></span>
<span id="cb3-395"><a href="#cb3-395" aria-hidden="true" tabindex="-1"></a>      tx3<span class="sc">$</span>V1 <span class="sc">==</span> <span class="fu">paste</span>(<span class="fu">str_sub</span>(<span class="fu">as.numeric</span>(annee), <span class="dv">3</span>, <span class="dv">4</span>), <span class="st">"-"</span>, <span class="fu">str_sub</span>(<span class="fu">as.numeric</span>(annee) <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb3-396"><a href="#cb3-396" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-397"><a href="#cb3-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-398"><a href="#cb3-398" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ii <span class="cf">in</span> n) {</span>
<span id="cb3-399"><a href="#cb3-399" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">dim</span>(Cultures)[<span class="dv">1</span>]<span class="sc">:</span><span class="dv">2</span>) {</span>
<span id="cb3-400"><a href="#cb3-400" aria-hidden="true" tabindex="-1"></a>      tx3[ii, j] <span class="ot">&lt;-</span> tx3[ii, j <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb3-401"><a href="#cb3-401" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-402"><a href="#cb3-402" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(tx3[ii <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">==</span> Cell1, tx3[ii, <span class="dv">1</span>] <span class="ot">&lt;-</span></span>
<span id="cb3-403"><a href="#cb3-403" aria-hidden="true" tabindex="-1"></a>             tx3[ii <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">1</span>],  tx3[ii, <span class="dv">1</span>] <span class="ot">&lt;-</span> tx3[ii <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb3-404"><a href="#cb3-404" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-405"><a href="#cb3-405" aria-hidden="true" tabindex="-1"></a>  tx3</span>
<span id="cb3-406"><a href="#cb3-406" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Importing data where table is missing</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param y last digit of the year (20..)</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param mm month (numeric)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param type type of variable ("Production" for production, "Superficies_R"</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#'   for harvested surface, "Superficies" for planted surface)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>missing_table <span class="ot">&lt;-</span> <span class="cf">function</span>(y,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                          mm,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"Production"</span>, <span class="st">"Superficies_R"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Superficies"</span>)) {</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  data_mm <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (mm <span class="sc">==</span> <span class="dv">12</span>) {</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>      m_1 <span class="ot">&lt;-</span> mm <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>      y1  <span class="ot">&lt;-</span> y <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      year <span class="ot">&lt;-</span> <span class="dv">2000</span> <span class="sc">+</span> y</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>      year1 <span class="ot">&lt;-</span> <span class="dv">2000</span> <span class="sc">+</span> y <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"Production"</span>) {</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Production, m==12----</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># File name of the next year</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        file_name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>          <span class="st">"../data/raw/minagri/"</span>, type, <span class="st">"/"</span>, type, <span class="st">"_"</span>, year1, <span class="st">".xlsx"</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(mm, year1, ii <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        data_m_y1 <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_P_year_P</span>(</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m_y1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(m_1, year1, ii <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>        data_m_1_y1 <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_P_year_P</span>(</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m_1_y1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rename</span>(<span class="at">month_1 =</span> month) <span class="sc">|&gt;</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Current year</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>        file_name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>          <span class="st">"../data/raw/minagri/"</span>, type, <span class="st">"/"</span>, type, <span class="st">"_"</span>, year, <span class="st">".xlsx"</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(m_1, year, ii <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>        data_m_1_y <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_P_year_P</span>(</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m_1_y =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>        data_mm_y <span class="ot">&lt;-</span> <span class="fu">merge</span>(data_m_y1,data_m_1_y1) <span class="sc">|&gt;</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">diff =</span> value_m_y1 <span class="sc">-</span> value_m_1_y1) <span class="sc">|&gt;</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(region, product, diff) <span class="sc">|&gt;</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>          <span class="fu">merge</span>(data_m_1_y) <span class="sc">|&gt;</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_num =</span> value_m_1_y <span class="sc">+</span> diff) <span class="sc">|&gt;</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>diff, <span class="sc">-</span> value_m_1_y) <span class="sc">|&gt;</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">as.numeric</span>(month <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>          <span class="fu">relocate</span>(product, <span class="at">.after =</span> month)</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>        data_mm <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_mm, data_mm_y)</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"Superficies_R"</span>) {</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Superficies_R, m==12----</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Following year</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>        file_name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>          <span class="st">"../data/raw/minagri/Surface_R/"</span>, type, <span class="st">"_"</span>, year1, <span class="st">".xlsx"</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(mm,year1, ii <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>        data_m_y1 <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_year_SR</span>(</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m_y1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(m_1, year1, ii <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>        data_m_1_y1 <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_year_SR</span>(</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m_1_y1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rename</span>(<span class="at">month_1 =</span> month) <span class="sc">|&gt;</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Current year</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>        file_name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>          <span class="st">"../data/raw/minagri/Surface_R/"</span>, type, <span class="st">"_"</span>, year, <span class="st">".xlsx"</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(m_1, year, ii <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>        data_m_1_y <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_year_SR</span>(</span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span>)  <span class="sc">|&gt;</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m_1_y =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>        data_mm_y <span class="ot">&lt;-</span> <span class="fu">merge</span>(data_m_y1, data_m_1_y1) <span class="sc">|&gt;</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">diff =</span> value_m_y1 <span class="sc">-</span> value_m_1_y1) <span class="sc">|&gt;</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(region, product, diff) <span class="sc">|&gt;</span></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>          <span class="fu">merge</span>(data_m_1_y) <span class="sc">|&gt;</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_num =</span> value_m_1_y <span class="sc">+</span> diff) <span class="sc">|&gt;</span></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>diff, <span class="sc">-</span> value_m_1_y) <span class="sc">|&gt;</span></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">as.numeric</span>(month <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>          <span class="fu">relocate</span>(product, <span class="at">.after =</span> month)</span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>        data_mm <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_mm, data_mm_y)</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"Superficies"</span>) {</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Superficies, m==12----</span></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Following year</span></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>        file_name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>          <span class="st">"../data/raw/minagri/Surface/"</span>, type, <span class="st">"_"</span>, year1, <span class="st">".xlsx"</span></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(mm, year1, ii <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>        data_m_y1 <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_year_S</span>(</span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m_y1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(m_1, year1, ii <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>        data_m_1_y1 <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_year_S</span>(</span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m_1_y1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rename</span>(<span class="at">month_1 =</span> month) <span class="sc">|&gt;</span></span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Current year</span></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>        file_name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>          <span class="st">"../data/raw/minagri/Surface/"</span>, type, <span class="st">"_"</span>, year, <span class="st">".xlsx"</span></span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(m_1, year, ii <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>        data_m_1_y <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_year_S</span>(</span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>        )  <span class="sc">|&gt;</span></span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m_1_y =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a>        data_mm_y <span class="ot">&lt;-</span> <span class="fu">merge</span>(data_m_y1, data_m_1_y1) <span class="sc">|&gt;</span></span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">diff =</span> value_m_y1 <span class="sc">-</span> value_m_1_y1) <span class="sc">|&gt;</span></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(region, product, diff) <span class="sc">|&gt;</span></span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a>          <span class="fu">merge</span>(data_m_1_y) <span class="sc">|&gt;</span></span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_num =</span> value_m_1_y <span class="sc">+</span> diff) <span class="sc">|&gt;</span></span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>diff, <span class="sc">-</span> value_m_1_y) <span class="sc">|&gt;</span></span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">as.numeric</span>(month <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a>          <span class="fu">relocate</span>(product, <span class="at">.after =</span> month)</span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>        data_mm <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_mm, data_mm_y)</span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If m != 12</span></span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>      m_1 <span class="ot">&lt;-</span> mm <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>      m1  <span class="ot">&lt;-</span> mm <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>      year <span class="ot">&lt;-</span> <span class="dv">2000</span> <span class="sc">+</span> y</span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"Production"</span>) {</span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Production, m!=12----</span></span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a>        file_name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>          <span class="st">"../data/raw/minagri/"</span>, type, <span class="st">"/"</span>, type, <span class="st">"_"</span>, year, <span class="st">".xlsx"</span></span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a>        <span class="co"># previous month</span></span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_pad</span>(m_1, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a>          year,</span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a>          ii <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a>        data_m_1 <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_P_year_P</span>(</span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m_1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rename</span>(<span class="at">month_1 =</span> month) <span class="sc">|&gt;</span></span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a>        <span class="co"># following month</span></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_pad</span>(m1, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a>          year,</span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a>          ii <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a>        data_m1 <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_P_year_P</span>(</span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rename</span>(<span class="at">month1 =</span> month) <span class="sc">|&gt;</span></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"Superficies_R"</span>){</span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Superficies_R, m!=12----</span></span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>        file_name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a>          <span class="st">"../data/raw/minagri/Surface_R/"</span>, type,<span class="st">"_"</span>, year, <span class="st">".xlsx"</span></span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a>        <span class="co"># previous month</span></span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_pad</span>(m_1, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a>          year,</span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a>          ii <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a>        data_m_1 <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_year_SR</span>(</span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m_1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rename</span>(<span class="at">month_1 =</span> month) <span class="sc">|&gt;</span></span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a>        <span class="co"># following month</span></span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_pad</span>(m1, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a>          year,</span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a>          ii <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a>        data_m1 <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_year_SR</span>(</span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rename</span>(<span class="at">month1 =</span> month) <span class="sc">|&gt;</span></span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"Superficies"</span>) {</span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Superficies, m!=12----</span></span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a>        file_name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a>          <span class="st">"../data/raw/minagri/Surface/"</span>, type, <span class="st">"_"</span>, year, <span class="st">".xlsx"</span></span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a>        <span class="co"># previous month</span></span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_pad</span>(m_1, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true" tabindex="-1"></a>          year,</span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true" tabindex="-1"></a>          ii <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb4-273"><a href="#cb4-273" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-274"><a href="#cb4-274" aria-hidden="true" tabindex="-1"></a>        data_m_1 <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_year_S</span>(</span>
<span id="cb4-275"><a href="#cb4-275" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-276"><a href="#cb4-276" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-277"><a href="#cb4-277" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-278"><a href="#cb4-278" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-279"><a href="#cb4-279" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-280"><a href="#cb4-280" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m_1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-281"><a href="#cb4-281" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rename</span>(<span class="at">month_1 =</span> month) <span class="sc">|&gt;</span></span>
<span id="cb4-282"><a href="#cb4-282" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-283"><a href="#cb4-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-284"><a href="#cb4-284" aria-hidden="true" tabindex="-1"></a>        <span class="co"># following month</span></span>
<span id="cb4-285"><a href="#cb4-285" aria-hidden="true" tabindex="-1"></a>        sheet <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb4-286"><a href="#cb4-286" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_pad</span>(m1, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb4-287"><a href="#cb4-287" aria-hidden="true" tabindex="-1"></a>          year,</span>
<span id="cb4-288"><a href="#cb4-288" aria-hidden="true" tabindex="-1"></a>          ii <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb4-289"><a href="#cb4-289" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-290"><a href="#cb4-290" aria-hidden="true" tabindex="-1"></a>        data_m1 <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_year_S</span>(</span>
<span id="cb4-291"><a href="#cb4-291" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet_name =</span> sheet,</span>
<span id="cb4-292"><a href="#cb4-292" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> file_name,</span>
<span id="cb4-293"><a href="#cb4-293" aria-hidden="true" tabindex="-1"></a>          <span class="at">anneesup =</span> <span class="dv">0</span></span>
<span id="cb4-294"><a href="#cb4-294" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-295"><a href="#cb4-295" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb4-296"><a href="#cb4-296" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value_m1 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value))) <span class="sc">|&gt;</span></span>
<span id="cb4-297"><a href="#cb4-297" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rename</span>(<span class="at">month1 =</span> month) <span class="sc">|&gt;</span></span>
<span id="cb4-298"><a href="#cb4-298" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb4-299"><a href="#cb4-299" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-300"><a href="#cb4-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-301"><a href="#cb4-301" aria-hidden="true" tabindex="-1"></a>      data_mm_y <span class="ot">&lt;-</span> <span class="fu">merge</span>(data_m1,data_m_1) <span class="sc">|&gt;</span></span>
<span id="cb4-302"><a href="#cb4-302" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb4-303"><a href="#cb4-303" aria-hidden="true" tabindex="-1"></a>          <span class="at">month =</span> <span class="fu">as.numeric</span>(month_1 <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb4-304"><a href="#cb4-304" aria-hidden="true" tabindex="-1"></a>          <span class="at">value_num =</span> (value_m1 <span class="sc">-</span> value_m_1) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> value_m_1) <span class="sc">|&gt;</span></span>
<span id="cb4-305"><a href="#cb4-305" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span>value_m1, <span class="sc">-</span>month1, <span class="sc">-</span>value_m_1, <span class="sc">-</span>month_1) <span class="sc">|&gt;</span></span>
<span id="cb4-306"><a href="#cb4-306" aria-hidden="true" tabindex="-1"></a>        <span class="fu">relocate</span>(product, <span class="at">.after =</span> month)</span>
<span id="cb4-307"><a href="#cb4-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-308"><a href="#cb4-308" aria-hidden="true" tabindex="-1"></a>      data_mm <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_mm, data_mm_y)</span>
<span id="cb4-309"><a href="#cb4-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-310"><a href="#cb4-310" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-311"><a href="#cb4-311" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-312"><a href="#cb4-312" aria-hidden="true" tabindex="-1"></a>  data_mm</span>
<span id="cb4-313"><a href="#cb4-313" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="load-data"><span class="header-section-number">2.1.2</span> Load Data</h3>
<p>We define a function to format the header of the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Format header (removing unecessary values)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x (vector) of string</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>format_header <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(x))) {</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">""</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(x, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.{3}"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_remove</span>(<span class="st">"[[:digit:]]/"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_c</span>(<span class="at">collapse =</span> <span class="st">" "</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_to_lower</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"[[:blank:]]{2,}"</span>, <span class="st">" "</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_remove</span>(<span class="st">"- "</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_trim</span>()</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="regional-production" class="level4" data-number="2.1.2.1">
<h4 data-number="2.1.2.1" class="anchored" data-anchor-id="regional-production"><span class="header-section-number">2.1.2.1</span> Regional Production</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Import monthly regional agricultural values from the Excel file,</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' for a given month</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param sheet_name name of the Excel sheet</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param file path to the Excel File</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param anneesup </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>import_monthly_regional_values_P_year_P <span class="ot">&lt;-</span> <span class="cf">function</span>(sheet_name,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                                                    file,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                                                    anneesup) {</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The first two digits of the name: month</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the next four: the four digits of the year</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># last digit: index of the sheet for a given month and</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># year (we will not use it)</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  year  <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(sheet_name, <span class="dv">3</span>, <span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  month <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(sheet_name, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  tmp   <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_excel</span>(</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">path =</span> file,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">sheet =</span> sheet_name,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">col_types =</span> <span class="st">"text"</span>, <span class="at">n_max =</span> <span class="dv">15</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We can use the first occurrence of "Años" to determine</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the beginning of the table</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  ind_row_year <span class="ot">&lt;-</span> <span class="fu">str_which</span>(tmp[[<span class="dv">3</span>]], <span class="fu">regex</span>(<span class="st">"años?"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">first</span>()</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The first row of the header of the table is contained in the previous line</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  skip_head <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(year <span class="sc">&gt;=</span> <span class="dv">2008</span>,ind_row_year ,ind_row_year<span class="dv">-1</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  skip_head <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(year <span class="sc">==</span> <span class="dv">2008</span> <span class="sc">&amp;</span> month <span class="sc">&lt;</span> <span class="dv">3</span>, skip_head <span class="sc">-</span><span class="dv">1</span> ,skip_head)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The body of the table</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  prod_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressMessages</span>(</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_excel</span>(</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">path =</span> file,</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">sheet =</span> sheet_name,</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_types =</span> <span class="st">"text"</span>, <span class="at">skip =</span> skip_head, <span class="at">col_names =</span> F</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span> <span class="fu">where</span>( </span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>        <span class="sc">~</span> <span class="fu">all</span>(<span class="fu">is.na</span>(.))</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  header_1 <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_excel</span>(</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">path =</span> file,</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">sheet =</span> sheet_name,</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">skip =</span> skip_head<span class="dv">-2</span>, <span class="at">n_max =</span> <span class="dv">3</span>, <span class="at">col_names =</span> F</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span> <span class="fu">where</span>( </span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>        <span class="sc">~</span> <span class="fu">all</span>(<span class="fu">is.na</span>(.))</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  header_2 <span class="ot">&lt;-</span> header_1 <span class="sc">|&gt;</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">across</span>(</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">.cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">format_header</span>(.x)</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(prod_region_tmp) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(header_2)</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">colnames</span>(prod_region_tmp)[<span class="dv">2</span>] <span class="sc">==</span> <span class="st">""</span>) {</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(prod_region_tmp)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"departamento"</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(<span class="fu">colnames</span>(prod_region_tmp), <span class="st">"departamento"</span>), <span class="at">na.rm =</span> T)) {</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>    ind_dep_current <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">str_detect</span>(<span class="fu">colnames</span>(prod_region_tmp), <span class="st">"departamento"</span>))</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(prod_region_tmp)[ind_dep_current] <span class="ot">&lt;-</span> <span class="st">"departamento"</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing columns with no name</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>  ind <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">colnames</span>(prod_region_tmp)) <span class="sc">&amp;</span> (<span class="fu">colnames</span>(prod_region_tmp) <span class="sc">!=</span> <span class="st">""</span>)</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>  prod_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!!!</span><span class="fu">colnames</span>(prod_region_tmp)[ind])</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing rows with all NAs</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>  prod_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter_all</span>(<span class="fu">any_vars</span>(<span class="sc">!</span><span class="fu">is.na</span>(.)))</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing rows where "Continúa" is found</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>  prod_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter_all</span>(</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>      <span class="fu">any_vars</span>(</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">str_detect</span>(., <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"Continúa"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing the first colomn if row index</span></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(<span class="fu">colnames</span>(prod_region_tmp)[<span class="dv">1</span>], <span class="st">"[aeiou]"</span>) <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp <span class="ot">&lt;-</span> prod_region_tmp[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The name of the first column differs accross sheets (departemento or region)</span></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>  name_first_col <span class="ot">&lt;-</span> <span class="fu">colnames</span>(prod_region_tmp)[<span class="dv">1</span>]</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">&lt;</span> <span class="dv">2015</span>) {</span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span> name_first_col <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"departamento"</span>, <span class="st">"región"</span>)) {</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">str_c</span>(<span class="st">"Issue with sheet: "</span>, sheet_name))</span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>  prod_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">region :=</span> <span class="sc">!!</span>name_first_col)</span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(<span class="fu">colnames</span>(prod_region_tmp), <span class="st">"^año$"</span>))) {</span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>      prod_region_tmp <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">year =</span> año)</span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>      prod_region_tmp <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">year =</span> años)</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>  prod_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), <span class="sc">!</span> year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Años"</span>, <span class="st">"Año"</span>))</span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The sheet may contain values for the department Cajamarca</span></span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>  <span class="co"># AND the capital of that department named also Cajamarca</span></span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>  prod_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(region, year) <span class="sc">|&gt;</span></span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>      <span class="at">region =</span> <span class="fu">ifelse</span>(</span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>        region <span class="sc">==</span> <span class="st">"Cajamarca"</span> <span class="sc">&amp;</span> <span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"Cajamarca_R"</span>,</span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> region</span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>  prod_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>      <span class="at">region =</span> <span class="fu">ifelse</span>(region <span class="sc">==</span> <span class="st">"Lima provincias"</span>, <span class="at">yes =</span> <span class="st">"Lima"</span>, <span class="at">no =</span> region)</span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The production of each product is given in two rows, but the product name</span></span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a>  <span class="co"># is not repeated</span></span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a>  prod_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fill</span>(region, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">==</span> <span class="dv">2005</span>) {</span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp<span class="sc">$</span>region[<span class="dv">1</span>]<span class="ot">&lt;-</span> <span class="st">"Total Nacional"</span></span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing sub-regional data</span></span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a>  prod_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span> region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cajamarca"</span>, <span class="st">"Chota"</span>, <span class="st">"Jaén"</span>,</span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Abancay"</span>,<span class="st">"Andahuaylas"</span>)</span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">==</span> <span class="dv">2015</span> <span class="sc">&amp;</span> <span class="fu">any</span>(<span class="fu">colnames</span>(prod_region_tmp) <span class="sc">==</span> <span class="st">"región"</span>)) {</span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a>    q <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(prod_region_tmp) <span class="sc">==</span> <span class="st">"región"</span>)</span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (q <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a>      prod_region_tmp <span class="ot">&lt;-</span> prod_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(q))</span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a>  resul <span class="ot">&lt;-</span></span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a>    prod_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(region, year), <span class="at">names_to =</span> <span class="st">"product"</span>)</span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (anneesup <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a>    resul <span class="ot">&lt;-</span></span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a>      resul <span class="sc">|&gt;</span></span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">max</span>(year))</span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keeping only the last year available</span></span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a>    resul <span class="ot">&lt;-</span></span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a>      resul <span class="sc">|&gt;</span></span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">min</span>(year))</span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a>  resul <span class="ot">&lt;-</span></span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a>    resul <span class="sc">|&gt;</span></span>
<span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"arveja gr. seco"</span>, <span class="at">yes =</span> <span class="st">"arveja grano seco"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"frijol grano seco**"</span>, <span class="at">yes =</span> <span class="st">"frijol grano seco"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"frijol palo"</span>, <span class="at">yes =</span> <span class="st">"frijol de palo"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"frijol castlla"</span>, <span class="at">yes =</span> <span class="st">"frijol castilla"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"lentaja"</span>, <span class="at">yes =</span> <span class="st">"lenteja"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"frijol gr. seco"</span>, <span class="at">yes =</span> <span class="st">"frijol grano seco"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"haba gr. seco"</span>, <span class="at">yes =</span> <span class="st">"haba grano seco"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"maíz a. duro"</span>, <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"arveja gr. verde"</span>, <span class="at">yes =</span> <span class="st">"arveja grano verde"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"arveja gr. verde"</span>, <span class="at">yes =</span> <span class="st">"arveja grano verde"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"haba gr. verde"</span>, <span class="at">yes =</span> <span class="st">"haba grano verde"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"espá-rrago"</span>, <span class="at">yes =</span> <span class="st">"espárrago"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"manda-rina"</span>, <span class="at">yes =</span> <span class="st">"mandarina"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"maíz duro"</span>, <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"maíz am. duro"</span>, <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"pallar gr. seco"</span>, <span class="at">yes =</span> <span class="st">"pallar grano seco"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"pallar seco"</span>, <span class="at">yes =</span> <span class="st">"pallar grano seco"</span>, <span class="at">no =</span> product),</span>
<span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(product <span class="sc">==</span> <span class="st">"maíz amarillo duro"</span>, <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>, <span class="at">no =</span> product)</span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a>  resul <span class="sc">|&gt;</span></span>
<span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">month =</span> month) <span class="sc">|&gt;</span></span>
<span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(region, year, month, product, value)</span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a>}<span class="co"># End of import_monthly_regional_values_P_year_P()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Import monthly regional agricultural values from the Excel file,</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' for all the months of the file.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param file path to the Excel File</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param anneesup </span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param timescale</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>import_monthly_regional_values_P <span class="ot">&lt;-</span> <span class="cf">function</span>(file,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                                             anneesup,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                                             timescale) {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  sheet_names <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(file)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  prod_region_monthly <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    sheet_names,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    import_monthly_regional_values_P_year_P,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> file,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">anneesup =</span> anneesup</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list_rbind</span>()</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cleaning years and changing type of values: from str to num</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  prod_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    prod_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">value_num =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value)),</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">month =</span> <span class="fu">as.numeric</span>(month)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Values in 2014 to 2016 are expressed in thousands of tonnes</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># These need to be expressed in tonnes</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  prod_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    prod_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">value_num =</span> <span class="fu">ifelse</span>(year <span class="sc">%in%</span> <span class="dv">2014</span><span class="sc">:</span><span class="dv">2015</span>, value_num <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>, value_num)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># In addition, for the `Production_2014.xlsx` file, months 10 to 12</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># report values in thousands of tonnes as well</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Production_2014.xlsx$"</span>)) {</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    prod_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>      prod_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">value_num =</span> <span class="fu">ifelse</span>(</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>          month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>),</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>          <span class="at">yes =</span> value_num <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>,</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>          <span class="at">no =</span> value_num</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing the `value` columns to keep only the column with numerical values</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>  prod_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    prod_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Production_2002.xlsx$"</span>)) {</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>)) {</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">missing_table</span>(<span class="at">y =</span> <span class="dv">2</span>, <span class="at">mm =</span> i, <span class="at">type =</span> <span class="st">"Production"</span>)</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>      prod_region_monthly <span class="ot">&lt;-</span> <span class="fu">rbind</span>(prod_region_monthly, temp)</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Production_2003.xlsx$"</span>)) {</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>    temp <span class="ot">&lt;-</span> <span class="fu">missing_table</span>(<span class="at">y =</span> <span class="dv">3</span>, <span class="at">mm =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"Production"</span>)</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    prod_region_monthly <span class="ot">&lt;-</span> <span class="fu">rbind</span>(prod_region_monthly, temp)</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="co">#   if (str_detect(file, "Production_2008.xlsx$")) {</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Problem with value in June 2007 for Cassava: same value as in May</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Let us put the value for June as NA</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a><span class="co">#     # (For some regions)</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a><span class="co">#     prod_region_monthly &lt;-</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a><span class="co">#       prod_region_monthly |&gt;</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a><span class="co">#       mutate(</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a><span class="co">#         value_num = ifelse(</span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a><span class="co">#           month == 6 &amp; product == "yuca" &amp; region %in% c(</span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="co">#             "Apurímac", "Arequipa", "Ayacucho", "Cusco", "Huancavelica",</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="co">#             "Junín", "Loreto", "Madre de Dios", "Moquegua", "Moquegua",</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a><span class="co">#             "Puno", "San Martín", "Tacna", "Ucayali"),</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a><span class="co">#           yes = NA,</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a><span class="co">#           no = value_num</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a><span class="co">#             )</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a><span class="co">#       )</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cleaning region names</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prod_region_monthly$region |&gt; unique() |&gt; sort()</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>  prod_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>    prod_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">replace</span>(region, region<span class="sc">==</span><span class="st">"Apurimac"</span>, <span class="st">"Apurímac"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">replace</span>(region, region<span class="sc">==</span><span class="st">"Cajamarca_R"</span>, <span class="st">"Cajamarca"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">replace</span>(</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> region,</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>      <span class="at">list =</span> region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Nacional"</span>, <span class="st">"Total nacional"</span>, <span class="st">"TOTAL NACIONAL"</span>),</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="st">"Total Nacional"</span>)</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span> product <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Production_201(4|5).xlsx"</span>)) {</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>    prod_region_monthly <span class="ot">&lt;-</span> prod_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>        <span class="at">product =</span> <span class="fu">case_when</span>(</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"arroz"</span>)            <span class="sc">~</span>  <span class="st">"arroz cáscara"</span>,</span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"banano"</span>)           <span class="sc">~</span>  <span class="st">"plátano"</span>,</span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"café"</span>)             <span class="sc">~</span>  <span class="st">"café"</span>,</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"banano"</span>)           <span class="sc">~</span>  <span class="st">"plátano"</span>,</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"caña"</span>)             <span class="sc">~</span>  <span class="st">"caña de azúcar"</span>,</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"chocho"</span>)           <span class="sc">~</span>  <span class="st">"chocho"</span>,</span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"gar"</span>)              <span class="sc">~</span>  <span class="st">"garbanzo"</span>,</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"caña"</span>)             <span class="sc">~</span>  <span class="st">"caña de azúcar"</span>,</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"algodón"</span>)          <span class="sc">~</span>  <span class="st">"algodón rama"</span>,</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz amilaceo"</span>)    <span class="sc">~</span>  <span class="st">"maíz amiláceo"</span>,</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz amílaceo"</span>)    <span class="sc">~</span>  <span class="st">"maíz amiláceo"</span>,</span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"caña de azúcar para azúcar"</span>)   <span class="sc">~</span>  <span class="st">"caña de azúcar"</span>,</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"arveja seca"</span>)      <span class="sc">~</span>  <span class="st">"arveja grano seco"</span>,</span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"arveja verde"</span>)     <span class="sc">~</span>  <span class="st">"arveja grano verde"</span>,</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"loctao"</span>)           <span class="sc">~</span>  <span class="st">"frijol loctao"</span>,</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"frijol seco"</span>)      <span class="sc">~</span>  <span class="st">"frijol grano seco"</span>,</span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"frijol castill"</span>)   <span class="sc">~</span>  <span class="st">"frijol castilla"</span>,</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba seca"</span>)        <span class="sc">~</span>  <span class="st">"haba grano seco"</span>,</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba seco"</span>)        <span class="sc">~</span>  <span class="st">"haba grano seco"</span>,</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba verde"</span>)       <span class="sc">~</span>  <span class="st">"haba grano verde"</span>,</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"limón sutil"</span>)      <span class="sc">~</span>  <span class="st">"limón"</span>,</span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba verde"</span>)       <span class="sc">~</span>  <span class="st">"haba grano verde"</span>,</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"algodón rama"</span>)     <span class="sc">~</span>  <span class="st">"algodón rama"</span>,</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"café"</span>)             <span class="sc">~</span>  <span class="st">"café"</span>,</span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"cañihua"</span>)          <span class="sc">~</span>  <span class="st">"cañihua"</span>,</span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"espárrago"</span>)        <span class="sc">~</span>  <span class="st">"espárrago"</span>,</span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"limón"</span>)            <span class="sc">~</span>  <span class="st">"limón"</span>,</span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz amiláceo"</span>)    <span class="sc">~</span>  <span class="st">"maíz amiláceo"</span>,</span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz choclo"</span>)      <span class="sc">~</span>  <span class="st">"maíz choclo"</span>,</span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"piña"</span>)             <span class="sc">~</span>  <span class="st">"piña"</span>,</span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"zaran-daja"</span>)       <span class="sc">~</span>  <span class="st">"zarandaja"</span>,</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> product</span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a>  Production <span class="ot">&lt;-</span> prod_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(region, product, <span class="fu">desc</span>(month)) <span class="sc">|&gt;</span></span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value_num =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value_num), <span class="at">yes =</span> <span class="dv">0</span>, <span class="at">no =</span> value_num))</span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Production_2008.xlsx$"</span>)) {</span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Problem with value in June 2007 for Cassava: same value as in May</span></span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let us put the value for June as NA</span></span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (For some regions)</span></span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a>    Production <span class="ot">&lt;-</span></span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a>      Production <span class="sc">|&gt;</span></span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a>        <span class="at">value_num =</span> <span class="fu">ifelse</span>(</span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a>          month <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> product <span class="sc">==</span> <span class="st">"yuca"</span> <span class="sc">&amp;</span> region <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Apurímac"</span>, <span class="st">"Arequipa"</span>, <span class="st">"Ayacucho"</span>, <span class="st">"Cusco"</span>, <span class="st">"Huancavelica"</span>,</span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Junín"</span>, <span class="st">"Loreto"</span>, <span class="st">"Madre de Dios"</span>, <span class="st">"Moquegua"</span>, <span class="st">"Moquegua"</span>,</span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Puno"</span>, <span class="st">"San Martín"</span>, <span class="st">"Tacna"</span>, <span class="st">"Ucayali"</span>),</span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a>          <span class="at">yes =</span> <span class="cn">NA</span>,</span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a>          <span class="at">no =</span> value_num</span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a>  Production <span class="ot">&lt;-</span> Production <span class="sc">|&gt;</span></span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> month, <span class="at">values_from =</span> value_num)</span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (timescale <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The production data in the file is a cumulative sum over the months</span></span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a>    Production <span class="ot">&lt;-</span></span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(</span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],</span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">4</span><span class="sc">:</span><span class="dv">14</span>] <span class="sc">-</span> Production[<span class="dv">5</span><span class="sc">:</span><span class="dv">15</span>],</span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">15</span>]</span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(region, year, product), <span class="at">names_to =</span> <span class="st">"month"</span>)</span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a>    Production  <span class="ot">&lt;-</span></span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a>      Production[<span class="fu">with</span>(Production, <span class="fu">order</span>(region, year, <span class="fu">as.numeric</span>(month), product, value)), ]</span>
<span id="cb7-179"><a href="#cb7-179" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-180"><a href="#cb7-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-181"><a href="#cb7-181" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (timescale <span class="sc">==</span> <span class="dv">3</span>) {</span>
<span id="cb7-182"><a href="#cb7-182" aria-hidden="true" tabindex="-1"></a>    Production <span class="ot">&lt;-</span></span>
<span id="cb7-183"><a href="#cb7-183" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(</span>
<span id="cb7-184"><a href="#cb7-184" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],</span>
<span id="cb7-185"><a href="#cb7-185" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">4</span>] <span class="sc">-</span> Production[<span class="dv">7</span>],</span>
<span id="cb7-186"><a href="#cb7-186" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">7</span>] <span class="sc">-</span> Production[<span class="dv">10</span>],</span>
<span id="cb7-187"><a href="#cb7-187" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">10</span>] <span class="sc">-</span> Production[<span class="dv">13</span>],</span>
<span id="cb7-188"><a href="#cb7-188" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">13</span>]</span>
<span id="cb7-189"><a href="#cb7-189" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb7-190"><a href="#cb7-190" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(region, year, product), <span class="at">names_to =</span> <span class="st">"trim"</span>)</span>
<span id="cb7-191"><a href="#cb7-191" aria-hidden="true" tabindex="-1"></a>    Production  <span class="ot">&lt;-</span></span>
<span id="cb7-192"><a href="#cb7-192" aria-hidden="true" tabindex="-1"></a>      Production[<span class="fu">with</span>(Production, <span class="fu">order</span>(region, year, <span class="fu">as.numeric</span>(trim), product, value)), ]</span>
<span id="cb7-193"><a href="#cb7-193" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-194"><a href="#cb7-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-195"><a href="#cb7-195" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (timescale <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb7-196"><a href="#cb7-196" aria-hidden="true" tabindex="-1"></a>    Production <span class="ot">&lt;-</span></span>
<span id="cb7-197"><a href="#cb7-197" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(</span>
<span id="cb7-198"><a href="#cb7-198" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],</span>
<span id="cb7-199"><a href="#cb7-199" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">4</span>] <span class="sc">-</span> Production[<span class="dv">8</span>],</span>
<span id="cb7-200"><a href="#cb7-200" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">8</span>] <span class="sc">-</span> Production[<span class="dv">12</span>],</span>
<span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">12</span>]</span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb7-203"><a href="#cb7-203" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(region, year, product), <span class="at">names_to =</span> <span class="st">"quadrim"</span>)</span>
<span id="cb7-204"><a href="#cb7-204" aria-hidden="true" tabindex="-1"></a>    Production  <span class="ot">&lt;-</span></span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a>      Production[<span class="fu">with</span>(Production, <span class="fu">order</span>(region, year, <span class="fu">as.numeric</span>(quadrim), product, value)), ]</span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (timescale <span class="sc">==</span> <span class="dv">6</span>) {</span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a>    Production <span class="ot">&lt;-</span></span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(</span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],</span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">4</span>] <span class="sc">-</span> Production[<span class="dv">10</span>],</span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a>        Production[<span class="dv">10</span>]</span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb7-215"><a href="#cb7-215" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(region, year, product), <span class="at">names_to =</span> <span class="st">"biannual"</span>)</span>
<span id="cb7-216"><a href="#cb7-216" aria-hidden="true" tabindex="-1"></a>    Production  <span class="ot">&lt;-</span></span>
<span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a>      Production[<span class="fu">with</span>(Production, <span class="fu">order</span>(region, year, <span class="fu">as.numeric</span>(biannual), product, value)), ]</span>
<span id="cb7-218"><a href="#cb7-218" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-219"><a href="#cb7-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-220"><a href="#cb7-220" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (timescale <span class="sc">==</span> <span class="dv">12</span>) {</span>
<span id="cb7-221"><a href="#cb7-221" aria-hidden="true" tabindex="-1"></a>    Production <span class="ot">&lt;-</span></span>
<span id="cb7-222"><a href="#cb7-222" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(Production[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], Production[<span class="dv">4</span>]) <span class="sc">|&gt;</span></span>
<span id="cb7-223"><a href="#cb7-223" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">Prod_annual =</span> <span class="st">"12"</span>)</span>
<span id="cb7-224"><a href="#cb7-224" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-225"><a href="#cb7-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-226"><a href="#cb7-226" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Production_2015.xlsx$"</span>)) {</span>
<span id="cb7-227"><a href="#cb7-227" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(timescale <span class="sc">==</span> <span class="dv">12</span>) {</span>
<span id="cb7-228"><a href="#cb7-228" aria-hidden="true" tabindex="-1"></a>      Production <span class="ot">&lt;-</span> Production <span class="sc">|&gt;</span></span>
<span id="cb7-229"><a href="#cb7-229" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Prod_annual))</span>
<span id="cb7-230"><a href="#cb7-230" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb7-231"><a href="#cb7-231" aria-hidden="true" tabindex="-1"></a>      Production <span class="ot">&lt;-</span> Production <span class="sc">|&gt;</span></span>
<span id="cb7-232"><a href="#cb7-232" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value))</span>
<span id="cb7-233"><a href="#cb7-233" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-234"><a href="#cb7-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-235"><a href="#cb7-235" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-236"><a href="#cb7-236" aria-hidden="true" tabindex="-1"></a>  Production</span>
<span id="cb7-237"><a href="#cb7-237" aria-hidden="true" tabindex="-1"></a>}<span class="co"># End of import_monthly_regional_values_P()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="regional-planted-surface" class="level4" data-number="2.1.2.2">
<h4 data-number="2.1.2.2" class="anchored" data-anchor-id="regional-planted-surface"><span class="header-section-number">2.1.2.2</span> Regional Planted Surface</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Import monthly regional agricultural values from the Excel file,</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' for a given month</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param sheet_name name of the Excel sheet</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param file path to the Excel File</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param anneesup</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>import_monthly_regional_values_year_S <span class="ot">&lt;-</span> <span class="cf">function</span>(sheet_name,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                                                  file,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                                                  anneesup) {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The first two digits of the name: month</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the next four: the four digits of the year</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># last digit: index of the sheet for a given month and year (we will note use it)</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  month <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(sheet_name, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  year  <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(sheet_name, <span class="dv">3</span>, <span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  tmp   <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_excel</span>(</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">path =</span> file,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">sheet =</span> sheet_name,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">col_types =</span> <span class="st">"text"</span>, <span class="at">n_max =</span> <span class="dv">15</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We can use the first occurrence of "Campaña" to determine the beginning of the table</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  ind_row_year <span class="ot">&lt;-</span> <span class="fu">str_which</span>(tmp[[<span class="dv">3</span>]], <span class="fu">regex</span>(<span class="st">"Cam?"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">first</span>()</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sheet_name <span class="sc">==</span> <span class="st">"062015"</span>) {ind_row_year <span class="ot">&lt;-</span>  <span class="dv">7</span>}</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The first row of the header of the table is contained in the previous line</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  skip_head <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">&gt;=</span> <span class="dv">2008</span>,</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    ind_row_year <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    ind_row_year</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The body of the table</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  sup_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressMessages</span>(</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_excel</span>(</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">path =</span> file,</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">sheet =</span> sheet_name,</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_types =</span> <span class="st">"text"</span>, <span class="at">skip =</span> skip_head, <span class="at">col_names =</span> F</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span> <span class="fu">where</span>( </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        <span class="sc">~</span> <span class="fu">all</span>(</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>          <span class="fu">is.na</span>(.)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  ind_row_year2 <span class="ot">&lt;-</span> </span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_which</span>(tmp[[<span class="dv">2</span>]], <span class="fu">regex</span>(<span class="st">"Total?"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">first</span>()</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  nmax <span class="ot">=</span> <span class="fu">ifelse</span>(ind_row_year2 <span class="sc">-</span> ind_row_year <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>  header_1 <span class="ot">&lt;-</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressMessages</span>(</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_excel</span>(</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">path =</span> file,</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">sheet =</span> sheet_name,</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">skip =</span> skip_head<span class="sc">-</span> <span class="dv">1</span>, <span class="at">n_max =</span> nmax, <span class="at">col_names =</span> F</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span> <span class="fu">where</span>( </span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>        <span class="sc">~</span> <span class="fu">all</span>(</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>          <span class="fu">is.na</span>(.)</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Superficies_2016.xlsx$"</span>)) {</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>    header_1 <span class="ot">&lt;-</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressMessages</span>(</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">read_excel</span>(</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>          <span class="at">path =</span> file,</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet =</span> sheet_name,</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>          <span class="at">skip =</span> skip_head<span class="dv">-1</span>, <span class="at">n_max =</span> <span class="dv">1</span>, <span class="at">col_names =</span> F</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>  header_2 <span class="ot">&lt;-</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>    header_1 <span class="sc">|&gt;</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">across</span>(</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">.cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">format_header</span>(.x)</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(sup_region_tmp) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(header_2)</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">colnames</span>(sup_region_tmp)[<span class="dv">2</span>] <span class="sc">==</span> <span class="st">""</span>){</span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(sup_region_tmp)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"departamento"</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(<span class="fu">colnames</span>(sup_region_tmp), <span class="st">"departamento"</span>), <span class="at">na.rm =</span> T)) {</span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>    ind_dep_current <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">str_detect</span>(<span class="fu">colnames</span>(sup_region_tmp), <span class="st">"departamento"</span>))</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(sup_region_tmp)[ind_dep_current] <span class="ot">&lt;-</span> <span class="st">"departamento"</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing columns with no name</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>  ind <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">colnames</span>(sup_region_tmp)) <span class="sc">&amp;</span> (<span class="fu">colnames</span>(sup_region_tmp) <span class="sc">!=</span> <span class="st">""</span>)</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>  sup_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!!!</span><span class="fu">colnames</span>(sup_region_tmp)[ind])</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Superficies_2016.xlsx$"</span>)) {</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp <span class="ot">&lt;-</span> sup_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>        campaña <span class="ot">=</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(campaña, <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"Ago 14"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>          <span class="at">yes =</span> <span class="st">"14-15"</span>,</span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>          <span class="at">no =</span> campaña</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>        campaña <span class="ot">=</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(campaña, <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"Ago 2014"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>          <span class="at">yes =</span> <span class="st">"14-15"</span>,</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>          <span class="at">no =</span> campaña</span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>        campaña <span class="ot">=</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(campaña, <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"Ago 15"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>          <span class="at">yes =</span> <span class="st">"15-16"</span>,</span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>          <span class="at">no =</span> campaña</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>        campaña <span class="ot">=</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(campaña, <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"Ago 2015"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>          <span class="at">yes =</span> <span class="st">"15-16"</span>,</span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>          <span class="at">no =</span> campaña</span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>        campaña <span class="ot">=</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(campaña, <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"Ago 16"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>          <span class="at">yes =</span> <span class="st">"16-17"</span>,</span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>          <span class="at">no =</span> campaña</span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>        campaña <span class="ot">=</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(campaña, <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"Ago 2016"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a>          <span class="at">yes =</span> <span class="st">"16-17"</span>,</span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a>          <span class="at">no =</span> campaña</span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing rows with all NAs</span></span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>  sup_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter_all</span>(<span class="fu">any_vars</span>(<span class="sc">!</span><span class="fu">is.na</span>(.)))</span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing rows where "Continúa" is found</span></span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>  sup_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter_all</span>(</span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>      <span class="fu">any_vars</span>(</span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">str_detect</span>(., <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"Continúa"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing the first colomn if row index</span></span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(<span class="fu">colnames</span>(sup_region_tmp)[<span class="dv">1</span>], <span class="st">"[aeiou]"</span>) <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp <span class="ot">&lt;-</span>   sup_region_tmp[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The name of the first column differs accross sheets (departemento or region)</span></span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a>  name_first_col <span class="ot">&lt;-</span> <span class="fu">colnames</span>(sup_region_tmp)[<span class="dv">1</span>]</span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span> name_first_col <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"departamento"</span>, <span class="st">"región"</span>)) {</span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">str_c</span>(<span class="st">"Issue with sheet: "</span>, sheet_name))</span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a>  sup_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">region :=</span> <span class="sc">!!</span>name_first_col)</span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sheet_name <span class="sc">==</span> <span class="st">"062015"</span>) {</span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a>      sup_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(campaña <span class="ot">=</span> <span class="fu">colnames</span>(sup_region_tmp)[<span class="dv">2</span>])</span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a>  sup_region_tmp<span class="sc">$</span>campaña <span class="ot">&lt;-</span></span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_c</span>(<span class="st">"20"</span>,<span class="fu">str_sub</span>(sup_region_tmp<span class="sc">$</span>campaña, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>()</span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a>  sup_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">year =</span> campaña)</span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sheet_name <span class="sc">==</span> <span class="st">"062015"</span>) {</span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">str_which</span>(sup_region_tmp<span class="sc">$</span>region, <span class="st">"Cajamarca"</span>)</span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp<span class="sc">$</span>region[p] <span class="ot">&lt;-</span> <span class="st">"Cajamarca_R"</span></span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">str_which</span>(sup_region_tmp<span class="sc">$</span>region, <span class="st">"Cajamarca"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a>      <span class="fu">first</span>()</span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp<span class="sc">$</span>region[p] <span class="ot">&lt;-</span> <span class="st">"Cajamarca_R"</span></span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a>  sup_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), <span class="sc">!</span> year <span class="sc">%in%</span> <span class="st">"campaña"</span>)</span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The production of each product is given in two rows, but the product name is not repeated</span></span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a>  sup_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fill</span>(region, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing sub-regional data</span></span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true" tabindex="-1"></a>  sup_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span> region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cajamarca"</span>, <span class="st">"Chota"</span>, <span class="st">"Jaén"</span>, <span class="st">"Abancay"</span>,<span class="st">"Andahuaylas"</span>)</span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-215"><a href="#cb8-215" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(<span class="fu">colnames</span>(sup_region_tmp), <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"ago"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">==</span> T)) {</span>
<span id="cb8-216"><a href="#cb8-216" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">str_detect</span>(<span class="fu">colnames</span>(sup_region_tmp), <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"ago"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))<span class="sc">==</span>T)</span>
<span id="cb8-217"><a href="#cb8-217" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(sup_region_tmp)[p] <span class="ot">&lt;-</span> <span class="st">"TOTAL"</span></span>
<span id="cb8-218"><a href="#cb8-218" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-219"><a href="#cb8-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-220"><a href="#cb8-220" aria-hidden="true" tabindex="-1"></a>  resul <span class="ot">&lt;-</span></span>
<span id="cb8-221"><a href="#cb8-221" aria-hidden="true" tabindex="-1"></a>    sup_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb8-222"><a href="#cb8-222" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(region, year), <span class="at">names_to =</span> <span class="st">"product"</span>)</span>
<span id="cb8-223"><a href="#cb8-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-224"><a href="#cb8-224" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (anneesup <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb8-225"><a href="#cb8-225" aria-hidden="true" tabindex="-1"></a>    resul <span class="ot">&lt;-</span></span>
<span id="cb8-226"><a href="#cb8-226" aria-hidden="true" tabindex="-1"></a>      resul <span class="sc">|&gt;</span></span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">max</span>(year))</span>
<span id="cb8-228"><a href="#cb8-228" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb8-229"><a href="#cb8-229" aria-hidden="true" tabindex="-1"></a>    resul <span class="ot">&lt;-</span></span>
<span id="cb8-230"><a href="#cb8-230" aria-hidden="true" tabindex="-1"></a>      resul <span class="sc">|&gt;</span></span>
<span id="cb8-231"><a href="#cb8-231" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">min</span>(year))</span>
<span id="cb8-232"><a href="#cb8-232" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-233"><a href="#cb8-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-234"><a href="#cb8-234" aria-hidden="true" tabindex="-1"></a>  resul <span class="ot">&lt;-</span></span>
<span id="cb8-235"><a href="#cb8-235" aria-hidden="true" tabindex="-1"></a>    resul <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">campana =</span> year)</span>
<span id="cb8-236"><a href="#cb8-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-237"><a href="#cb8-237" aria-hidden="true" tabindex="-1"></a>  resul <span class="ot">&lt;-</span> resul <span class="sc">|&gt;</span></span>
<span id="cb8-238"><a href="#cb8-238" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">month =</span> month) <span class="sc">|&gt;</span></span>
<span id="cb8-239"><a href="#cb8-239" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(region, campana, month, product, value)</span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true" tabindex="-1"></a>  resul <span class="ot">&lt;-</span></span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true" tabindex="-1"></a>    resul <span class="sc">|&gt;</span></span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arveja gr. seco"</span>,</span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"arveja grano seco"</span>,</span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol grano seco**"</span>,</span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol grano seco"</span>,</span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol palo"</span>,</span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol de palo"</span>,</span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol castlla"</span>,</span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol castilla"</span>,</span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-264"><a href="#cb8-264" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-265"><a href="#cb8-265" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"lentaja"</span>,</span>
<span id="cb8-266"><a href="#cb8-266" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"lenteja"</span>,</span>
<span id="cb8-267"><a href="#cb8-267" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb8-268"><a href="#cb8-268" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-269"><a href="#cb8-269" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-270"><a href="#cb8-270" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol gr. seco"</span>,</span>
<span id="cb8-271"><a href="#cb8-271" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol grano seco"</span>,</span>
<span id="cb8-272"><a href="#cb8-272" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb8-273"><a href="#cb8-273" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-274"><a href="#cb8-274" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-275"><a href="#cb8-275" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"haba gr. seco"</span>,</span>
<span id="cb8-276"><a href="#cb8-276" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"haba grano seco"</span>,</span>
<span id="cb8-277"><a href="#cb8-277" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb8-278"><a href="#cb8-278" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-279"><a href="#cb8-279" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-280"><a href="#cb8-280" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"maíz a. duro"</span>,</span>
<span id="cb8-281"><a href="#cb8-281" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>,</span>
<span id="cb8-282"><a href="#cb8-282" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb8-283"><a href="#cb8-283" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-284"><a href="#cb8-284" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-285"><a href="#cb8-285" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arveja gr. verde"</span>,</span>
<span id="cb8-286"><a href="#cb8-286" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"arveja grano verde"</span>,</span>
<span id="cb8-287"><a href="#cb8-287" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb8-288"><a href="#cb8-288" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-289"><a href="#cb8-289" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-290"><a href="#cb8-290" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arveja gr. verde"</span>,</span>
<span id="cb8-291"><a href="#cb8-291" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"arveja grano verde"</span>,</span>
<span id="cb8-292"><a href="#cb8-292" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb8-293"><a href="#cb8-293" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-294"><a href="#cb8-294" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-295"><a href="#cb8-295" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"haba gr. verde"</span>,</span>
<span id="cb8-296"><a href="#cb8-296" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"haba grano verde"</span>,</span>
<span id="cb8-297"><a href="#cb8-297" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb8-298"><a href="#cb8-298" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-299"><a href="#cb8-299" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-300"><a href="#cb8-300" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"espá-rrago"</span>,</span>
<span id="cb8-301"><a href="#cb8-301" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"espárrago"</span>,</span>
<span id="cb8-302"><a href="#cb8-302" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb8-303"><a href="#cb8-303" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-304"><a href="#cb8-304" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-305"><a href="#cb8-305" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"maíz duro"</span>,</span>
<span id="cb8-306"><a href="#cb8-306" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>,</span>
<span id="cb8-307"><a href="#cb8-307" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb8-308"><a href="#cb8-308" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-309"><a href="#cb8-309" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb8-310"><a href="#cb8-310" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span> <span class="fu">str_detect</span>(product, <span class="st">"contin"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-311"><a href="#cb8-311" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span> <span class="fu">str_detect</span>(product, <span class="st">"conclusi"</span>))</span>
<span id="cb8-312"><a href="#cb8-312" aria-hidden="true" tabindex="-1"></a>  resul</span>
<span id="cb8-313"><a href="#cb8-313" aria-hidden="true" tabindex="-1"></a>}<span class="co"># End of import_monthly_regional_values_year_S ()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Import monthly regional agricultural values from the Excel file,</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' for all the months of the file.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param file path to the Excel File</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param anneesup</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param timescale</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>import_monthly_regional_values_S <span class="ot">&lt;-</span> <span class="cf">function</span>(file,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                                             anneesup,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                                             timescale){</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  sheet_names <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(file)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  surf_region_monthly <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    sheet_names,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    import_monthly_regional_values_year_S,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> file,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">anneesup =</span> anneesup) <span class="sc">|&gt;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list_rbind</span>()</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cleaning years and changing type of values: from str to num</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  surf_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    surf_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_sub</span>(sheet_names[<span class="dv">1</span>], <span class="dv">3</span>, <span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">ifelse</span>(anneesup <span class="sc">==</span> <span class="dv">0</span>, year <span class="sc">-</span> <span class="dv">1</span>,  year)) <span class="sc">|&gt;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">campana =</span> <span class="fu">str_remove</span>(campana, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value_num =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value)))</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Values in 2014 to 2016 are expressed in thousands of tonnes</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># These need to be expressed in tonnes</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  surf_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    surf_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">value_num =</span> <span class="fu">ifelse</span>(year <span class="sc">%in%</span> <span class="dv">2014</span><span class="sc">:</span><span class="dv">2015</span>, value_num <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>, value_num),</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">value_num =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(<span class="sc">!!</span>file, <span class="st">"Superficies_2014.xlsx$"</span>) <span class="sc">&amp;</span> month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>),</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> value_num <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>,</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> value_num</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing the `value` columns to keep only the column with numerical values</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  surf_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    surf_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Superficies_2002.xlsx$"</span>)) {</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>)) {</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">missing_table</span>(<span class="at">y =</span> <span class="dv">2</span>, <span class="at">mm =</span> i, <span class="at">type =</span> <span class="st">"Superficies"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year =</span> year <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>      surf_region_monthly <span class="ot">&lt;-</span> <span class="fu">rbind</span>(surf_region_monthly, temp)</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Superficies_2003.xlsx$"</span>)) {</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    temp <span class="ot">&lt;-</span> <span class="fu">missing_table</span>(<span class="at">y =</span> <span class="dv">3</span>, <span class="at">mm =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"Superficies"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">year =</span> year <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    surf_region_monthly <span class="ot">&lt;-</span> <span class="fu">rbind</span>(surf_region_monthly, temp)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cleaning region names</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>  surf_region_monthly<span class="sc">$</span>region <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">sort</span>()</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>  surf_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    surf_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">replace</span>(region, region<span class="sc">==</span><span class="st">"Apurimac"</span>, <span class="st">"Apurímac"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">replace</span>(region, region<span class="sc">==</span><span class="st">"Cajamarca_R"</span>, <span class="st">"Cajamarca"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">replace</span>(</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> region,</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">list =</span> region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Nacional"</span>, <span class="st">"Total nacional"</span>, <span class="st">"TOTAL NACIONAL"</span>,</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"TOTAL  NACIONAL"</span>),</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="st">"Total Nacional"</span>)</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>  surf_region_monthly <span class="ot">&lt;-</span> surf_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(region, product, <span class="fu">desc</span>(month))</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cleaning product names</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>  surf_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    surf_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace extra spacing with only one space</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">product =</span> <span class="fu">str_replace_all</span>(product, <span class="st">"[[:blank:]]{2,}"</span>, <span class="st">" "</span>))</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>  surf_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>    surf_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arveja gr. seco"</span>,</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"arveja grano seco"</span>,</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol castlla"</span>,</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol castilla"</span>,</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol gr. seco"</span>,</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol grano seco"</span>,</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"haba gr. seco"</span>,</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"haba grano seco"</span>,</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"maíz a. duro"</span>,</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>,</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"algodón"</span>,</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"algodón rama"</span>,</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arroz"</span>,</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"arroz cáscara"</span>,</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arveja grano"</span>,</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"arveja grano seco"</span>,</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol"</span>,</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol grano seco"</span>,</span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"haba grano"</span>,</span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"haba grano seco"</span>,</span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"    maíz am duro"</span>,</span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>,</span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Superficies_201(4|5).xlsx$"</span>)) {</span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>    surf_region_monthly <span class="ot">&lt;-</span> surf_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>        <span class="at">product =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"arroz"</span>)           <span class="sc">~</span>  <span class="st">"arroz cáscara"</span>,</span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"banano"</span>)          <span class="sc">~</span>  <span class="st">"plátano"</span>,</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"café"</span>)            <span class="sc">~</span>  <span class="st">"café"</span>,</span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"banano"</span>)          <span class="sc">~</span>  <span class="st">"plátano"</span>,</span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"caña"</span>)            <span class="sc">~</span>  <span class="st">"caña de azúcar"</span>,</span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"chocho"</span>)          <span class="sc">~</span>  <span class="st">"chocho"</span>,</span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"gar"</span>)             <span class="sc">~</span>  <span class="st">"garbanzo"</span>,</span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"caña"</span>)            <span class="sc">~</span>  <span class="st">"caña de azúcar"</span>,</span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"algodón"</span>)         <span class="sc">~</span>  <span class="st">"algodón rama"</span>,</span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz a. duro"</span>)    <span class="sc">~</span>  <span class="st">"maíz amarillo duro"</span>,</span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz amilaceo"</span>)   <span class="sc">~</span>  <span class="st">"maíz amiláceo"</span>,</span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz amílaceo"</span>)   <span class="sc">~</span>  <span class="st">"maíz amiláceo"</span>,</span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz amiláceo"</span>)   <span class="sc">~</span>  <span class="st">"maíz amiláceo"</span>,</span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"caña de azúcar para azúcar"</span>)   <span class="sc">~</span>  <span class="st">"caña de azúcar"</span>,</span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"arveja seca"</span>)     <span class="sc">~</span>  <span class="st">"arveja grano seco"</span>,</span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"arveja verde"</span>)    <span class="sc">~</span>  <span class="st">"arveja grano verde"</span>,</span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"loctao"</span>)          <span class="sc">~</span>  <span class="st">"frijol loctao"</span>,</span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"frijol seco"</span>)     <span class="sc">~</span>  <span class="st">"frijol grano seco"</span>,</span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"frijol castill"</span>)  <span class="sc">~</span>  <span class="st">"frijol castilla"</span>,</span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba seca"</span>)       <span class="sc">~</span>  <span class="st">"haba grano seco"</span>,</span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba seco"</span>)       <span class="sc">~</span>  <span class="st">"haba grano seco"</span>,</span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba verde"</span>)      <span class="sc">~</span>  <span class="st">"haba grano verde"</span>,</span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"limón sutil"</span>)     <span class="sc">~</span>  <span class="st">"limón"</span>,</span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba verde"</span>)      <span class="sc">~</span>  <span class="st">"haba grano verde"</span>,</span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"algodón rama"</span>)    <span class="sc">~</span>  <span class="st">"algodón rama"</span>,</span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"café"</span>)            <span class="sc">~</span>  <span class="st">"café"</span>,</span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"cañihua"</span>)         <span class="sc">~</span>  <span class="st">"cañihua"</span>,</span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"espárrago"</span>)       <span class="sc">~</span>  <span class="st">"espárrago"</span>,</span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"limón"</span>)           <span class="sc">~</span>  <span class="st">"limón"</span>,</span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz amiláceo"</span>)   <span class="sc">~</span>  <span class="st">"maíz amiláceo"</span>,</span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz choclo"</span>)     <span class="sc">~</span>  <span class="st">"maíz choclo"</span>,</span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"piña"</span>)            <span class="sc">~</span>  <span class="st">"piña"</span>,</span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"zaran-daja"</span>)      <span class="sc">~</span>  <span class="st">"zarandaja"</span>,</span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> product</span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a>  surf_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a>    surf_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value_num =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value_num), <span class="at">yes =</span> <span class="dv">0</span>, <span class="at">no =</span> value_num))<span class="sc">|&gt;</span></span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">str_c</span>(year, month, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>()</span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (timescale <span class="sc">==</span> <span class="dv">12</span>){</span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a>    surf_region_monthly <span class="ot">&lt;-</span> surf_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">7</span> ) <span class="sc">|&gt;</span></span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(region, product, year, value_num) <span class="sc">|&gt;</span></span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">surf_annual =</span> value_num)</span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a>  surf_region_monthly</span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a>}<span class="co"># End of import_monthly_regional_values_S()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="regional-harvested-surface" class="level4" data-number="2.1.2.3">
<h4 data-number="2.1.2.3" class="anchored" data-anchor-id="regional-harvested-surface"><span class="header-section-number">2.1.2.3</span> Regional Harvested Surface</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Import monthly regional agricultural values from the Excel file,</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' for a given month</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param sheet_name name of the Excel sheet</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param file path to the Excel File</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>import_monthly_regional_values_year_SR <span class="ot">&lt;-</span> <span class="cf">function</span>(sheet_name,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                                                   file,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                                                   anneesup) {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The first two digits of the name: month</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the next four: the four digits of the year</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># last digit: index of the sheet for a given month and year (we will note use it)</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  year  <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(sheet_name, <span class="dv">3</span>, <span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  month <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(sheet_name, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  tmp   <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_excel</span>(</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">path =</span> file,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">sheet =</span> sheet_name,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">col_types =</span> <span class="st">"text"</span>, <span class="at">n_max =</span> <span class="dv">15</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We can use the first occurrence of "Años" to determine the beginning of the table</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  ind_row_year <span class="ot">&lt;-</span> <span class="fu">str_which</span>(tmp[[<span class="dv">3</span>]], <span class="fu">regex</span>(<span class="st">"años?"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(ind_row_year) <span class="sc">&gt;</span> <span class="dv">0</span>) ind_row_year <span class="ot">&lt;-</span> <span class="fu">first</span>(ind_row_year)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  name_camp <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(ind_row_year) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    ind_row_year <span class="ot">&lt;-</span> <span class="fu">str_which</span>(tmp[[<span class="dv">3</span>]], <span class="fu">regex</span>(<span class="st">"Campaña?"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">first</span>()</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    name_camp <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The first row of the header of the table is contained in the previous line</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  skip_head <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">&gt;=</span> <span class="dv">2008</span>, </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    ind_row_year <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    ind_row_year</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The body of the table</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  surfR_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressMessages</span>(</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_excel</span>(</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">path =</span> file,</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">sheet =</span> sheet_name,</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_types =</span> <span class="st">"text"</span>, <span class="at">skip =</span> skip_head, <span class="at">col_names =</span> F</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>       <span class="sc">-</span> <span class="fu">where</span>(</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>         <span class="sc">~</span> <span class="fu">all</span>(<span class="fu">is.na</span>(.)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  header_1 <span class="ot">&lt;-</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressMessages</span>(</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_excel</span>(</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">path =</span> file,</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">sheet =</span> sheet_name,</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">skip =</span> skip_head<span class="dv">-2</span>, <span class="at">n_max =</span> <span class="dv">2</span>, <span class="at">col_names =</span> F</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(year <span class="sc">&lt;</span> <span class="dv">2004</span>){</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>    header_1 <span class="ot">&lt;-</span> </span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressMessages</span>(</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>        <span class="fu">read_excel</span>(</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>          <span class="at">path =</span> file,</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet =</span> sheet_name, </span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>          <span class="at">skip =</span> skip_head<span class="dv">-1</span>, </span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>          <span class="at">n_max =</span> <span class="dv">1</span>, </span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>          <span class="at">col_names =</span> F))</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(year <span class="sc">&gt;=</span> <span class="dv">2008</span>){</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>    header_1 <span class="ot">&lt;-</span> </span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressMessages</span>(</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>        <span class="fu">read_excel</span>(</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>          <span class="at">path =</span> file,</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet =</span> sheet_name, <span class="at">skip =</span> skip_head<span class="dv">-1</span>, <span class="at">n_max =</span> <span class="dv">2</span>, <span class="at">col_names =</span> F)) <span class="sc">|&gt;</span> </span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span> <span class="fu">where</span>( </span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>          <span class="sc">~</span> <span class="fu">all</span>(<span class="fu">is.na</span>(.))</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>  header_2 <span class="ot">&lt;-</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>    header_1 <span class="sc">|&gt;</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">everything</span>(), <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">format_header</span>(.x)))</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(surfR_region_tmp) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(header_2)</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">colnames</span>(surfR_region_tmp)[<span class="dv">2</span>] <span class="sc">==</span> <span class="st">""</span>) {</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(surfR_region_tmp)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"departamento"</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing columns with no name</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>  ind <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">colnames</span>(surfR_region_tmp)) <span class="sc">&amp;</span> (<span class="fu">colnames</span>(surfR_region_tmp) <span class="sc">!=</span> <span class="st">""</span>)</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>  surfR_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!!!</span><span class="fu">colnames</span>(surfR_region_tmp)[ind])</span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing rows with all NAs</span></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>  surfR_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter_all</span>(<span class="fu">any_vars</span>(<span class="sc">!</span><span class="fu">is.na</span>(.)))</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing rows where "Continúa" is found</span></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>  surfR_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter_all</span>(</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">any_vars</span>(<span class="sc">!</span><span class="fu">str_detect</span>(., <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"Continúa"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing the first colomn if row index</span></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(<span class="fu">colnames</span>(surfR_region_tmp)[<span class="dv">1</span>], <span class="st">"[aeiou]"</span>) <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp <span class="ot">&lt;-</span>  surfR_region_tmp[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The name of the first column differs accross sheets (departemento or region)</span></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a>  name_first_col <span class="ot">&lt;-</span> <span class="fu">colnames</span>(surfR_region_tmp)[<span class="dv">1</span>]</span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (name_first_col <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"(ha) departamento"</span>,<span class="st">"mes : enero 2002-2003* departamento"</span>)) {</span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(surfR_region_tmp)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"departamento"</span></span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>    name_first_col <span class="ot">&lt;-</span> <span class="fu">colnames</span>(surfR_region_tmp)[<span class="dv">1</span>]</span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span> name_first_col <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"departamento"</span>, <span class="st">"región"</span>)) {</span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">str_c</span>(<span class="st">"Issue with sheet: "</span>, sheet_name))</span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># stop("First column is not region")</span></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>  surfR_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">region :=</span> <span class="sc">!!</span>name_first_col)</span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (name_camp <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>      surfR_region_tmp <span class="sc">|&gt;</span> <span class="fu">rename</span>(años <span class="ot">=</span> campaña)</span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(<span class="fu">colnames</span>(surfR_region_tmp), <span class="st">"^año$"</span>))) {</span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a>      surfR_region_tmp <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">year =</span> año)</span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>      surfR_region_tmp <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">year =</span> años)</span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(<span class="fu">colnames</span>(surfR_region_tmp), <span class="st">"ene"</span>))) {</span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">str_detect</span>(<span class="fu">colnames</span>(surfR_region_tmp), <span class="st">"ene"</span>))</span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp <span class="ot">&lt;-</span> surfR_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>p)</span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a>  surfR_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), <span class="sc">!</span> year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Años"</span>, <span class="st">"Año"</span>))</span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">str_which</span>(surfR_region_tmp<span class="sc">$</span>region,<span class="st">"Cajamarca"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">first</span>()</span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a>  surfR_region_tmp<span class="sc">$</span>region[p] <span class="ot">&lt;-</span> <span class="st">"Cajamarca_R"</span></span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The production of each product is given in two rows, but the product name is not repeated</span></span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a>  surfR_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fill</span>(region, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">==</span> <span class="dv">2005</span>) {</span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp<span class="sc">$</span>region[<span class="dv">1</span>]<span class="ot">&lt;-</span> <span class="st">"Total Nacional"</span></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing sub-regional data</span></span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a>  surfR_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span> region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cajamarca"</span>, <span class="st">"Chota"</span>, <span class="st">"Jaén"</span>, <span class="st">"Abancay"</span>,<span class="st">"Andahuaylas"</span>)</span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span> region <span class="sc">==</span> <span class="st">"Región"</span>)</span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a>  resul <span class="ot">&lt;-</span></span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a>    surfR_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(region, year), <span class="at">names_to =</span> <span class="st">"product"</span>)</span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sheet_name <span class="sc">==</span> <span class="st">"062015"</span>) {</span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a>    resul <span class="ot">&lt;-</span> resul <span class="sc">|&gt;</span></span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span> year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Continúa"</span>, <span class="st">"29"</span>))</span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (anneesup <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a>    resul <span class="ot">&lt;-</span></span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a>      resul <span class="sc">|&gt;</span></span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">max</span>(year))</span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a>    resul <span class="ot">&lt;-</span></span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a>      resul <span class="sc">|&gt;</span></span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">min</span>(year))</span>
<span id="cb10-193"><a href="#cb10-193" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a>  resul <span class="ot">&lt;-</span></span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a>    resul <span class="sc">|&gt;</span></span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arveja gr. seco"</span>,</span>
<span id="cb10-201"><a href="#cb10-201" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"arveja grano seco"</span>,</span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol grano seco**"</span>,</span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol grano seco"</span>,</span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol palo"</span>,</span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol de palo"</span>,</span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol castlla"</span>,</span>
<span id="cb10-216"><a href="#cb10-216" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol castilla"</span>,</span>
<span id="cb10-217"><a href="#cb10-217" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"lentaja"</span>,</span>
<span id="cb10-221"><a href="#cb10-221" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"lenteja"</span>,</span>
<span id="cb10-222"><a href="#cb10-222" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb10-223"><a href="#cb10-223" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb10-224"><a href="#cb10-224" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol gr. seco"</span>,</span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol grano seco"</span>,</span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"haba gr. seco"</span>,</span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"haba grano seco"</span>,</span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"maíz a. duro"</span>,</span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>,</span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arveja gr. verde"</span>,</span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"arveja grano verde"</span>,</span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb10-245"><a href="#cb10-245" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"haba gr. verde"</span>,</span>
<span id="cb10-246"><a href="#cb10-246" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"haba grano verde"</span>,</span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"espá-rrago"</span>,</span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"espárrago"</span>,</span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb10-253"><a href="#cb10-253" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb10-254"><a href="#cb10-254" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb10-255"><a href="#cb10-255" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"maíz duro"</span>,</span>
<span id="cb10-256"><a href="#cb10-256" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>,</span>
<span id="cb10-257"><a href="#cb10-257" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb10-258"><a href="#cb10-258" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb10-259"><a href="#cb10-259" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-260"><a href="#cb10-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-261"><a href="#cb10-261" aria-hidden="true" tabindex="-1"></a>  resul <span class="sc">|&gt;</span></span>
<span id="cb10-262"><a href="#cb10-262" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">month =</span> month) <span class="sc">|&gt;</span></span>
<span id="cb10-263"><a href="#cb10-263" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(region, year, month, product, value) <span class="sc">|&gt;</span></span>
<span id="cb10-264"><a href="#cb10-264" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span> product <span class="sc">==</span> <span class="st">"total"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-265"><a href="#cb10-265" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span> <span class="fu">str_detect</span>(product, <span class="st">"contin"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-266"><a href="#cb10-266" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span> <span class="fu">str_detect</span>(product, <span class="st">"conclusi"</span>))</span>
<span id="cb10-267"><a href="#cb10-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-268"><a href="#cb10-268" aria-hidden="true" tabindex="-1"></a>}<span class="co"># End of import_monthly_regional_values_P_year_P()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Import monthly regional agricultural values from the Excel file,</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' for all the months of the file.</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param file path to the Excel File</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param anneesup</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param timescale</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>import_monthly_regional_values_SR <span class="ot">&lt;-</span> <span class="cf">function</span>(file,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                                              anneesup,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                                              timescale) {</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  sheet_names <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(file)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  surfR_region_monthly <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    sheet_names,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    import_monthly_regional_values_year_SR,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> file,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">anneesup =</span> anneesup) <span class="sc">|&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list_rbind</span>()</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cleaning years and changing type of values: from str to num</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  surfR_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    surfR_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value_num =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, value)))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Values in 2014 to 2016 are expressed in thousands of tonnes</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># These need to be expressed in tonnes</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  surfR_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    surfR_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">value_num =</span> <span class="fu">ifelse</span>(year <span class="sc">%in%</span> <span class="dv">2014</span><span class="sc">:</span><span class="dv">2015</span>, value_num <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>, value_num),</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">value_num =</span> <span class="fu">ifelse</span>(</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(file, <span class="st">"Superficies_R_2014.xlsx$"</span>) <span class="sc">&amp;</span> month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>),</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> value_num <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>,</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> value_num</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing the `value` columns to keep only the column with numerical values</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  surfR_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    surfR_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Superficies_R_2002.xlsx$"</span>)) {</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">12</span>)) {</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">missing_table</span>(<span class="at">y =</span> <span class="dv">2</span>, <span class="at">mm =</span> i, <span class="at">type =</span> <span class="st">"Superficies_R"</span>)</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>      surfR_region_monthly <span class="ot">&lt;-</span> <span class="fu">rbind</span>(surfR_region_monthly, temp)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Superficies_R_2003.xlsx$"</span>)) {</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>    temp <span class="ot">&lt;-</span> <span class="fu">missing_table</span>(<span class="at">y =</span> <span class="dv">3</span>, <span class="at">mm =</span> <span class="dv">3</span>, <span class="at">type =</span> <span class="st">"Superficies_R"</span>)</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>    surfR_region_monthly <span class="ot">&lt;-</span> <span class="fu">rbind</span>(surfR_region_monthly, temp)</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cleaning region names</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>  surfR_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>    surfR_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>() <span class="sc">|&gt;</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">replace</span>(region, region<span class="sc">==</span><span class="st">"Apurimac"</span>, <span class="st">"Apurímac"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">replace</span>(region, region<span class="sc">==</span><span class="st">"Cajamarca_R"</span>, <span class="st">"Cajamarca"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">region =</span> <span class="fu">replace</span>(</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> region,</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">list =</span> region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Nacional"</span>, <span class="st">"Total nacional"</span>, <span class="st">"TOTAL NACIONAL"</span>),</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> <span class="st">"Total Nacional"</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>  surfR_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>    surfR_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arveja gr. seco"</span>,</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"arveja grano seco"</span>,</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol castlla"</span>,</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol castilla"</span>,</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol gr. seco"</span>,</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol grano seco"</span>,</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"haba gr. seco"</span>,</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"haba grano seco"</span>,</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"maíz a. duro"</span>,</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>,</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"algodón"</span>,</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"algodón rama"</span>,</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arroz"</span>,</span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"arroz cáscara"</span>,</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arveja grano"</span>,</span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"arveja grano seco"</span>,</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol"</span>,</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol grano seco"</span>,</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"haba grano"</span>,</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"haba grano seco"</span>,</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"    maíz am duro"</span>,</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>,</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Superficies_R_201(4|5).xlsx$"</span>)) {</span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>    surfR_region_monthly <span class="ot">&lt;-</span> surfR_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a>        <span class="at">product =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"arroz"</span>)     <span class="sc">~</span>  <span class="st">"arroz cáscara"</span>,</span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"banano"</span>)    <span class="sc">~</span>  <span class="st">"plátano"</span>,</span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"café"</span>)      <span class="sc">~</span>  <span class="st">"café"</span>,</span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"banano"</span>)    <span class="sc">~</span>  <span class="st">"plátano"</span>,</span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"caña"</span>)      <span class="sc">~</span>  <span class="st">"caña de azúcar"</span>,</span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"chocho"</span>)    <span class="sc">~</span>  <span class="st">"chocho"</span>,</span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"gar"</span>)       <span class="sc">~</span>  <span class="st">"garbanzo"</span>,</span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"caña"</span>)      <span class="sc">~</span>  <span class="st">"caña de azúcar"</span>,</span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"algodón"</span>)   <span class="sc">~</span>  <span class="st">"algodón rama"</span>,</span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz amilaceo"</span>)   <span class="sc">~</span>  <span class="st">"maíz amiláceo"</span>,</span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz amílaceo"</span>)   <span class="sc">~</span>  <span class="st">"maíz amiláceo"</span>,</span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"caña de azúcar para azúcar"</span>)   <span class="sc">~</span>  <span class="st">"caña de azúcar"</span>,</span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"arveja seca"</span>)     <span class="sc">~</span>  <span class="st">"arveja grano seco"</span>,</span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"arveja verde"</span>)    <span class="sc">~</span>  <span class="st">"arveja grano verde"</span>,</span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"loctao"</span>)          <span class="sc">~</span>  <span class="st">"frijol loctao"</span>,</span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"frijol seco"</span>)     <span class="sc">~</span>  <span class="st">"frijol grano seco"</span>,</span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"frijol castill"</span>)  <span class="sc">~</span>  <span class="st">"frijol castilla"</span>,</span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba seca"</span>)       <span class="sc">~</span>  <span class="st">"haba grano seco"</span>,</span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba seco"</span>)       <span class="sc">~</span>  <span class="st">"haba grano seco"</span>,</span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba verde"</span>)      <span class="sc">~</span>  <span class="st">"haba grano verde"</span>,</span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"limón sutil"</span>)     <span class="sc">~</span>  <span class="st">"limón"</span>,</span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba verde"</span>)      <span class="sc">~</span>  <span class="st">"haba grano verde"</span>,</span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"algodón rama"</span>)    <span class="sc">~</span>  <span class="st">"algodón rama"</span>,</span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"café"</span>)            <span class="sc">~</span>  <span class="st">"café"</span>,</span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"cañihua"</span>)         <span class="sc">~</span>  <span class="st">"cañihua"</span>,</span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"espárrago"</span>)       <span class="sc">~</span>  <span class="st">"espárrago"</span>,</span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"limón"</span>)           <span class="sc">~</span>  <span class="st">"limón"</span>,</span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz amiláceo"</span>)   <span class="sc">~</span>  <span class="st">"maíz amiláceo"</span>,</span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz choclo"</span>)     <span class="sc">~</span>  <span class="st">"maíz choclo"</span>,</span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"piña"</span>)            <span class="sc">~</span>  <span class="st">"piña"</span>,</span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"zaran-daja"</span>)      <span class="sc">~</span>  <span class="st">"zarandaja"</span>,</span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> product</span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a>  SurfaceR <span class="ot">&lt;-</span> surfR_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(region, product, <span class="fu">desc</span>(month)) <span class="sc">|&gt;</span></span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value_num =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value_num), <span class="at">yes =</span> <span class="dv">0</span>, <span class="at">no =</span> value_num))<span class="sc">|&gt;</span></span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> month, <span class="at">values_from =</span> value_num)</span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (timescale <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a>    SurfaceR <span class="ot">&lt;-</span></span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(SurfaceR[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], SurfaceR[<span class="dv">4</span><span class="sc">:</span><span class="dv">14</span>] <span class="sc">-</span> SurfaceR[<span class="dv">5</span><span class="sc">:</span><span class="dv">15</span>], SurfaceR[<span class="dv">15</span>]) <span class="sc">|&gt;</span></span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(region, year, product), <span class="at">names_to =</span> <span class="st">"month"</span>)</span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true" tabindex="-1"></a>    SurfaceR  <span class="ot">&lt;-</span> SurfaceR[<span class="fu">with</span>(SurfaceR, <span class="fu">order</span>(region, year, <span class="fu">as.numeric</span>(month), product, value)), ]</span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (timescale <span class="sc">==</span> <span class="dv">3</span>) {</span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true" tabindex="-1"></a>    SurfaceR <span class="ot">&lt;-</span></span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(</span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true" tabindex="-1"></a>        SurfaceR[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],</span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true" tabindex="-1"></a>        SurfaceR[<span class="dv">4</span>] <span class="sc">-</span> SurfaceR[<span class="dv">7</span>],</span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true" tabindex="-1"></a>        SurfaceR[<span class="dv">7</span>] <span class="sc">-</span> SurfaceR[<span class="dv">10</span>],</span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true" tabindex="-1"></a>        SurfaceR[<span class="dv">10</span>] <span class="sc">-</span> SurfaceR[<span class="dv">13</span>],</span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true" tabindex="-1"></a>        SurfaceR[<span class="dv">13</span>]</span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(region, year, product), <span class="at">names_to =</span> <span class="st">"trim"</span>)</span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true" tabindex="-1"></a>    SurfaceR <span class="ot">&lt;-</span> SurfaceR[<span class="fu">with</span>(SurfaceR, <span class="fu">order</span>(region, year, <span class="fu">as.numeric</span>(trim), product, value)), ]</span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-197"><a href="#cb11-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-198"><a href="#cb11-198" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (timescale <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb11-199"><a href="#cb11-199" aria-hidden="true" tabindex="-1"></a>    SurfaceR <span class="ot">&lt;-</span></span>
<span id="cb11-200"><a href="#cb11-200" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(</span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true" tabindex="-1"></a>        SurfaceR[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],</span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true" tabindex="-1"></a>        SurfaceR[<span class="dv">4</span>] <span class="sc">-</span> SurfaceR[<span class="dv">8</span>],</span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true" tabindex="-1"></a>        SurfaceR[<span class="dv">8</span>] <span class="sc">-</span> SurfaceR[<span class="dv">12</span>],</span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true" tabindex="-1"></a>        SurfaceR[<span class="dv">12</span>]</span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(region, year, product), <span class="at">names_to =</span> <span class="st">"quadrim"</span>)</span>
<span id="cb11-207"><a href="#cb11-207" aria-hidden="true" tabindex="-1"></a>    SurfaceR <span class="ot">&lt;-</span> SurfaceR[<span class="fu">with</span>(SurfaceR, <span class="fu">order</span>(region, year, <span class="fu">as.numeric</span>(quadrim), product, value)), ]</span>
<span id="cb11-208"><a href="#cb11-208" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-209"><a href="#cb11-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-210"><a href="#cb11-210" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (timescale <span class="sc">==</span> <span class="dv">6</span>) {</span>
<span id="cb11-211"><a href="#cb11-211" aria-hidden="true" tabindex="-1"></a>    SurfaceR <span class="ot">&lt;-</span></span>
<span id="cb11-212"><a href="#cb11-212" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(</span>
<span id="cb11-213"><a href="#cb11-213" aria-hidden="true" tabindex="-1"></a>        SurfaceR[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],</span>
<span id="cb11-214"><a href="#cb11-214" aria-hidden="true" tabindex="-1"></a>        SurfaceR[<span class="dv">4</span>] <span class="sc">-</span> SurfaceR[<span class="dv">10</span>],</span>
<span id="cb11-215"><a href="#cb11-215" aria-hidden="true" tabindex="-1"></a>        SurfaceR[<span class="dv">10</span>]</span>
<span id="cb11-216"><a href="#cb11-216" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb11-217"><a href="#cb11-217" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(region, year, product), <span class="at">names_to =</span> <span class="st">"biannual"</span>)</span>
<span id="cb11-218"><a href="#cb11-218" aria-hidden="true" tabindex="-1"></a>    SurfaceR <span class="ot">&lt;-</span> SurfaceR[<span class="fu">with</span>(SurfaceR, <span class="fu">order</span>(region, year, <span class="fu">as.numeric</span>(biannual), product, value)), ]</span>
<span id="cb11-219"><a href="#cb11-219" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-220"><a href="#cb11-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-221"><a href="#cb11-221" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (timescale <span class="sc">==</span> <span class="dv">12</span>) {</span>
<span id="cb11-222"><a href="#cb11-222" aria-hidden="true" tabindex="-1"></a>    SurfaceR <span class="ot">&lt;-</span></span>
<span id="cb11-223"><a href="#cb11-223" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(SurfaceR[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], SurfaceR[<span class="dv">4</span>]) <span class="sc">|&gt;</span></span>
<span id="cb11-224"><a href="#cb11-224" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">surf_R_annual =</span> <span class="st">"12"</span>)</span>
<span id="cb11-225"><a href="#cb11-225" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-226"><a href="#cb11-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-227"><a href="#cb11-227" aria-hidden="true" tabindex="-1"></a>  SurfaceR</span>
<span id="cb11-228"><a href="#cb11-228" aria-hidden="true" tabindex="-1"></a>}<span class="co"># End of import_monthly_regional_values_SR()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="regional-prices" class="level4" data-number="2.1.2.4">
<h4 data-number="2.1.2.4" class="anchored" data-anchor-id="regional-prices"><span class="header-section-number">2.1.2.4</span> Regional Prices</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Import monthly regional agricultural values from the Excel file,</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' for a given month</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param sheet_name name of the Excel sheet</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param file path to the Excel File</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param anneesup </span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>import_monthly_regional_values_year_Px <span class="ot">&lt;-</span> <span class="cf">function</span>(sheet_name,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                                                   file,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                                                   anneesup) {</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The first two digits of the name: month</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the next four: the four digits of the year</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># last digit: index of the sheet for a given month and year (we will note use it)</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  year  <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(sheet_name, <span class="dv">3</span>, <span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  month <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(sheet_name, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  tmp   <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_excel</span>(</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">path =</span> file,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">sheet =</span> sheet_name,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">col_types =</span> <span class="st">"text"</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_max =</span> <span class="dv">15</span>,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">col_names =</span> <span class="cn">FALSE</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We can use the first occurrence of "Año" to determine the beginning of the table</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  ind_row_year <span class="ot">&lt;-</span> <span class="fu">str_which</span>(tmp[[<span class="dv">4</span>]], <span class="fu">regex</span>(<span class="st">"año.?"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(ind_row_year) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    ind_row_year <span class="ot">&lt;-</span> <span class="fu">str_which</span>(tmp[[<span class="dv">3</span>]], <span class="fu">regex</span>(<span class="st">"año.?"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">first</span>()</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    ind_row_year <span class="ot">&lt;-</span> <span class="fu">first</span>(ind_row_year)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sheet_name <span class="sc">==</span> <span class="st">"062015"</span>) {ind_row_year <span class="ot">&lt;-</span> <span class="dv">8</span>}</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replacing column 2 into column 3</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (y <span class="sc">&gt;</span> <span class="dv">4</span>) {</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    tmp[<span class="dv">1</span><span class="sc">:</span>ind_row_year<span class="sc">+</span><span class="dv">2</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> tmp[<span class="dv">1</span><span class="sc">:</span>ind_row_year <span class="sc">+</span> <span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    tmp[<span class="dv">1</span><span class="sc">:</span>ind_row_year <span class="sc">+</span><span class="dv">2</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The first row of the header of the table is contained in the previous line</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>  skip_head <span class="ot">&lt;-</span> ind_row_year</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The body of the table</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>  prx_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressMessages</span>(</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_excel</span>(</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">path =</span> file,</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">sheet =</span> sheet_name,</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_types =</span> <span class="st">"text"</span>, <span class="at">col_names =</span> F</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>  positions <span class="ot">&lt;-</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">which</span>(prx_region_tmp[,<span class="dv">4</span>] <span class="sc">==</span> <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"Año"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Prices_2015.xlsx$"</span>)) {</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>    positions <span class="ot">&lt;-</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">which</span>(prx_region_tmp[,<span class="dv">3</span>] <span class="sc">==</span> <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"Año"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(positions) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>    positions <span class="ot">&lt;-</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">which</span>(prx_region_tmp[,<span class="dv">3</span>] <span class="sc">==</span> <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"Año"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>  resul <span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(positions)) {</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>    prx_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressMessages</span>(</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>        <span class="fu">read_excel</span>(</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>          <span class="at">path =</span> file,</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>          <span class="at">sheet =</span> sheet_name,</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>          <span class="at">col_types =</span> <span class="st">"text"</span>,</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>          <span class="at">col_names =</span> F,</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>          <span class="at">skip =</span> positions[i] <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>          <span class="at">n_max =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>            i <span class="sc">==</span> <span class="fu">length</span>(positions),</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>            <span class="at">yes =</span> <span class="dv">1000</span>,</span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>            <span class="at">no =</span> positions[i <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">-</span> positions[i]</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>          )<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>    header_1 <span class="ot">&lt;-</span> prx_region_tmp[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, ]</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y <span class="sc">&lt;</span> <span class="dv">6</span>) {header_1 <span class="ot">&lt;-</span> prx_region_tmp[<span class="dv">1</span>, ]}</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>    header_2 <span class="ot">&lt;-</span></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>      header_1 <span class="sc">|&gt;</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>        <span class="fu">across</span>(</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>          <span class="at">.cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>          <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">format_header</span>(.x)</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">str_detect</span>(header_2[<span class="dv">1</span>,<span class="dv">2</span>], <span class="fu">regex</span>(<span class="st">"Gobierno Regional"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">==</span> T){</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>      header_2[<span class="dv">2</span>] <span class="ot">&lt;-</span>  <span class="st">"departamento"</span></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>    header_2[<span class="dv">3</span>] <span class="ot">&lt;-</span> header_2[<span class="dv">2</span>]</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>    header_2[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Prices_2015.xlsx$"</span>)) {</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>      header_2 <span class="ot">&lt;-</span></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>        header_1 <span class="sc">|&gt;</span></span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(</span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>          <span class="fu">across</span>(</span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>            <span class="at">.cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>            <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">format_header</span>(.x)</span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(prx_region_tmp) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(header_2)</span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y <span class="sc">&lt;</span> <span class="dv">6</span>) {</span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">colnames</span>(prx_region_tmp)[<span class="dv">2</span>] <span class="sc">==</span> <span class="st">""</span>) {</span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(prx_region_tmp)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"departamento"</span></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(prx_region_tmp)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">"año"</span></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp <span class="ot">&lt;-</span> prx_region_tmp[<span class="sc">-</span><span class="dv">1</span>, ]</span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">colnames</span>(prx_region_tmp)[<span class="dv">3</span>] <span class="sc">==</span> <span class="st">""</span>) {</span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(prx_region_tmp)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"departamento"</span></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp <span class="ot">&lt;-</span> prx_region_tmp[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), ]</span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>    cell <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(file, <span class="st">"Prices_2015.xlsx$"</span>), <span class="at">yes =</span> <span class="dv">2</span>, <span class="at">no =</span> <span class="dv">3</span>)</span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(prx_region_tmp[<span class="dv">1</span>, <span class="dv">2</span>]) <span class="sc">&amp;</span></span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(prx_region_tmp[<span class="dv">1</span>, <span class="dv">2</span>], <span class="fu">regex</span>(<span class="st">"Promedio Nacional"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">==</span> T){</span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp[<span class="dv">1</span>, cell]  <span class="ot">&lt;-</span> <span class="st">"PROMEDIO NACIONAL"</span></span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(prx_region_tmp[<span class="dv">1</span>, <span class="dv">2</span>]) <span class="sc">&amp;</span></span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(prx_region_tmp[<span class="dv">1</span>, <span class="dv">2</span>], <span class="fu">regex</span>(<span class="st">"Gobierno Regional"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">==</span> T) {</span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp[<span class="dv">1</span>, cell]  <span class="ot">&lt;-</span> <span class="st">"PROMEDIO NACIONAL"</span></span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (sheet_name <span class="sc">==</span> <span class="st">"072007"</span>) {prx_region_tmp[, <span class="dv">3</span>] <span class="ot">&lt;-</span> prx_region_tmp[<span class="dv">2</span>]}</span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Removing columns with no name</span></span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a>    ind <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">colnames</span>(prx_region_tmp)) <span class="sc">&amp;</span> (<span class="fu">colnames</span>(prx_region_tmp) <span class="sc">!=</span> <span class="st">""</span>)</span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a>    prx_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!!!</span><span class="fu">colnames</span>(prx_region_tmp)[ind]) <span class="sc">|&gt;</span></span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a>      {\(x) x[, <span class="sc">-</span><span class="dv">1</span>]}()</span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Removing rows with all NAs</span></span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a>    prx_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter_all</span>(<span class="fu">any_vars</span>(<span class="sc">!</span><span class="fu">is.na</span>(.)))</span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Removing rows where "Continúa" is found</span></span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a>    prx_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter_all</span>(</span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a>        <span class="fu">any_vars</span>(</span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a>          <span class="sc">!</span><span class="fu">str_detect</span>(., <span class="fu">regex</span>(<span class="at">pattern =</span> <span class="st">"Continúa"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Removing the first colomn if row index</span></span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">str_detect</span>(<span class="fu">colnames</span>(prx_region_tmp)[<span class="dv">1</span>], <span class="st">"[aeiou]"</span>) <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp <span class="ot">&lt;-</span> prx_region_tmp[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The name of the first column differs accross sheets (departemento or region)</span></span>
<span id="cb12-168"><a href="#cb12-168" aria-hidden="true" tabindex="-1"></a>    name_first_col <span class="ot">&lt;-</span> <span class="fu">colnames</span>(prx_region_tmp)[<span class="dv">1</span>]</span>
<span id="cb12-169"><a href="#cb12-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span> name_first_col <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"departamento"</span>, <span class="st">"región"</span>)) {</span>
<span id="cb12-170"><a href="#cb12-170" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">str_c</span>(<span class="st">"Issue with sheet: "</span>, sheet_name))</span>
<span id="cb12-171"><a href="#cb12-171" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb12-172"><a href="#cb12-172" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-173"><a href="#cb12-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-174"><a href="#cb12-174" aria-hidden="true" tabindex="-1"></a>    prx_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb12-175"><a href="#cb12-175" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb12-176"><a href="#cb12-176" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">region :=</span> <span class="sc">!!</span>name_first_col)</span>
<span id="cb12-177"><a href="#cb12-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-178"><a href="#cb12-178" aria-hidden="true" tabindex="-1"></a>    prx_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb12-179"><a href="#cb12-179" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">year =</span> año)</span>
<span id="cb12-180"><a href="#cb12-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-181"><a href="#cb12-181" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (sheet_name <span class="sc">==</span> <span class="st">"062015"</span>) {</span>
<span id="cb12-182"><a href="#cb12-182" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> <span class="fu">str_which</span>(prx_region_tmp<span class="sc">$</span>region,<span class="st">"Cajamarca"</span>)</span>
<span id="cb12-183"><a href="#cb12-183" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp<span class="sc">$</span>region[p] <span class="ot">&lt;-</span> <span class="st">"Cajamarca_R"</span></span>
<span id="cb12-184"><a href="#cb12-184" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb12-185"><a href="#cb12-185" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> <span class="fu">str_which</span>(prx_region_tmp<span class="sc">$</span>region,<span class="st">"Cajamarca"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-186"><a href="#cb12-186" aria-hidden="true" tabindex="-1"></a>        <span class="fu">first</span>()</span>
<span id="cb12-187"><a href="#cb12-187" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp<span class="sc">$</span>region[p] <span class="ot">&lt;-</span> <span class="st">"Cajamarca_R"</span></span>
<span id="cb12-188"><a href="#cb12-188" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-189"><a href="#cb12-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-190"><a href="#cb12-190" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The production of each product is given in two rows, but the product name is not repeated</span></span>
<span id="cb12-191"><a href="#cb12-191" aria-hidden="true" tabindex="-1"></a>    prx_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb12-192"><a href="#cb12-192" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb12-193"><a href="#cb12-193" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fill</span>(region, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb12-194"><a href="#cb12-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-195"><a href="#cb12-195" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Removing sub-regional data</span></span>
<span id="cb12-196"><a href="#cb12-196" aria-hidden="true" tabindex="-1"></a>    prx_region_tmp <span class="ot">&lt;-</span></span>
<span id="cb12-197"><a href="#cb12-197" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb12-198"><a href="#cb12-198" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb12-199"><a href="#cb12-199" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span> region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cajamarca"</span>, <span class="st">"Chota"</span>, <span class="st">"Jaén"</span>, <span class="st">"Abancay"</span>,<span class="st">"Andahuaylas"</span>)</span>
<span id="cb12-200"><a href="#cb12-200" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb12-201"><a href="#cb12-201" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span> year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="cn">NA</span>))</span>
<span id="cb12-202"><a href="#cb12-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-203"><a href="#cb12-203" aria-hidden="true" tabindex="-1"></a>    resul_current <span class="ot">&lt;-</span></span>
<span id="cb12-204"><a href="#cb12-204" aria-hidden="true" tabindex="-1"></a>      prx_region_tmp <span class="sc">|&gt;</span></span>
<span id="cb12-205"><a href="#cb12-205" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(region, year), <span class="at">names_to =</span> <span class="st">"product"</span>)</span>
<span id="cb12-206"><a href="#cb12-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-207"><a href="#cb12-207" aria-hidden="true" tabindex="-1"></a>    resul <span class="ot">&lt;-</span> resul <span class="sc">|&gt;</span></span>
<span id="cb12-208"><a href="#cb12-208" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_rows</span>(resul_current)</span>
<span id="cb12-209"><a href="#cb12-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-210"><a href="#cb12-210" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(sheet_name <span class="sc">==</span> <span class="st">"062015"</span>){</span>
<span id="cb12-211"><a href="#cb12-211" aria-hidden="true" tabindex="-1"></a>      resul <span class="ot">&lt;-</span> resul <span class="sc">|&gt;</span></span>
<span id="cb12-212"><a href="#cb12-212" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2014</span>, <span class="dv">2015</span>))</span>
<span id="cb12-213"><a href="#cb12-213" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-214"><a href="#cb12-214" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-215"><a href="#cb12-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-216"><a href="#cb12-216" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Correction for product names</span></span>
<span id="cb12-217"><a href="#cb12-217" aria-hidden="true" tabindex="-1"></a>  resul <span class="ot">&lt;-</span></span>
<span id="cb12-218"><a href="#cb12-218" aria-hidden="true" tabindex="-1"></a>    resul <span class="sc">|&gt;</span></span>
<span id="cb12-219"><a href="#cb12-219" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb12-220"><a href="#cb12-220" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-221"><a href="#cb12-221" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arveja gr. seco"</span>,</span>
<span id="cb12-222"><a href="#cb12-222" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"arveja grano seco"</span>,</span>
<span id="cb12-223"><a href="#cb12-223" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb12-224"><a href="#cb12-224" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-225"><a href="#cb12-225" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-226"><a href="#cb12-226" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol grano seco**"</span>,</span>
<span id="cb12-227"><a href="#cb12-227" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol grano seco"</span>,</span>
<span id="cb12-228"><a href="#cb12-228" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb12-229"><a href="#cb12-229" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-230"><a href="#cb12-230" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-231"><a href="#cb12-231" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol palo"</span>,</span>
<span id="cb12-232"><a href="#cb12-232" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol de palo"</span>,</span>
<span id="cb12-233"><a href="#cb12-233" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb12-234"><a href="#cb12-234" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-235"><a href="#cb12-235" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-236"><a href="#cb12-236" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol castlla"</span>,</span>
<span id="cb12-237"><a href="#cb12-237" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol castilla"</span>,</span>
<span id="cb12-238"><a href="#cb12-238" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb12-239"><a href="#cb12-239" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-240"><a href="#cb12-240" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-241"><a href="#cb12-241" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"lentaja"</span>,</span>
<span id="cb12-242"><a href="#cb12-242" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"lenteja"</span>,</span>
<span id="cb12-243"><a href="#cb12-243" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb12-244"><a href="#cb12-244" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-245"><a href="#cb12-245" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-246"><a href="#cb12-246" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol gr. seco"</span>,</span>
<span id="cb12-247"><a href="#cb12-247" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"frijol grano seco"</span>,</span>
<span id="cb12-248"><a href="#cb12-248" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb12-249"><a href="#cb12-249" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-250"><a href="#cb12-250" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-251"><a href="#cb12-251" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"haba gr. seco"</span>,</span>
<span id="cb12-252"><a href="#cb12-252" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"haba grano seco"</span>,</span>
<span id="cb12-253"><a href="#cb12-253" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb12-254"><a href="#cb12-254" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-255"><a href="#cb12-255" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-256"><a href="#cb12-256" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"maíz a. duro"</span>,</span>
<span id="cb12-257"><a href="#cb12-257" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>,</span>
<span id="cb12-258"><a href="#cb12-258" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb12-259"><a href="#cb12-259" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-260"><a href="#cb12-260" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-261"><a href="#cb12-261" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arveja gr. verde"</span>,</span>
<span id="cb12-262"><a href="#cb12-262" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"arveja grano verde"</span>,</span>
<span id="cb12-263"><a href="#cb12-263" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb12-264"><a href="#cb12-264" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-265"><a href="#cb12-265" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-266"><a href="#cb12-266" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"haba gr. verde"</span>,</span>
<span id="cb12-267"><a href="#cb12-267" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"haba grano verde"</span>,</span>
<span id="cb12-268"><a href="#cb12-268" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb12-269"><a href="#cb12-269" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-270"><a href="#cb12-270" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-271"><a href="#cb12-271" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"espá-rrago"</span>,</span>
<span id="cb12-272"><a href="#cb12-272" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"espárrago"</span>,</span>
<span id="cb12-273"><a href="#cb12-273" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb12-274"><a href="#cb12-274" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-275"><a href="#cb12-275" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-276"><a href="#cb12-276" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"maíz duro"</span>,</span>
<span id="cb12-277"><a href="#cb12-277" aria-hidden="true" tabindex="-1"></a>        <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>,</span>
<span id="cb12-278"><a href="#cb12-278" aria-hidden="true" tabindex="-1"></a>        <span class="at">no =</span> product</span>
<span id="cb12-279"><a href="#cb12-279" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-280"><a href="#cb12-280" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-281"><a href="#cb12-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-282"><a href="#cb12-282" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (anneesup <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb12-283"><a href="#cb12-283" aria-hidden="true" tabindex="-1"></a>    resul <span class="ot">&lt;-</span></span>
<span id="cb12-284"><a href="#cb12-284" aria-hidden="true" tabindex="-1"></a>      resul <span class="sc">|&gt;</span></span>
<span id="cb12-285"><a href="#cb12-285" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">max</span>(year))</span>
<span id="cb12-286"><a href="#cb12-286" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb12-287"><a href="#cb12-287" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keeping only the last year available</span></span>
<span id="cb12-288"><a href="#cb12-288" aria-hidden="true" tabindex="-1"></a>    resul <span class="ot">&lt;-</span></span>
<span id="cb12-289"><a href="#cb12-289" aria-hidden="true" tabindex="-1"></a>      resul <span class="sc">|&gt;</span></span>
<span id="cb12-290"><a href="#cb12-290" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">min</span>(year))</span>
<span id="cb12-291"><a href="#cb12-291" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-292"><a href="#cb12-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-293"><a href="#cb12-293" aria-hidden="true" tabindex="-1"></a>  resul <span class="sc">|&gt;</span></span>
<span id="cb12-294"><a href="#cb12-294" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">month =</span> month) <span class="sc">|&gt;</span></span>
<span id="cb12-295"><a href="#cb12-295" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(region, year, month, product, value)</span>
<span id="cb12-296"><a href="#cb12-296" aria-hidden="true" tabindex="-1"></a>}<span class="co"># End of import_monthly_regional_values_year_Px ()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Import monthly regional agricultural values from the Excel file,</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' for all the months of the file.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param file path to the Excel File</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param anneesup</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param timescale</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>import_monthly_regional_values_Px <span class="ot">&lt;-</span> <span class="cf">function</span>(file,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                                              anneesup,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                                              timescale) {</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  sheet_names <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(file)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  prx_region_monthly <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    sheet_names,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    import_monthly_regional_values_year_Px,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> file,<span class="at">anneesup=</span> anneesup</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list_rbind</span>()</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cleaning years and changing type of values: from str to num</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  prx_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    prx_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_remove</span>(year, <span class="st">"p/?"</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">value_num =</span> <span class="fu">str_remove_all</span>(value, <span class="at">pattern =</span> <span class="st">" "</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_replace_all</span>(<span class="at">pattern =</span> <span class="st">","</span>, <span class="at">replacement =</span> <span class="st">"."</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>()</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Values in 2015 are expressed in thousands of tonnes</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># These need to be expressed in tonnes</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Prices_2015.xlsx$"</span>)) {</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    prx_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>      prx_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">value_num =</span> value_num,</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">value_num =</span> <span class="fu">ifelse</span>(month <span class="sc">&gt;</span> <span class="dv">4</span>,</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">yes =</span> value_num <span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>,</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">no =</span> value_num</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Removing the `value` columns to keep only the column with numerical values</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>  prx_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    prx_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cleaning region names</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>  prx_region_monthly<span class="sc">$</span>region <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">sort</span>()</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>  prx_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>    prx_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">replace</span>(region, region<span class="sc">==</span><span class="st">"Apurimac"</span>, <span class="st">"Apurímac"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">replace</span>(region, region<span class="sc">==</span><span class="st">"Cajamarca_R"</span>, <span class="st">"Cajamarca"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">region =</span> <span class="fu">replace</span>(</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> region,</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">list =</span> region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Nacional"</span>, <span class="st">"Promedio nacional"</span>, <span class="st">"PROMEDIO NACIONAL"</span>),</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> <span class="st">"Total Nacional"</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cleaning product names</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>  prx_region_monthly <span class="ot">&lt;-</span> prx_region_monthly</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>  prx_region_monthly <span class="ot">&lt;-</span> prx_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace extra spacing with only one space</span></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">product =</span> <span class="fu">str_replace_all</span>(product, <span class="st">"[[:blank:]]{2,}"</span>, <span class="st">" "</span>))</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>  prx_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>    prx_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"arveja gr. seco"</span>, <span class="at">yes =</span> <span class="st">"arveja grano seco"</span>, <span class="at">no =</span> product</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol castlla"</span>, <span class="at">yes =</span> <span class="st">"frijol castilla"</span>, <span class="at">no =</span> product</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"frijol gr. seco"</span>, <span class="at">yes =</span> <span class="st">"frijol grano seco"</span>, <span class="at">no =</span> product</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"haba gr. seco"</span>, <span class="at">yes =</span> <span class="st">"haba grano seco"</span>, <span class="at">no =</span> product</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>        product <span class="sc">==</span> <span class="st">"maíz a. duro"</span>, <span class="at">yes =</span> <span class="st">"maíz amarillo duro"</span>, <span class="at">no =</span> product</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(file, <span class="st">"Prices_201(4|5).xlsx$"</span>)) {</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>    prx_region_monthly <span class="ot">&lt;-</span> prx_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">product =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"arroz"</span>)           <span class="sc">~</span>  <span class="st">"arroz cáscara"</span>,</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"banano"</span>)          <span class="sc">~</span>  <span class="st">"plátano"</span>,</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"café"</span>)            <span class="sc">~</span>  <span class="st">"café"</span>,</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"banano"</span>)          <span class="sc">~</span>  <span class="st">"plátano"</span>,</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"caña"</span>)            <span class="sc">~</span>  <span class="st">"caña de azúcar"</span>,</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"chocho"</span>)          <span class="sc">~</span>  <span class="st">"chocho"</span>,</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"gar"</span>)             <span class="sc">~</span>  <span class="st">"garbanzo"</span>,</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"caña"</span>)            <span class="sc">~</span>  <span class="st">"caña de azúcar"</span>,</span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"algodón"</span>)         <span class="sc">~</span>  <span class="st">"algodón rama"</span>,</span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz amilaceo"</span>)   <span class="sc">~</span>  <span class="st">"maíz amiláceo"</span>,</span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz amílaceo"</span>)   <span class="sc">~</span>  <span class="st">"maíz amiláceo"</span>,</span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"caña de azúcar para azúcar"</span>)   <span class="sc">~</span>  <span class="st">"caña de azúcar"</span>,</span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"arveja seca"</span>)     <span class="sc">~</span>  <span class="st">"arveja grano seco"</span>,</span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"arveja verde"</span>)    <span class="sc">~</span>  <span class="st">"arveja grano verde"</span>,</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"loctao"</span>)          <span class="sc">~</span>  <span class="st">"frijol loctao"</span>,</span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"frijol seco"</span>)     <span class="sc">~</span>  <span class="st">"frijol grano seco"</span>,</span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"frijol castill"</span>)  <span class="sc">~</span>  <span class="st">"frijol castilla"</span>,</span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba seca"</span>)       <span class="sc">~</span>  <span class="st">"haba grano seco"</span>,</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba seco"</span>)       <span class="sc">~</span>  <span class="st">"haba grano seco"</span>,</span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba verde"</span>)      <span class="sc">~</span>  <span class="st">"haba grano verde"</span>,</span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"limón sutil"</span>)     <span class="sc">~</span>  <span class="st">"limón"</span>,</span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"haba verde"</span>)      <span class="sc">~</span>  <span class="st">"haba grano verde"</span>,</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"algodón rama"</span>)    <span class="sc">~</span>  <span class="st">"algodón rama"</span>,</span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"café"</span>)            <span class="sc">~</span>  <span class="st">"café"</span>,</span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"cañihua"</span>)         <span class="sc">~</span>  <span class="st">"cañihua"</span>,</span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"espárrago"</span>)       <span class="sc">~</span>  <span class="st">"espárrago"</span>,</span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"limón"</span>)           <span class="sc">~</span>  <span class="st">"limón"</span>,</span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz amiláceo"</span>)   <span class="sc">~</span>  <span class="st">"maíz amiláceo"</span>,</span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"maíz choclo"</span>)     <span class="sc">~</span>  <span class="st">"maíz choclo"</span>,</span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"piña"</span>)            <span class="sc">~</span>  <span class="st">"piña"</span>,</span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(product, <span class="st">"zaran-daja"</span>)      <span class="sc">~</span>  <span class="st">"zarandaja"</span>,</span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> product</span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a>  prx_region_monthly <span class="ot">&lt;-</span></span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a>    prx_region_monthly <span class="sc">|&gt;</span></span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value_num =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value_num), <span class="at">yes =</span> <span class="dv">0</span>, <span class="at">no =</span> value_num))<span class="sc">|&gt;</span></span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">str_c</span>(year, month, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>()</span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a>  prx_region_monthly</span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a>}<span class="co"># End of import_monthly_regional_values_Px ()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="download-the-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="download-the-data"><span class="header-section-number">2.2</span> Download the Data</h2>
<p>Once the functions to downloaded the data are defined, we can use them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Production </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>data_P_TOTAL <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>data_P_TOTAL_A <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Planted surface</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>data_S_TOTAL <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>data_S_TOTAL_A <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Harvested surface </span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>data_SR_TOTAL <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>data_SR_TOTAL_A <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Prices</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>data_Px_TOTAL <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>download_again <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (download_again) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (y <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">14</span>)) {</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    year <span class="ot">&lt;-</span>  <span class="fu">ifelse</span>( y <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="fu">paste</span>(<span class="st">"200"</span>, y, <span class="at">sep=</span><span class="st">""</span>), <span class="fu">paste</span>(<span class="st">"20"</span>, y, <span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(year)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Code for years in PDF files</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)) {</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">12</span><span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(m)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Months not available in PDF Files</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ( m <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="dv">3</span>) {<span class="cf">next</span>}</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ( m <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="dv">2</span>) {<span class="cf">next</span>}</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ( m <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="dv">2</span>) {<span class="cf">next</span>}</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ( m <span class="sc">==</span> <span class="dv">9</span> <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="dv">2</span>) {<span class="cf">next</span>}</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ( m <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="dv">2</span>) {<span class="cf">next</span>}</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># URL to download the pdf files</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        link <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>          <span class="st">"https://www.midagri.gob.pe/portal/download/pdf"</span>,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>          <span class="st">"/herramientas/boletines/boletineselectronicos/"</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>          <span class="st">"estadisticaagrariamensual/"</span>, year, <span class="st">"/EAM"</span>,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_sub</span>(year, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ifelse</span>(m <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="fu">paste</span>(<span class="st">"0"</span>, m, <span class="at">sep =</span> <span class="st">""</span>), m),</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>          <span class="st">".pdf"</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # Production - Pages 44,45, 46 and 47 of the PDF Files</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>          <span class="st">"../data/raw/minagri/Production/Production_"</span>, year, <span class="st">".xlsx"</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>          page1 <span class="ot">&lt;-</span> <span class="fu">extract_pdf_data</span>(</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">annee =</span> y,</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">mois =</span> m,</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">adresse =</span> link,</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">page =</span> <span class="dv">44</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> i, </span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">Cell1 =</span> <span class="st">"Departamento"</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>          page2 <span class="ot">&lt;-</span> <span class="fu">extract_pdf_data</span>(</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">annee =</span> y, </span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">mois =</span> m, </span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">adresse =</span> link,</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">page =</span> <span class="dv">45</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> i,</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">Cell1 =</span> <span class="st">"Departamento"</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>          Tableau <span class="ot">&lt;-</span> <span class="fu">rbind</span>(page1, page2)</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>          <span class="fu">write.xlsx</span>(</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>            Tableau, </span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>            name, </span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">sheetName =</span> <span class="fu">str_c</span>(</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ifelse</span>(m <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="fu">paste</span>(<span class="st">"0"</span>,m, <span class="at">sep=</span><span class="st">""</span>), m),</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>              year,</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>              i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>            <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>            <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>          <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Production"</span>, i, <span class="st">"ok "</span>))</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Planted surface - Pages 30, 31, 32, 33 of the PDF Files</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>        name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>          <span class="st">"../data/raw/minagri/Surface/Superficies_"</span>, year, <span class="st">".xlsx"</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>          page1 <span class="ot">&lt;-</span> <span class="fu">extract_pdf_data</span>(</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>            <span class="at">annee =</span> y,</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>            <span class="at">mois =</span> m,</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>            <span class="at">adresse =</span> link,</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>            <span class="at">page =</span> <span class="dv">30</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> i,</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>            <span class="at">Cell1 =</span> <span class="st">"Departamento"</span></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>          page2 <span class="ot">&lt;-</span> <span class="fu">extract_pdf_data</span>(</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>            <span class="at">annee =</span> y, </span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>            <span class="at">mois =</span> m,</span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>            <span class="at">adresse =</span> link,</span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>            <span class="at">page =</span> <span class="dv">31</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> i,</span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>            <span class="at">Cell1 =</span> <span class="st">"Departamento"</span></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>          Tableau <span class="ot">&lt;-</span>  <span class="fu">rbind</span>(page1, page2)</span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>          <span class="fu">write.xlsx</span>(</span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a>            Tableau,</span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>            name,</span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>            <span class="at">sheetName =</span> <span class="fu">str_c</span>(</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ifelse</span>(m <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="fu">paste</span>(<span class="st">"0"</span>, m, <span class="at">sep =</span> <span class="st">""</span>), m), </span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>              year,</span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>              i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a>            ), </span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a>            <span class="at">append =</span> <span class="cn">TRUE</span>, </span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>            <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a>          <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Surface"</span>, i, <span class="st">"ok "</span>))</span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Harvested surface - Pages 38,45, 46 and 47 of the PDF Files</span></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a>        name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a>          <span class="st">"../data/raw/minagri/Surface_R/Superficies_R_"</span>, year, <span class="st">".xlsx"</span></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a>          page1 <span class="ot">&lt;-</span> <span class="fu">extract_pdf_data</span>(</span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a>            <span class="at">annee =</span> y,</span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a>            <span class="at">mois =</span> m, </span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a>            <span class="at">adresse =</span> link, </span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a>            <span class="at">page =</span> <span class="dv">38</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> i,</span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>            <span class="at">Cell1 =</span> <span class="st">"Departamento"</span></span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a>          page2 <span class="ot">&lt;-</span> <span class="fu">extract_pdf_data</span>(</span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a>            <span class="at">annee =</span> y, </span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a>            <span class="at">mois =</span> m, </span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a>            <span class="at">adresse =</span> link, </span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a>            <span class="at">page =</span> <span class="dv">39</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> i, </span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>            <span class="at">Cell1 =</span> <span class="st">"Departamento"</span></span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a>          Tableau <span class="ot">&lt;-</span>  <span class="fu">rbind</span>(page1, page2)</span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a>          <span class="fu">write.xlsx</span>(</span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>            Tableau,</span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a>            name,</span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>            <span class="at">sheetName =</span> <span class="fu">str_c</span>(</span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ifelse</span>(m <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="fu">paste</span>(<span class="st">"0"</span>, m, <span class="at">sep =</span> <span class="st">""</span>), m),</span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>              year,</span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a>              i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a>            ), </span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a>            <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a>            <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a>          <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Surface R"</span>, i, <span class="st">"ok "</span>))</span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Prices - Pages 109,110, 111, 112, 113, 114 or 115 depending on the PDF Files</span></span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a>        name <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a>          <span class="st">"../data/raw/minagri/Prices/Prices_"</span>, year, <span class="st">".xlsx"</span></span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (y <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">&amp;</span> m <span class="sc">&lt;</span> <span class="dv">8</span>) {</span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a>            page2002 <span class="ot">&lt;-</span> <span class="fu">case_when</span>(m <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="dv">4</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">3</span>)</span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a>            page2002 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a>          page1 <span class="ot">&lt;-</span> <span class="fu">extract_pdf_data</span>(</span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a>            <span class="at">annee =</span> y,</span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a>            <span class="at">mois =</span> m,</span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a>            <span class="at">adresse =</span> link, </span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a>            <span class="at">page =</span> <span class="dv">112</span> <span class="sc">+</span><span class="dv">2</span> <span class="sc">*</span> i <span class="sc">-</span> page2002, </span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a>            <span class="at">Cell1 =</span> <span class="st">"Departamento"</span></span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a>          page2 <span class="ot">&lt;-</span> <span class="fu">extract_pdf_data</span>(</span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a>            <span class="at">annee =</span> y,</span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a>            <span class="at">mois =</span> m,</span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a>            <span class="at">adresse =</span> link, </span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a>            <span class="at">page =</span> <span class="dv">113</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> i <span class="sc">-</span> page2002,</span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a>            <span class="at">Cell1 =</span> <span class="st">"Departamento"</span></span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb15-154"><a href="#cb15-154" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>((<span class="fu">ncol</span>(page1) <span class="sc">!=</span> <span class="fu">ncol</span>(page2)) <span class="sc">&amp;</span> </span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true" tabindex="-1"></a>             <span class="fu">any</span>(<span class="fu">str_detect</span>(page2[,<span class="fu">ncol</span>(page2)], <span class="st">"Plátano"</span>))) {</span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true" tabindex="-1"></a>            page2 <span class="ot">&lt;-</span> page2[,<span class="sc">-</span><span class="fu">ncol</span>(page2)]</span>
<span id="cb15-157"><a href="#cb15-157" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb15-158"><a href="#cb15-158" aria-hidden="true" tabindex="-1"></a>          Tableau <span class="ot">&lt;-</span>  <span class="fu">rbind</span>(page1, page2)</span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true" tabindex="-1"></a>          <span class="fu">write.xlsx</span>(</span>
<span id="cb15-160"><a href="#cb15-160" aria-hidden="true" tabindex="-1"></a>            Tableau, </span>
<span id="cb15-161"><a href="#cb15-161" aria-hidden="true" tabindex="-1"></a>            name,</span>
<span id="cb15-162"><a href="#cb15-162" aria-hidden="true" tabindex="-1"></a>            <span class="at">sheetName =</span> <span class="fu">str_c</span>(</span>
<span id="cb15-163"><a href="#cb15-163" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ifelse</span>(m <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="fu">paste</span>(<span class="st">"0"</span>, m, <span class="at">sep =</span> <span class="st">""</span>), m),</span>
<span id="cb15-164"><a href="#cb15-164" aria-hidden="true" tabindex="-1"></a>              year,</span>
<span id="cb15-165"><a href="#cb15-165" aria-hidden="true" tabindex="-1"></a>              i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb15-166"><a href="#cb15-166" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb15-167"><a href="#cb15-167" aria-hidden="true" tabindex="-1"></a>            <span class="at">append =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-168"><a href="#cb15-168" aria-hidden="true" tabindex="-1"></a>            <span class="at">showNA =</span> <span class="cn">FALSE</span></span>
<span id="cb15-169"><a href="#cb15-169" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb15-170"><a href="#cb15-170" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb15-171"><a href="#cb15-171" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb15-172"><a href="#cb15-172" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb15-173"><a href="#cb15-173" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Code for years in Excel files - 2006 and above</span></span>
<span id="cb15-174"><a href="#cb15-174" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Remark : 2005 data are extracted manually</span></span>
<span id="cb15-175"><a href="#cb15-175" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(y <span class="sc">==</span> <span class="dv">5</span>) {</span>
<span id="cb15-176"><a href="#cb15-176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb15-177"><a href="#cb15-177" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb15-178"><a href="#cb15-178" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Downloading and extracting the excel sheets of interest</span></span>
<span id="cb15-179"><a href="#cb15-179" aria-hidden="true" tabindex="-1"></a>        <span class="fu">download.data</span>(y, <span class="at">out_folder =</span> <span class="st">"../data/raw/minagri/"</span>)</span>
<span id="cb15-180"><a href="#cb15-180" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb15-181"><a href="#cb15-181" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-182"><a href="#cb15-182" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-183"><a href="#cb15-183" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-data-agriculture-import" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-data-agriculture-import"><span class="header-section-number">2.3</span> Import Data in R</h2>
<p>We loop over the years to import the downloaded data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (y <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">16</span>) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">16</span>) {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extracting the data of year y (only for the last year)</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># last digits of the year</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    fn_digits_year <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(y <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="fu">str_c</span>(<span class="st">"0"</span>, y <span class="sc">-</span> <span class="dv">1</span>), y <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    data_P  <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_P</span>(</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Production/Production_20"</span>, </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">1</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">1</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    data_Px <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_Px</span>(</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Prices/Prices_20"</span>, </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">1</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">1</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    data_S  <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_S</span>(</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Surface/Superficies_20"</span>, </span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">1</span>, <span class="at">timescale =</span> <span class="dv">1</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    data_SR <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_SR</span>(</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Surface_R/Superficies_R_20"</span>, </span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">1</span>, </span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">1</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    data_P_annual  <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_P</span>(</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Production/Production_20"</span>,</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">1</span>,</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">12</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    data_S_annual  <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_S</span>(</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Surface/Superficies_20"</span>,</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">1</span>,</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">12</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>    data_SR_annual <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_SR</span>(</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Surface_R/Superficies_R_20"</span>,</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">1</span>,</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">12</span></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extracting the data of year y-1</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>    fn_digits_year <span class="ot">&lt;-</span> <span class="fu">str_pad</span>(y, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="dv">0</span>)</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>    data_P  <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_P</span>(</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Production/Production_20"</span>, </span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">0</span>,</span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">1</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>    data_S  <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_S</span>(</span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Surface/Superficies_20"</span>, </span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">0</span>,</span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">1</span></span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>    data_SR <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_SR</span>(</span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Surface_R/Superficies_R_20"</span>,</span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">0</span>, </span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">1</span></span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>    data_Px <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_Px</span>(</span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Prices/Prices_20"</span>,</span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">0</span>,</span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">1</span></span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>    data_P_TRIM <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_P</span>(</span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Production/Production_20"</span>,</span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">0</span>,</span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">4</span></span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>    data_P_annual  <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_P</span>(</span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Production/Production_20"</span>,</span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">0</span>,</span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">12</span></span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>    data_S_annual  <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_S</span>(</span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Surface/Superficies_20"</span>,</span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">0</span>,</span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">12</span></span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>    data_SR_annual <span class="ot">&lt;-</span> <span class="fu">import_monthly_regional_values_SR</span>(</span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">str_c</span>(</span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../data/raw/minagri/Surface_R/Superficies_R_20"</span>,</span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>        fn_digits_year, <span class="st">".xlsx"</span></span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a>      <span class="at">anneesup =</span> <span class="dv">0</span>,</span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a>      <span class="at">timescale =</span> <span class="dv">12</span></span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">str_c</span>(y,<span class="st">" ok"</span>))</span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a>  data_P <span class="ot">&lt;-</span></span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a>    data_P <span class="sc">|&gt;</span></span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">str_c</span>(year, month, <span class="st">"01"</span>, <span class="at">sep =</span> <span class="st">"-"</span>)))</span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(data_P) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a>    <span class="st">"region"</span>, <span class="st">"year"</span>, <span class="st">"product"</span>, <span class="st">"month"</span>, <span class="st">"Value_prod"</span>, <span class="st">"date"</span></span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a>  data_S <span class="ot">&lt;-</span></span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a>    data_S <span class="sc">|&gt;</span></span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">str_c</span>(year, month, <span class="st">"01"</span>, <span class="at">sep =</span> <span class="st">"-"</span>)))</span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(data_S) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a>    <span class="st">"region"</span>, <span class="st">"campaign"</span>, <span class="st">"month"</span>, <span class="st">"product"</span>, <span class="st">"year"</span>,<span class="st">"Value_surf"</span>, <span class="st">"date"</span></span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>  data_SR <span class="ot">&lt;-</span></span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a>    data_SR <span class="sc">|&gt;</span></span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">str_c</span>(year, month, <span class="st">"01"</span>, <span class="at">sep =</span> <span class="st">"-"</span>)))</span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(data_SR) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a>    <span class="st">"region"</span>, <span class="st">"year"</span>, <span class="st">"product"</span>, <span class="st">"month"</span>, <span class="st">"Value_surfR"</span>, <span class="st">"date"</span></span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-156"><a href="#cb16-156" aria-hidden="true" tabindex="-1"></a>  data_Px <span class="ot">&lt;-</span></span>
<span id="cb16-157"><a href="#cb16-157" aria-hidden="true" tabindex="-1"></a>    data_Px <span class="sc">|&gt;</span></span>
<span id="cb16-158"><a href="#cb16-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">date =</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="fu">str_c</span>(year, month, <span class="st">"01"</span>, <span class="at">sep =</span> <span class="st">"-"</span>)))</span>
<span id="cb16-159"><a href="#cb16-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(data_Px) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-160"><a href="#cb16-160" aria-hidden="true" tabindex="-1"></a>    <span class="st">"region"</span>, <span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"product"</span>, <span class="st">"Value_prices"</span>, <span class="st">"date"</span></span>
<span id="cb16-161"><a href="#cb16-161" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-162"><a href="#cb16-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-163"><a href="#cb16-163" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # Adding the new year to the global mensual files</span></span>
<span id="cb16-164"><a href="#cb16-164" aria-hidden="true" tabindex="-1"></a>  y_ix <span class="ot">&lt;-</span> y <span class="sc">-</span> <span class="dv">1</span> </span>
<span id="cb16-165"><a href="#cb16-165" aria-hidden="true" tabindex="-1"></a>  data_P_TOTAL[[y_ix]]  <span class="ot">&lt;-</span> data_P</span>
<span id="cb16-166"><a href="#cb16-166" aria-hidden="true" tabindex="-1"></a>  data_S_TOTAL[[y_ix]]  <span class="ot">&lt;-</span> data_S</span>
<span id="cb16-167"><a href="#cb16-167" aria-hidden="true" tabindex="-1"></a>  data_SR_TOTAL[[y_ix]] <span class="ot">&lt;-</span> data_SR</span>
<span id="cb16-168"><a href="#cb16-168" aria-hidden="true" tabindex="-1"></a>  data_Px_TOTAL[[y_ix]] <span class="ot">&lt;-</span> data_Px</span>
<span id="cb16-169"><a href="#cb16-169" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-170"><a href="#cb16-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(data_P, data_S, data_SR, data_Px)</span>
<span id="cb16-171"><a href="#cb16-171" aria-hidden="true" tabindex="-1"></a>} <span class="co"># End of Loop 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All the year-elements in a single tibble:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>data_P_TOTAL    <span class="ot">&lt;-</span> <span class="fu">list_rbind</span>(data_P_TOTAL)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>data_S_TOTAL    <span class="ot">&lt;-</span> <span class="fu">list_rbind</span>(data_S_TOTAL)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>data_SR_TOTAL   <span class="ot">&lt;-</span> <span class="fu">list_rbind</span>(data_SR_TOTAL)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>data_Px_TOTAL   <span class="ot">&lt;-</span> <span class="fu">list_rbind</span>(data_Px_TOTAL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="campaign-data" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="campaign-data"><span class="header-section-number">2.3.1</span> Campaign Data</h3>
<p>We add the agricultural campaign data to the Planted surfaces data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>data_S_TOTAL <span class="ot">&lt;-</span> data_S_TOTAL <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">campaign =</span> <span class="fu">as.numeric</span>(<span class="fu">str_sub</span>(campaign, <span class="dv">3</span>, <span class="dv">4</span>)),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">campaign_plain =</span> <span class="fu">str_c</span>(campaign,<span class="st">"/"</span>,campaign <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retrieving the campaign month (starting in August)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_campaign =</span> <span class="fu">case_when</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="dv">1</span>  <span class="sc">~</span> <span class="dv">6</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="dv">2</span>  <span class="sc">~</span> <span class="dv">7</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="dv">3</span>  <span class="sc">~</span> <span class="dv">8</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="dv">4</span>  <span class="sc">~</span> <span class="dv">9</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="dv">5</span>  <span class="sc">~</span> <span class="dv">10</span>,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="dv">6</span>  <span class="sc">~</span> <span class="dv">11</span>,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="dv">7</span>  <span class="sc">~</span> <span class="dv">12</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="dv">8</span>  <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="dv">9</span>  <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="dv">12</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>      product <span class="sc">==</span> <span class="st">"maíz duro"</span>,</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">yes =</span>  <span class="st">"maíz amarillo duro"</span>,</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">no =</span> product</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, product) <span class="sc">|&gt;</span> </span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Harmonizing the cumulative values of surface (if the lead and the lag are equals)</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">Value_surf =</span> <span class="fu">ifelse</span>(</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lead</span>(Value_surf) <span class="sc">==</span> <span class="fu">lag</span>(Value_surf, <span class="at">default =</span> <span class="dv">0</span>) <span class="sc">&amp;</span> </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>        Value_surf <span class="sc">&lt;</span> <span class="fu">lag</span>(Value_surf, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">yes =</span> <span class="fu">lag</span>(Value_surf),</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">no =</span> Value_surf</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span> region <span class="sc">==</span> <span class="st">"Total Nacional"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we check whether there are some errors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking for errors  </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dup_surf <span class="ot">&lt;-</span> data_S_TOTAL <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span> product <span class="sc">==</span> <span class="st">"total"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span> product <span class="sc">==</span> <span class="st">"TOTAL"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, date, product) <span class="sc">|&gt;</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="growth-duration" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="growth-duration"><span class="header-section-number">2.3.2</span> Growth Duration</h3>
<p>Let us determine the growth duration and the corresponding lags from the agricultural calendars.</p>
<section id="sec-agricultural-calendar" class="level4" data-number="2.3.2.1">
<h4 data-number="2.3.2.1" class="anchored" data-anchor-id="sec-agricultural-calendar"><span class="header-section-number">2.3.2.1</span> Calendar</h4>
<p>The Excel files with the agricultural calendar for specific crops are in the <code>data</code> folder, within the <code>Calendario agricola</code> sub-folder. Note: soya seems to be missing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"../data/raw/Calendario agricola/"</span>, </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"xls$"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us define a small function that imports a specific calendar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Import calendar from the Excel files</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x full path to a Calendar (Excel file)</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>import_calendar <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  region <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(x, <span class="st">"//cal_(.*)</span><span class="sc">\\</span><span class="st">.xls"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_remove</span>(<span class="st">"//cal_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_remove</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.xls"</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  df_cal_1 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(x)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  row_prod_mes <span class="ot">&lt;-</span> <span class="fu">str_which</span>(</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    df_cal_1<span class="sc">$</span><span class="st">`</span><span class="at">CALENDARIO AGRICOLA NACIONAL</span><span class="st">`</span>, <span class="st">"Producto/Mes"</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  ind_first <span class="ot">&lt;-</span> <span class="fu">first</span>(row_prod_mes)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  ind_last <span class="ot">&lt;-</span> <span class="fu">last</span>(row_prod_mes)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  df_cal_planting <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    x, </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">skip =</span> ind_first, </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_max =</span> ind_last<span class="sc">-</span>ind_first <span class="sc">-</span> <span class="dv">3</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  df_cal_planting <span class="ot">&lt;-</span> </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    df_cal_planting <span class="sc">|&gt;</span> </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="sc">-</span><span class="st">`</span><span class="at">Producto/Mes</span><span class="st">`</span>,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"month_spanish"</span>,</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">"pct"</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> region, <span class="at">period =</span> <span class="st">"planting"</span>)</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  df_cal_harvest <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(x, <span class="at">skip =</span> ind_last)</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  df_cal_harvest <span class="ot">&lt;-</span> </span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    df_cal_harvest <span class="sc">|&gt;</span> </span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Producto/Mes</span><span class="st">`</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Producto/Mes</span><span class="st">`</span>, <span class="sc">~</span><span class="fu">as.numeric</span>(.))) <span class="sc">|&gt;</span> </span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="sc">-</span><span class="st">`</span><span class="at">Producto/Mes</span><span class="st">`</span>,</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"month_spanish"</span>,</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_to =</span> <span class="st">"pct"</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> region, <span class="at">period =</span> <span class="st">"harvest"</span>)</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  df_cal_planting <span class="sc">|&gt;</span> </span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(df_cal_harvest)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All the calendars can then be imported:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>calendar <span class="ot">&lt;-</span> <span class="fu">map</span>(N, import_calendar) <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The dates are written using Spanish month names. Let us create a table with the corresponding month numbers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>calendar <span class="ot">&lt;-</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  calendar <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month_spanish <span class="sc">!=</span> <span class="st">"...14"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>spanish_months <span class="ot">&lt;-</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_spanish =</span> <span class="fu">c</span>(</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Ene"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Abr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Jul"</span>, <span class="st">"Ago"</span>, <span class="st">"Set"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dic"</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The corresponding month numbers can then be associated with the data in the calendars.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>calendar <span class="ot">&lt;-</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  calendar <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(spanish_months) <span class="sc">|&gt;</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>month_spanish)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some renaming for the regions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>calendar <span class="ot">&lt;-</span> calendar <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">ifelse</span>(region <span class="sc">==</span> <span class="st">"lalibertad"</span>, <span class="st">"la libertad"</span>, region),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">ifelse</span>(region <span class="sc">==</span> <span class="st">"madrededios"</span>, <span class="st">"madre de dios"</span>, region),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">ifelse</span>(region <span class="sc">==</span> <span class="st">"sanmartin"</span>, <span class="st">"san martin"</span>, region)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">str_to_upper</span>(region))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When no data is filled in the Excel file, we assume it corresponds to no production.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>calendar <span class="ot">&lt;-</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  calendar <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">product =</span> <span class="st">`</span><span class="at">Producto/Mes</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(pct), <span class="dv">0</span>, pct))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The calendar for planting dates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>calendar1 <span class="ot">&lt;-</span> calendar <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(period <span class="sc">==</span> <span class="st">"planting"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, product) <span class="sc">|&gt;</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">val_max =</span> <span class="fu">max</span>(pct)) <span class="sc">|&gt;</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">which</span>(pct <span class="sc">==</span> val_max)) <span class="sc">|&gt;</span> </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>val_max) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the harvest season:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>calendar2 <span class="ot">&lt;-</span> calendar <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(period <span class="sc">==</span> <span class="st">"harvest"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, product) <span class="sc">|&gt;</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">val_max =</span> <span class="fu">max</span>(pct)) <span class="sc">|&gt;</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">which</span>(pct <span class="sc">==</span> val_max)) <span class="sc">|&gt;</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">163</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>val_max) <span class="sc">|&gt;</span> </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(calendar1, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"region"</span>,<span class="st">"product"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">growth_duration =</span> month.x <span class="sc">-</span> month.y,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">growth_duration =</span> <span class="fu">ifelse</span>(</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>      growth_duration <span class="sc">&lt;</span> <span class="dv">0</span>, </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">yes =</span> month.x <span class="sc">+</span> <span class="dv">13</span> <span class="sc">-</span> month.y, </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">no =</span> growth_duration</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">growth_duration =</span> <span class="fu">ifelse</span>(growth_duration <span class="sc">==</span> <span class="dv">0</span>,<span class="dv">12</span>, growth_duration)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="fu">which</span>(<span class="fu">is.na</span>(growth_duration))) <span class="sc">|&gt;</span> </span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">toupper</span>(<span class="fu">iconv</span>(region, <span class="at">to =</span> <span class="st">"ASCII//TRANSLIT"</span>)),</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">product =</span> <span class="fu">toupper</span>(product)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>calendar3 <span class="ot">&lt;-</span> calendar <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(period <span class="sc">==</span> <span class="st">"harvest"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span>   <span class="fu">str_c</span>(<span class="st">"month"</span>, month)) <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> month, <span class="at">values_from =</span> pct) <span class="sc">|&gt;</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum1  =</span> month1, </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum2  =</span> month2 <span class="sc">+</span> cum_sum1, </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum3  =</span> month3 <span class="sc">+</span> cum_sum2, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum4  =</span> month4 <span class="sc">+</span> cum_sum3, </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum5  =</span> month5 <span class="sc">+</span> cum_sum4, </span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum6  =</span> month6 <span class="sc">+</span> cum_sum5, </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum7  =</span> month7 <span class="sc">+</span> cum_sum6, </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum8  =</span> month8 <span class="sc">+</span> cum_sum7, </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum9  =</span> month9 <span class="sc">+</span> cum_sum8, </span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum10 =</span> month10 <span class="sc">+</span> cum_sum9, </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum11 =</span> month11 <span class="sc">+</span> cum_sum10, </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum12 =</span> month12 <span class="sc">+</span> cum_sum11) <span class="sc">|&gt;</span> </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    product, region,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    cum_sum1, cum_sum2, cum_sum3, cum_sum4,cum_sum5, cum_sum6,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    cum_sum7, cum_sum8, cum_sum9, cum_sum10, cum_sum11, cum_sum12</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>      cum_sum1, cum_sum2, cum_sum3, cum_sum4,cum_sum5, cum_sum6,</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>      cum_sum7, cum_sum8, cum_sum9, cum_sum10, cum_sum11, cum_sum12</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"month"</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">perc_cum_harv =</span> value) <span class="sc">|&gt;</span> </span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum1"</span>  <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum2"</span>  <span class="sc">~</span> <span class="dv">2</span>, </span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum3"</span>  <span class="sc">~</span> <span class="dv">3</span>, </span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum4"</span>  <span class="sc">~</span> <span class="dv">4</span>, </span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum5"</span>  <span class="sc">~</span> <span class="dv">5</span>, </span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum6"</span>  <span class="sc">~</span> <span class="dv">6</span>, </span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum7"</span>  <span class="sc">~</span> <span class="dv">7</span>, </span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum8"</span>  <span class="sc">~</span> <span class="dv">8</span>, </span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum9"</span>  <span class="sc">~</span> <span class="dv">9</span>, </span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum10"</span> <span class="sc">~</span> <span class="dv">10</span>, </span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum11"</span> <span class="sc">~</span> <span class="dv">11</span>, </span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum12"</span> <span class="sc">~</span> <span class="dv">12</span>, </span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The planting season:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>calendar4 <span class="ot">&lt;-</span> calendar <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(period <span class="sc">==</span> <span class="st">"planting"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span>   <span class="fu">str_c</span>(<span class="st">"month"</span>, month)) <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> month, <span class="at">values_from =</span> pct) <span class="sc">|&gt;</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum1  =</span> month8, </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum2  =</span> month9 <span class="sc">+</span> cum_sum1, </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum3  =</span> month10 <span class="sc">+</span> cum_sum2, </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum4  =</span> month11 <span class="sc">+</span> cum_sum3, </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum5  =</span> month12 <span class="sc">+</span> cum_sum4, </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum6  =</span> month1 <span class="sc">+</span> cum_sum5, </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum7  =</span> month2 <span class="sc">+</span> cum_sum6, </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum8  =</span> month3 <span class="sc">+</span> cum_sum7, </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum9  =</span> month4 <span class="sc">+</span> cum_sum8, </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum10 =</span> month5 <span class="sc">+</span> cum_sum9, </span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum11 =</span> month6 <span class="sc">+</span> cum_sum10, </span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum_sum12 =</span> month7 <span class="sc">+</span> cum_sum11</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    product, region, </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    cum_sum1, cum_sum2, cum_sum3, cum_sum4,cum_sum5, cum_sum6, </span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    cum_sum7, cum_sum8, cum_sum9, cum_sum10, cum_sum11, cum_sum12</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>      cum_sum1, cum_sum2, cum_sum3, cum_sum4,cum_sum5, cum_sum6, </span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>      cum_sum7, cum_sum8, cum_sum9, cum_sum10, cum_sum11, cum_sum12</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">names_to =</span> <span class="st">"month"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">perc_cum_plan =</span> value) <span class="sc">|&gt;</span> </span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum1"</span>  <span class="sc">~</span> <span class="dv">8</span>, </span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum2"</span>  <span class="sc">~</span> <span class="dv">9</span>, </span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum3"</span>  <span class="sc">~</span> <span class="dv">10</span>, </span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum4"</span>  <span class="sc">~</span> <span class="dv">11</span>, </span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum5"</span>  <span class="sc">~</span> <span class="dv">12</span>, </span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum6"</span>  <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum7"</span>  <span class="sc">~</span> <span class="dv">2</span>, </span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum8"</span>  <span class="sc">~</span> <span class="dv">3</span>, </span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum9"</span>  <span class="sc">~</span> <span class="dv">4</span>, </span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum10"</span> <span class="sc">~</span> <span class="dv">5</span>, </span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum11"</span> <span class="sc">~</span> <span class="dv">6</span>, </span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"cum_sum12"</span> <span class="sc">~</span> <span class="dv">7</span>, </span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We save those calendars</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(calendar, <span class="at">file =</span> <span class="st">"../data/output/Calendario agricola/calendar.rda"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(calendar2, <span class="at">file =</span> <span class="st">"../data/output/Calendario agricola/calendar2.rda"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(calendar3, <span class="at">file =</span> <span class="st">"../data/output/Calendario agricola/calendar3.rda"</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(calendar4, <span class="at">file =</span> <span class="st">"../data/output/Calendario agricola/calendar4.rda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>calendar2 <span class="ot">&lt;-</span> calendar2 <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"á"</span>, <span class="st">"a"</span>),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"í"</span>, <span class="st">"i"</span>),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"é"</span>, <span class="st">"e"</span>),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ó"</span>, <span class="st">"o"</span>),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ú"</span>, <span class="st">"u"</span>),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ñ"</span>, <span class="st">"n"</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">toupper</span>(region), </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">product =</span> <span class="fu">toupper</span>(product),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">product =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(product, <span class="st">"ARROZ"</span>), <span class="st">"ARROZ CÁSCARA"</span>, product)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>calendar2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 142 × 9
   product  pct.x region period.x month.x pct.y period.y month.y growth_duration
   &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;int&gt;           &lt;dbl&gt;
 1 ARROZ C…  15.5 AMAZO… harvest        8  17.3 planting       3               5
 2 FRIJOL …  24.6 AMAZO… harvest        7  31.5 planting      11               9
 3 MAÍZ AM…  15.4 AMAZO… harvest        6  15.7 planting       2               4
 4 MAÍZ AM…  20.9 AMAZO… harvest        8  27.1 planting      11              10
 5 PAPA      11.8 AMAZO… harvest        4  12.8 planting      11               6
 6 TRIGO     27.5 AMAZO… harvest        8  22.2 planting       3               5
 7 YUCA      13.3 AMAZO… harvest       11  14.4 planting      11              12
 8 ALGODÓN   19.2 ANCASH harvest        3  25.5 planting       8               8
 9 ARROZ C…  25.4 ANCASH harvest        3  32.5 planting      11               5
10 CEBADA …  62.2 ANCASH harvest        7  44.6 planting       1               6
# ℹ 132 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>data_S_TOTAL <span class="ot">&lt;-</span> data_S_TOTAL <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, product, campaign) <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(region, product, campaign, month_campaign) <span class="sc">|&gt;</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">surf_m =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">==</span> <span class="st">"8"</span> <span class="sc">~</span> Value_surf,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      month <span class="sc">!=</span> <span class="st">"8"</span> <span class="sc">~</span> Value_surf <span class="sc">-</span> <span class="fu">lag</span>(Value_surf))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, product) <span class="sc">|&gt;</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"á"</span>, <span class="st">"a"</span>),</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"í"</span>, <span class="st">"i"</span>),</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"é"</span>, <span class="st">"e"</span>),</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ó"</span>, <span class="st">"o"</span>),</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ú"</span>, <span class="st">"u"</span>),</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ñ"</span>, <span class="st">"n"</span>)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">toupper</span>(<span class="fu">iconv</span>(region, <span class="at">to =</span> <span class="st">"ASCII//TRANSLIT"</span>)),</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">product =</span> <span class="fu">toupper</span>(product)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(calendar2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"region"</span>,<span class="st">"product"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us add a variable with the lagged surface:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data_S_TOTAL <span class="ot">&lt;-</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  data_S_TOTAL <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(region, product, id) <span class="sc">|&gt;</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, product) <span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">surf_lag_calend =</span> <span class="fu">case_when</span>(</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>      growth_duration <span class="sc">==</span> <span class="dv">1</span>  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(surf_m, <span class="dv">1</span>))  <span class="sc">~</span> <span class="fu">lag</span>(surf_m, <span class="dv">1</span>),</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>      growth_duration <span class="sc">==</span> <span class="dv">2</span>  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(surf_m, <span class="dv">2</span>))  <span class="sc">~</span> <span class="fu">lag</span>(surf_m, <span class="dv">2</span>),</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>      growth_duration <span class="sc">==</span> <span class="dv">3</span>  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(surf_m, <span class="dv">3</span>))  <span class="sc">~</span> <span class="fu">lag</span>(surf_m, <span class="dv">3</span>),</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>      growth_duration <span class="sc">==</span> <span class="dv">4</span>  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(surf_m, <span class="dv">4</span>))  <span class="sc">~</span> <span class="fu">lag</span>(surf_m, <span class="dv">4</span>),</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>      growth_duration <span class="sc">==</span> <span class="dv">5</span>  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(surf_m, <span class="dv">5</span>))  <span class="sc">~</span> <span class="fu">lag</span>(surf_m, <span class="dv">5</span>),</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>      growth_duration <span class="sc">==</span> <span class="dv">6</span>  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(surf_m, <span class="dv">6</span>))  <span class="sc">~</span> <span class="fu">lag</span>(surf_m, <span class="dv">6</span>),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>      growth_duration <span class="sc">==</span> <span class="dv">7</span>  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(surf_m, <span class="dv">7</span>))  <span class="sc">~</span> <span class="fu">lag</span>(surf_m, <span class="dv">7</span>),</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>      growth_duration <span class="sc">==</span> <span class="dv">8</span>  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(surf_m, <span class="dv">8</span>))  <span class="sc">~</span> <span class="fu">lag</span>(surf_m, <span class="dv">8</span>),</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>      growth_duration <span class="sc">==</span> <span class="dv">9</span>  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(surf_m, <span class="dv">9</span>))  <span class="sc">~</span> <span class="fu">lag</span>(surf_m, <span class="dv">9</span>),</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>      growth_duration <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(surf_m, <span class="dv">10</span>)) <span class="sc">~</span> <span class="fu">lag</span>(surf_m, <span class="dv">10</span>),</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>      growth_duration <span class="sc">==</span> <span class="dv">11</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(surf_m, <span class="dv">11</span>)) <span class="sc">~</span> <span class="fu">lag</span>(surf_m, <span class="dv">11</span>),</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>      growth_duration <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(surf_m, <span class="dv">12</span>)) <span class="sc">~</span> <span class="fu">lag</span>(surf_m, <span class="dv">12</span>),</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Harmonizing the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>data_S_TOTAL <span class="ot">&lt;-</span> data_S_TOTAL <span class="sc">|&gt;</span>  </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">surf_lag_calend =</span> <span class="fu">ifelse</span>(id <span class="sc">&lt;=</span> growth_duration, <span class="cn">NA</span>, surf_lag_calend)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span> product <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"TOTAL"</span>, <span class="st">"total"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gr_duration_calend"</span> <span class="ot">=</span> <span class="st">"growth_duration"</span>, </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"month_plan_calend"</span> <span class="ot">=</span> <span class="st">"month.y"</span>, </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"month_harv_calend"</span> <span class="ot">=</span> <span class="st">"month.x"</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span> period.x, <span class="sc">-</span> pct.x, <span class="sc">-</span>pct.y, <span class="sc">-</span>period.y)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(calendar2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="saving-the-raw-data" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="saving-the-raw-data"><span class="header-section-number">2.3.3</span> Saving the raw data</h3>
<p>We can save the raw data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(data_P_TOTAL, <span class="at">file =</span> <span class="st">"../data/output/minagri/data_P_TOTAL.rda"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(data_S_TOTAL, <span class="at">file =</span> <span class="st">"../data/output/minagri/data_S_TOTAL.rda"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(data_SR_TOTAL, <span class="at">file =</span> <span class="st">"../data/output/minagri/data_SR_TOTAL.rda"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(data_Px_TOTAL, <span class="at">file =</span> <span class="st">"../data/output/minagri/data_Px_TOTAL.rda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="aggregation-of-agricultural-datasets" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="aggregation-of-agricultural-datasets"><span class="header-section-number">2.4</span> Aggregation of Agricultural Datasets</h2>
<p>We can load the datasets obtained previously:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/output/minagri/data_P_TOTAL.rda"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/output/minagri/data_S_TOTAL.rda"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/output/minagri/data_SR_TOTAL.rda"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/output/minagri/data_Px_TOTAL.rda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="harmonization" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="harmonization"><span class="header-section-number">2.4.1</span> Harmonization</h3>
<p>Harmonizing the production, surfaces and prices datasets.</p>
<p>Production prices:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>data_Px_TOTAL <span class="ot">&lt;-</span> data_Px_TOTAL <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"á"</span>, <span class="st">"a"</span>),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"í"</span>, <span class="st">"i"</span>),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"é"</span>, <span class="st">"e"</span>),</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ó"</span>, <span class="st">"o"</span>),</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ú"</span>, <span class="st">"u"</span>),</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ñ"</span>, <span class="st">"n"</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">toupper</span>(<span class="fu">iconv</span>(region, <span class="at">to =</span> <span class="st">"ASCII//TRANSLIT"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">toupper</span>(region), </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">product =</span> <span class="fu">toupper</span>(product), </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>      product <span class="sc">==</span> <span class="st">"FRIJOL GRANO SECO**"</span>,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">yes =</span> <span class="st">"FRIJOL GRANO SECO"</span>, </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">no =</span> product</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Harvested surface:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>data_SR_TOTAL <span class="ot">&lt;-</span> data_SR_TOTAL <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"á"</span>, <span class="st">"a"</span>),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"í"</span>, <span class="st">"i"</span>),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"é"</span>, <span class="st">"e"</span>),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ó"</span>, <span class="st">"o"</span>),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ú"</span>, <span class="st">"u"</span>),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ñ"</span>, <span class="st">"n"</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">toupper</span>(<span class="fu">iconv</span>(region, <span class="at">to =</span> <span class="st">"ASCII//TRANSLIT"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">toupper</span>(region), </span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">product =</span> <span class="fu">toupper</span>(product), </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">product =</span> <span class="fu">ifelse</span>(</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>           product <span class="sc">==</span> <span class="st">"FRIJOL GRANO SECO**"</span>,</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">yes =</span> <span class="st">"FRIJOL GRANO SECO"</span>,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">no =</span> product)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aggregation-in-a-single-tibble" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="aggregation-in-a-single-tibble"><span class="header-section-number">2.4.2</span> Aggregation in a single tibble</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data_P_TOTAL <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"á"</span>, <span class="st">"a"</span>),</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"í"</span>, <span class="st">"i"</span>),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"é"</span>, <span class="st">"e"</span>),</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ó"</span>, <span class="st">"o"</span>),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ú"</span>, <span class="st">"u"</span>),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ñ"</span>, <span class="st">"n"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">toupper</span>(<span class="fu">iconv</span>(region, <span class="at">to =</span> <span class="st">"ASCII//TRANSLIT"</span>))</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">toupper</span>(region), </span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">product =</span> <span class="fu">toupper</span>(product), </span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">as.numeric</span>(month)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    data_S_TOTAL <span class="sc">|&gt;</span> </span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(year,month)), </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"region"</span>,<span class="st">"product"</span>,<span class="st">"date"</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span>  </span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span> <span class="fu">is.na</span>(year)) <span class="sc">|&gt;</span> </span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># No consequences on the aggregation because the missing data are not in the</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># product sample used hereafter. (except for Lima but without production value)</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    data_Px_TOTAL <span class="sc">|&gt;</span> </span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(year,month)), </span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"region"</span>,<span class="st">"product"</span>,<span class="st">"date"</span>)</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span>  </span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(product <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PAPA"</span>, <span class="st">"CEBADA GRANO"</span>, <span class="st">"MAÍZ AMARILLO DURO"</span>, <span class="st">"MAÍZ AMILÁCEO"</span>,</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ARROZ CÁSCARA"</span>, <span class="st">"SORGO GRANO"</span>, <span class="st">"YUCA"</span>, <span class="st">"TRIGO"</span>)</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>    region, product, year, month, date, </span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>    Value_prod, surf_m, surf_lag_calend, Value_prices, </span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>    campaign, month_campaign, campaign_plain, id</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>    data_SR_TOTAL <span class="sc">|&gt;</span> </span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span> month, <span class="sc">-</span> year), </span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"region"</span>,<span class="st">"product"</span>,<span class="st">"date"</span>)</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(product <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PAPA"</span>, <span class="st">"CEBADA GRANO"</span>, <span class="st">"MAÍZ AMARILLO DURO"</span>, <span class="st">"MAÍZ AMILÁCEO"</span>,</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ARROZ CÁSCARA"</span>, <span class="st">"SORGO GRANO"</span>, <span class="st">"YUCA"</span>, <span class="st">"TRIGO"</span>)</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span> region <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Lima Metropolitana"</span>, <span class="st">"Callao"</span>, <span class="st">"LIMA METROPOLITANA"</span>,</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CALLAO"</span>, <span class="st">"PROMEDIO NACIONAL"</span>)</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span> <span class="fu">is.na</span>(region)) <span class="sc">|&gt;</span> </span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span> product <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"SORGO GRANO"</span>, <span class="st">"CEBADA GRANO"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some values are missing. Let us deal with those.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>missing_values <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"../data/raw/Macro/Datos_INEI1.xlsx"</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="st">"SELECTED2"</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="st">"text"</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"á"</span>, <span class="st">"a"</span>),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"í"</span>, <span class="st">"i"</span>),</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"é"</span>, <span class="st">"e"</span>),</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ó"</span>, <span class="st">"o"</span>),</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ú"</span>, <span class="st">"u"</span>),</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">str_replace_all</span>(region, <span class="st">"ñ"</span>, <span class="st">"n"</span>)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">toupper</span>(<span class="fu">iconv</span>(region, <span class="at">to =</span> <span class="st">"ASCII//TRANSLIT"</span>)),</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">toupper</span>(region), </span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">product =</span> <span class="fu">toupper</span>(product)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Indicador) <span class="sc">|&gt;</span> </span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(NOV,DEC), <span class="at">names_to =</span> <span class="st">"name_month"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="dv">2008</span>, </span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">ifelse</span>(name_month <span class="sc">==</span> <span class="st">"NOV"</span>, <span class="dv">11</span>, <span class="dv">12</span>)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name_month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>data_agri <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    missing_values,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"region"</span> ,<span class="st">"product"</span> ,<span class="st">"month"</span>,<span class="st">"year"</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Value_prod =</span> <span class="fu">ifelse</span>(</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># The price data in Nov. 2008 are the same as that of Oct...</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="dv">2008</span> <span class="sc">&amp;</span> month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">12</span>),</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">yes =</span> <span class="fu">as.numeric</span>(value), </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">no =</span> Value_prod</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>value) <span class="sc">|&gt;</span> </span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">|&gt;</span> </span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    region, product, year, month, date, </span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    Value_prod, surf_m,</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    Value_surfR, Value_prices, </span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    campaign, campaign_plain, month_campaign</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span> <span class="fu">is.na</span>(year), </span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span> region <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"TOTAL NACIONAL"</span>, <span class="st">"CALLAO"</span>, <span class="st">"LIMA METROPOLITANA"</span>,</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"PROMEDIO NACIONAL"</span>, <span class="st">"LIMA PROVINCIAS"</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us save that table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(data_agri, <span class="at">file =</span> <span class="st">"../data/output/minagri/data_agri.rda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="final-aggregation" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="final-aggregation"><span class="header-section-number">2.5</span> Final Aggregation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/output/minagri/data_agri.rda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(data_agri<span class="sc">$</span>region)) <span class="sc">*</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(<span class="fu">unique</span>(data_agri<span class="sc">$</span>product)) <span class="sc">*</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(<span class="fu">unique</span>(data_agri<span class="sc">$</span>date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25920</code></pre>
</div>
</div>
<p>Let us fill the table if some rows are missing for the triplet region x product x date:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>data_agri <span class="ot">&lt;-</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  data_agri <span class="sc">|&gt;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(region, product, date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Are there any duplicated triplet?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>data_agri <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, product, date) <span class="sc">|&gt;</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">|&gt;</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n<span class="sc">&gt;</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 4
# Groups:   region, product, date [0]
# ℹ 4 variables: region &lt;chr&gt;, product &lt;chr&gt;, date &lt;date&gt;, n &lt;int&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>data_total <span class="ot">&lt;-</span>  </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  data_agri <span class="sc">|&gt;</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span> region <span class="sc">==</span> <span class="st">"TOTAL NACIONAL"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adding the english names of the selected crops</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">product_eng =</span> <span class="fu">case_when</span>(</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>      product <span class="sc">==</span> <span class="st">"ARROZ CÁSCARA"</span>      <span class="sc">~</span> <span class="st">"Rice"</span>,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>      product <span class="sc">==</span> <span class="st">"MAÍZ AMARILLO DURO"</span> <span class="sc">~</span> <span class="st">"Dent corn"</span>,</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>      product <span class="sc">==</span> <span class="st">"MAÍZ AMILÁCEO"</span>      <span class="sc">~</span> <span class="st">"Amylaceous corn"</span>, </span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>      product <span class="sc">==</span> <span class="st">"PAPA"</span>               <span class="sc">~</span> <span class="st">"Potato"</span>, </span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>      product <span class="sc">==</span> <span class="st">"TRIGO"</span>              <span class="sc">~</span> <span class="st">"Wheat"</span>, </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>      product <span class="sc">==</span> <span class="st">"YUCA"</span>               <span class="sc">~</span> <span class="st">"Cassava"</span>, </span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> product)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, product, year) <span class="sc">|&gt;</span> </span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Computing the share of the annual production harvested at month m </span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">perc_product =</span> <span class="fu">ifelse</span>(Value_prod <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, Value_prod) <span class="sc">/</span> </span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>( <span class="fu">ifelse</span>(Value_prod <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, Value_prod), <span class="at">na.rm =</span> T)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, product, month) <span class="sc">|&gt;</span> </span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Computing the average share of the annual production harvested at month m</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_product_mean =</span> <span class="fu">mean</span>(perc_product, <span class="at">na.rm =</span> T)) <span class="sc">|&gt;</span> </span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>data_total <span class="ot">&lt;-</span> data_total <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(region, product, date) <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region_id =</span> <span class="fu">cur_group_id</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Computing the log of the quantities and prices</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ln_prices =</span> <span class="fu">log</span>(Value_prices <span class="sc">+</span> <span class="dv">1</span>), </span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ln_produc =</span> <span class="fu">log</span>(Value_prod <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(region_id, region, product, date, ln_prices, ln_produc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `ln_produc = log(Value_prod + 1)`.
Caused by warning in `log()`:
! NaNs produced</code></pre>
</div>
</div>
<p>Let us determine the start of the harvest season:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>data_total <span class="ot">&lt;-</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  data_total <span class="sc">|&gt;</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(region, product_eng, date) <span class="sc">|&gt;</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Computing the difference between planted and harvested surfaces at time t </span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_plant_harv =</span> surf_m <span class="sc">-</span> Value_surfR) <span class="sc">|&gt;</span> </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, product_eng) <span class="sc">|&gt;</span> </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a> <span class="co"># Computing the cumulative difference and normalizing the detrended component</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exposition =</span> <span class="fu">cumsum</span>(<span class="fu">replace_na</span>(diff_plant_harv, <span class="dv">0</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exposition_trend =</span> <span class="fu">as.vector</span>(</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    mFilter<span class="sc">::</span><span class="fu">hpfilter</span>(</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>      exposition, <span class="at">freq =</span> <span class="dv">14400</span>, <span class="at">type =</span> <span class="st">"lambda"</span>, <span class="at">drift =</span> <span class="cn">FALSE</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">$</span>trend)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exposition_detrended =</span> exposition <span class="sc">-</span> exposition_trend) <span class="sc">|&gt;</span> </span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposition_norm =</span> (exposition_detrended <span class="sc">-</span> <span class="fu">min</span>(exposition_detrended)) <span class="sc">/</span> </span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">max</span>(exposition_detrended) <span class="sc">-</span> <span class="fu">min</span>(exposition_detrended))</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We add labels to each column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>data_total <span class="ot">&lt;-</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  data_total <span class="sc">|&gt;</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  labelled<span class="sc">::</span><span class="fu">set_variable_labels</span>(</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_id =</span> <span class="st">"Region numerical ID"</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="st">"Name of the region"</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">product =</span> <span class="st">"Name of the crop (in Spanish)"</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="st">"Date (YYYY-MM-DD)"</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ln_prices =</span> <span class="st">"Product price (log)"</span>,</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ln_produc =</span> <span class="st">"Production (log of tons)"</span>,</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="st">"Year (YYYY)"</span>,</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="st">"Month (MM)"</span>,</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Value_prod =</span> <span class="st">"Production (tons)"</span>,</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">surf_m =</span> <span class="st">"Planted Surface during the current month (hectares)"</span>,</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">surf_lag_calend =</span> <span class="st">"Planted Surface laggued by the growth duration computed from the caledars (hectares)"</span>,</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Value_surfR =</span> <span class="st">"Harvested Surface (hectares)"</span>,</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Value_prices =</span> <span class="st">"Unit Price (Pesos)"</span>,</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">campaign =</span> <span class="st">"ID of the planting campaing (starting in August)"</span>,</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">campaign_plain =</span> <span class="st">"Years of the planting campaing (starting in August)"</span>,</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_campaign =</span> <span class="st">"Month of the planting campaing (August = 1)"</span>,</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">product_eng =</span> <span class="st">"Name of the Product (in English)"</span>,</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">perc_product =</span> <span class="st">"Share of the annual production harvested at month m"</span>,</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">perc_product_mean =</span> <span class="st">"Average share of the annual production harvested at month m"</span>,</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff_plant_harv =</span> <span class="st">"Difference between planted and harvested surfaces during month m"</span>,</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposition =</span> <span class="st">"Cumulative difference between planted and harvested surfaces"</span>,</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposition_trend =</span> <span class="st">"Trend of the exposition using HP filter"</span>,</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposition_detrended =</span> <span class="st">"Difference between the exposition and its trend"</span>,</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposition_norm =</span> <span class="st">"Normalisation of the detrended exposition"</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And lastly, let us save the resulting data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(data_total, <span class="at">file =</span> <span class="st">"../data/output/minagri/dataset_agri_2001_2015.rda"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(data_total, <span class="st">"../data/output/minagri/dataset_agri_2001_2015.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="content-of-the-dataset" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="content-of-the-dataset"><span class="header-section-number">2.6</span> Content of the dataset</h2>
<div id="tbl-desc-variables-dataset-agri" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-desc-variables-dataset-agri-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.1: Variables in the <code>dataset_agri_2001_2015.rda</code> file
</figcaption>
<div aria-describedby="tbl-desc-variables-dataset-agri-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 46%">
<col style="width: 14%">
<col style="width: 39%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Variable name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>region_id</code></td>
<td>integer</td>
<td>Region numerical ID</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>region</code></td>
<td>character</td>
<td>Name of the region</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>product</code></td>
<td>character</td>
<td>Name of the crop (in Spanish)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>date</code></td>
<td>Date</td>
<td>Date (YYYY-MM-DD)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>ln_prices</code></td>
<td>numeric</td>
<td>Product price (log)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>ln_produc</code></td>
<td>numeric</td>
<td>Production (log of tons)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>year</code></td>
<td>numeric</td>
<td>Year (YYYY)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>month</code></td>
<td>numeric</td>
<td>Month (MM)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Value_prod</code></td>
<td>numeric</td>
<td>Production (tons)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>surf_m</code></td>
<td>numeric</td>
<td>Planted Surface during the current month (hectares)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Value_surfR</code></td>
<td>numeric</td>
<td>Harvested Surface (hectares)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Value_prices</code></td>
<td>numeric</td>
<td>Unit Price (Pesos)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>campaign</code></td>
<td>numeric</td>
<td>ID of the planting campaing (starting in August)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>campaign_plain</code></td>
<td>character</td>
<td>Years of the planting campaing (starting in August)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>month_campaign</code></td>
<td>numeric</td>
<td>Month of the planting campaing (August = 1)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>surf_lag_calend</code></td>
<td>numeric</td>
<td>Planted Surface laggued by the growth duration computed from the caledars (hectares)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>product_eng</code></td>
<td>character</td>
<td>Name of the Product (in English)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>perc_product</code></td>
<td>numeric</td>
<td>Share of the annual production harvested at month m</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>perc_product_mean</code></td>
<td>numeric</td>
<td>Average share of the annual production harvested at month m</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>diff_plant_harv</code></td>
<td>numeric</td>
<td>Difference between planted and harvested surfaces during month m</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>exposition</code></td>
<td>numeric</td>
<td>Cumulative difference between planted and harvested surfaces</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>exposition_trend</code></td>
<td>numeric</td>
<td>Trend of the exposition using HP filter</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>exposition_detrended</code></td>
<td>numeric</td>
<td>Difference between the exposition and its trend</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>exposition_norm</code></td>
<td>numeric</td>
<td>Normalisation of the detrended exposition</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./data-weather.html" class="pagination-link" aria-label="Weather Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Weather Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./data-macro.html" class="pagination-link" aria-label="Macroeconomic Data">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Macroeconomic Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>